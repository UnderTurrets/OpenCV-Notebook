<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>【OpenCV教程】一文带你入门和精通OpenCV（C/C++），持续更新</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><p></p><div class="toc"><h3>文章目录（OpenCV版本4.6.0）</h3><ul><li><a href="#1_4">1.数据类型</a></li><li><a href="#2_104">2.矩阵基本操作</a></li><ul><li><a href="#21__106">2.1 全零矩阵</a></li><li><a href="#22__127">2.2 全一矩阵</a></li><li><a href="#23__145">2.3 单位矩阵</a></li><li><a href="#24__160">2.4 矩阵转置</a></li><li><a href="#25__166">2.5 求逆矩阵</a></li><li><a href="#26__172">2.6 逗号式分隔创建矩阵，常用于自定义卷积核</a></li><li><a href="#27__210">2.7 矩阵定义(只列出常用的)</a></li><ul><li><a href="#271_Scalar_235">2.7.1 数据类型Scalar</a></li></ul><li><a href="#28_ptrat_240">2.8 通过ptr与at函数遍历矩阵</a></li><ul><li><a href="#281_Vec_242">2.8.1 Vec类型</a></li></ul><li><a href="#29_easy_but_very_very_slow_304">2.9 通过迭代器遍历矩阵(easy but very very slow)</a></li></ul><li><a href="#3_315">3.图像基本操作</a></li><ul><li><a href="#31__317">3.1 图片读取</a></li><li><a href="#32__364">3.2 创建窗口</a></li><li><a href="#33__372">3.3 图片显示</a></li><li><a href="#34__390">3.4 图片保存</a></li><li><a href="#35__399">3.5 视频输入输出</a></li><ul><li><a href="#351_filename_420">3.5.1 filename</a></li><li><a href="#352_index_428">3.5.2 index</a></li><li><a href="#353_fourcc_434">3.5.3 fourcc</a></li><li><a href="#354_apiPreferencenot__important_450">3.5.4 apiPreference（not  important）</a></li><li><a href="#355__456">3.5.5 演示</a></li></ul><li><a href="#36__474">3.6 通道分离与合并</a></li><ul><li><a href="#361__476">3.6.1 分离</a></li><ul><li><a href="#API_478">API（一）</a></li><li><a href="#API_488">API（二）</a></li></ul><li><a href="#362__498">3.6.2 合并</a></li><ul><li><a href="#API_500">API（一）</a></li><li><a href="#API_512">API（二）</a></li></ul></ul><li><a href="#37__522">3.7 图片色彩模式转换</a></li><ul><li><a href="#371_API_523">3.7.1 API</a></li><li><a href="#372__530">3.7.2 转换类型和转换码</a></li></ul><li><a href="#38__676">3.8 改变图片的对比度和亮度</a></li><ul><li><a href="#381__678">3.8.1 概述</a></li><li><a href="#382_saturate_cast_688">3.8.2 手动（使用saturate_cast函数确保输出值不溢出范围）</a></li><li><a href="#383_APIMatconvertTo_706">3.8.3 调用API：Mat::convertTo</a></li></ul><li><a href="#39__724">3.9 图片混合</a></li><li><a href="#310__745">3.10 图片尺寸调整</a></li><ul><li><a href="#3101_not_important_765">3.10.1 插值算法(not important)</a></li><li><a href="#3102__801">3.10.2 注意事项</a></li></ul><li><a href="#311__810">3.11 图像金字塔（常用于神经网络的池化层，对图像进行成倍的放大或缩小）</a></li><li><a href="#312__840">3.12 二值化（对灰度图）</a></li><ul><li><a href="#3121__857">3.12.1 阈值类型</a></li><ul><li><a href="#Threshold_Binary_872">阈值二值化（Threshold Binary）</a></li><li><a href="#Threshold_Binary_Inverted_878">阈值反二值化（Threshold Binary Inverted）</a></li><li><a href="#Truncate_884">截断（Truncate）</a></li><li><a href="#Threshold_To_Zero_890">阈值取零（Threshold To Zero）</a></li><li><a href="#Threshold_To_Zero_Inverted_896">阈值反取零（Threshold To Zero Inverted）</a></li></ul></ul><li><a href="#313__902">3.13 图片裁剪</a></li><ul><li><a href="#3131__904">3.13.1 方式一</a></li><li><a href="#3132__925">3.13.2 方式二</a></li><li><a href="#3133_Rect_944">3.13.3 Rect类构造</a></li></ul><li><a href="#314__965">3.14 基本变换</a></li><ul><li><a href="#3141__967">3.14.1 翻转</a></li><ul><li><a href="#_985">效果</a></li></ul><li><a href="#3142_90_998">3.14.2 90°旋转</a></li><ul><li><a href="#_1015">效果</a></li></ul></ul><li><a href="#315__1028">3.15 仿射变换与透射变换</a></li><ul><li><a href="#3151__1073">3.15.1 平移</a></li><ul><li><a href="#_1092">效果</a></li></ul><li><a href="#3152__1108">3.15.2 任意角度旋转</a></li><ul><li><a href="#M_1110">获得变换矩阵M</a></li><li><a href="#_1126">效果</a></li></ul><li><a href="#3153__1139">3.15.3 仿射（不破坏几何关系）</a></li><ul><li><a href="#M_1141">获得变换矩阵M</a></li></ul><li><a href="#3154__1153">3.15.4 透射（破坏几何关系）</a></li><ul><li><a href="#M_1155">已知变换后图片，逆推变换矩阵M</a></li><li><a href="#M_1165">获得变换矩阵M</a></li><li><a href="#_1177">效果</a></li></ul></ul></ul><li><a href="#4_1194">4.滤波及边缘检测</a></li><ul><li><a href="#41__1196">4.1 均值滤波</a></li><ul><li><a href="#411__1198">4.1.1 卷积核形状</a></li><li><a href="#412_API_1204">4.1.2 API</a></li><li><a href="#413__1222">4.1.3 效果</a></li></ul><li><a href="#42__1235">4.2 高斯滤波</a></li><ul><li><a href="#421__1237">4.2.1 卷积核形状</a></li><li><a href="#422_API_1275">4.2.2 API</a></li><li><a href="#423__1295">4.2.3 效果</a></li></ul><li><a href="#43__1308">4.3 中值滤波</a></li><ul><li><a href="#431__1310">4.3.1 原理</a></li><li><a href="#432_API_1314">4.3.2 API</a></li><li><a href="#433__1326">4.3.3 效果</a></li></ul><li><a href="#44__1339">4.4 高斯双边滤波</a></li><ul><li><a href="#441__1341">4.4.1 原理</a></li><li><a href="#442_API_1347">4.4.2 API</a></li><li><a href="#443__1367">4.4.3 效果</a></li></ul><li><a href="#45__1380">4.5 获取用来形态学操作的滤波器</a></li><li><a href="#46__1399">4.6 腐蚀和膨胀（对二值图）</a></li><ul><li><a href="#461__1401">4.6.1 原理</a></li><li><a href="#462_API_1407">4.6.2 腐蚀API</a></li><li><a href="#463__1430">4.6.3 效果</a></li><li><a href="#464_API_1451">4.6.4 膨胀API</a></li><li><a href="#465__1474">4.6.5 效果</a></li></ul><li><a href="#47__1495">4.7 形态学操作（对二值图）</a></li><ul><li><a href="#471_API_1497">4.7.1 API</a></li><li><a href="#472__1523">4.7.2 变换类型</a></li><li><a href="#473__1546">4.7.3 开</a></li><ul><li><a href="#_1548">原理</a></li><li><a href="#_1552">效果</a></li></ul><li><a href="#474__1572">4.7.4 闭</a></li><ul><li><a href="#_1574">原理</a></li><li><a href="#_1578">效果</a></li></ul><li><a href="#475__1599">4.7.5 顶帽</a></li><ul><li><a href="#_1601">原理</a></li><li><a href="#_1605">效果</a></li></ul><li><a href="#476__1626">4.7.6 黑帽</a></li><ul><li><a href="#_1628">原理</a></li><li><a href="#_1632">效果</a></li></ul><li><a href="#477__1653">4.7.7 形态学梯度</a></li><ul><li><a href="#_1655">原理</a></li><li><a href="#_1659">效果</a></li></ul><li><a href="#478__1680">4.7.8 击中击不中变换</a></li><ul><li><a href="#_1682">原理</a></li></ul></ul><li><a href="#48__1708">4.8 边缘检测：选择合适的输出深度</a></li><ul><li><a href="#481_normalize_1718">4.8.1 normalize归一化函数</a></li><ul><li><a href="#_1738">归一化类型（只介绍常用的四种）</a></li></ul><li><a href="#482_convertScaleAbs_1766">4.8.2 convertScaleAbs绝对值化</a></li></ul><li><a href="#49_sobel_1777">4.9 sobel（对灰度图）</a></li><ul><li><a href="#491_ksize3_1779">4.9.1 卷积核形状（ksize=3）</a></li><li><a href="#492_API_1790">4.9.2 API</a></li><li><a href="#493__1817">4.9.3 流程</a></li><li><a href="#494_xySobel_1824">4.9.4 同时在x,y方向上调用Sobel和分开调用的效果对比</a></li></ul><li><a href="#410_scharr_1855">4.10 scharr（对灰度图）</a></li><ul><li><a href="#4101_ksize3_1857">4.10.1 卷积核形状（ksize恒定为3）</a></li><li><a href="#4102_API_1870">4.10.2 API</a></li><li><a href="#4103__1894">4.10.3 流程</a></li></ul><li><a href="#411_Laplacian_1901">4.11 Laplacian（对灰度图）</a></li><ul><li><a href="#4111_ksize3_1903">4.11.1 卷积核形状（ksize=3）</a></li><li><a href="#4112_API_1913">4.11.2 API</a></li><li><a href="#4113__1933">4.11.3 流程</a></li></ul><li><a href="#412_Cannyrecommended_1940">4.12 Canny（recommended）</a></li><ul><li><a href="#4121_API_1942">4.12.1 API</a></li><li><a href="#4122__1964">4.12.2 流程</a></li><li><a href="#4123__1969">4.12.3 效果</a></li></ul><li><a href="#413__1982">4.13 添加噪声</a></li><ul><li><a href="#4131__1984">4.13.1 椒盐噪声</a></li><li><a href="#4132__2018">4.13.2 高斯噪声</a></li><ul><li><a href="#_2036">随机数填充矩阵</a></li></ul></ul></ul><li><a href="#5_2046">5.画几何图形</a></li><ul><li><a href="#51__2047">5.1 直线</a></li><ul><li><a href="#511_API_2048">5.1.1 API</a></li><li><a href="#512_2068">5.1.2连通类型</a></li></ul><li><a href="#52__2081">5.2 正矩形</a></li><ul><li><a href="#521API_2083">5.2.1API</a></li></ul><li><a href="#53__2123">5.3 圆形</a></li><ul><li><a href="#531_API_2125">5.3.1 API</a></li></ul><li><a href="#54__2147">5.4 椭圆</a></li><ul><li><a href="#541_API_2149">5.4.1 API</a></li><li><a href="#542__2180">5.4.2 效果</a></li></ul><li><a href="#55__2209">5.5 斜矩形</a></li><ul><li><a href="#551_APIRotatedRectline_2211">5.5.1 API(通过RotatedRect类和line函数实现)</a></li></ul></ul><li><a href="#6Trackbar_2263">6.Trackbar控件</a></li><ul><li><a href="#61_createTrackbar_2265">6.1 createTrackbar创建滚动条</a></li><ul><li><a href="#611_API_2267">6.1.1 API</a></li></ul><li><a href="#62_getTrackbarPos_2292">6.2 getTrackbarPos获得滚动条当前的值</a></li><li><a href="#63_recommended_2302">6.3 使用方式一(recommended)</a></li><ul><li><a href="#631__2304">6.3.1 原理</a></li><li><a href="#632__2308">6.3.2 效果</a></li></ul><li><a href="#64__2330">6.4 使用方式二</a></li><ul><li><a href="#641__2332">6.4.1 原理</a></li><li><a href="#642__2336">6.4.2 效果</a></li></ul></ul><li><a href="#7_2380">7.轮廓检测（一般对二值图）</a></li><ul><li><a href="#71__2382">7.1 查找轮廓</a></li><ul><li><a href="#711_API_2384">7.1.1 API</a></li><li><a href="#712__2418">7.1.2 轮廓层级检测模式：索引号（层级）</a></li><ul><li><a href="#RETR_EXTERNAL_2429">RETR_EXTERNAL（索引顺序：从右下到左上）</a></li><li><a href="#RETR_LISTrecommended_2435">RETR_LIST(recommended)（索引顺序：从右下到左上，由外到内）</a></li><li><a href="#RETR_CCOMPnot_recommended_2441">RETR_CCOMP(not recommended)（索引顺序：由内到外，从右下到左上）</a></li><li><a href="#RETR_TREErecommended_2448">RETR_TREE(recommended)</a></li></ul><li><a href="#713__2455">7.1.3 轮廓坐标点储存方式</a></li></ul><li><a href="#72__2472">7.2 绘制轮廓</a></li><ul><li><a href="#721_API_2474">7.2.1 API</a></li></ul><li><a href="#73__2506">7.3 轮廓面积和周长</a></li><ul><li><a href="#731__2508">7.3.1 面积（非原地算法）</a></li><li><a href="#732_2523">7.3.2周长（非原地算法）</a></li></ul><li><a href="#74__2533">7.4 多边形逼近</a></li><li><a href="#75__2549">7.5 凸包</a></li><li><a href="#76__2564">7.6 外接矩形</a></li><ul><li><a href="#761RotatedRect_2566">7.6.1最小外接矩形（返回RotatedRect）</a></li><li><a href="#762Rect_2574">7.6.2最大外界矩形（返回Rect）</a></li></ul></ul><li><a href="#8_2581">8.特征工程</a></li><ul><li><a href="#81__2582">8.1 模板匹配</a></li><ul><li><a href="#811__2583">8.1.1 原理</a></li><li><a href="#812_API_2585">8.1.2 API</a></li><li><a href="#813__2600">8.1.3 模板匹配计算方法</a></li><li><a href="#814__2620">8.1.4 掩码的使用</a></li><ul><li><a href="#_2622">获得掩码</a></li></ul><li><a href="#815__2626">8.1.5 效果</a></li><li><a href="#815__2653">8.1.5 模板匹配的缺陷</a></li><ul><li><a href="#_2654">无法应对旋转</a></li><li><a href="#_2679">无法应对缩放</a></li></ul></ul><li><a href="#82_cornerHarris_2702">8.2 cornerHarris（对灰度图）</a></li><ul><li><a href="#821__2703">8.2.1 角点的描述</a></li><li><a href="#822_bolcksize2_2710">8.2.2 原理（前置知识要求：线性代数）(bolcksize=2的情况)</a></li><li><a href="#823_API_2740">8.2.3 API</a></li><li><a href="#824__2759">8.2.4 流程</a></li><li><a href="#825__2802">8.2.5 优点与缺点</a></li><ul><li><a href="#_2803">测试代码</a></li><li><a href="#_2854">图片旋转，角点不变</a></li><li><a href="#_2858">图片缩放，角点改变</a></li></ul></ul><li><a href="#83__ShiTomasi_2863">8.3  Shi-Tomasi（对灰度图）</a></li><ul><li><a href="#831__2864">8.3.1 原理</a></li><li><a href="#832_API_2868">8.3.2 API</a></li><li><a href="#833__2899">8.3.3 流程</a></li><li><a href="#834__2905">8.3.4 效果</a></li></ul><li><a href="#84_SIFTSURF_2951">8.4 SIFT与SURF（对灰度图）</a></li><ul><li><a href="#841__2952">8.4.1 概述</a></li><li><a href="#842_API_2956">8.4.2 API</a></li><ul><li><a href="#_2957">构造函数</a></li><li><a href="#_2973">进行关键点检测和描述子计算</a></li><li><a href="#drawKeypoints_3009">drawKeypoints绘制关键点</a></li></ul><li><a href="#843__3047">8.4.3 流程</a></li><li><a href="#844__3054">8.4.4 效果</a></li><ul><li><a href="#_3099">进行缩放和旋转</a></li></ul></ul><li><a href="#85_FASTOBR_3105">8.5 FAST到OBR（对灰度图）</a></li><ul><li><a href="#851__3106">8.5.1 概述</a></li><ul><li><a href="#FAST_3108">FAST原理</a></li><li><a href="#OBR_3124">OBR简介</a></li></ul><li><a href="#852_API_3128">8.5.2 API</a></li><ul><li><a href="#_3129">构造函数</a></li></ul><li><a href="#853__3139">8.5.3 流程</a></li><li><a href="#854__3144">8.5.4 效果</a></li><ul><li><a href="#threshold_3187">调整threshold</a></li><li><a href="#_3190">进行缩放和旋转</a></li><li><a href="#_3192">错误</a></li></ul></ul><li><a href="#86_BruteForceFLANN_3203">8.6 Brute-Force与FLANN特征匹配</a></li><ul><li><a href="#861__3204">8.6.1 概述</a></li><ul><li><a href="#BruteForce_3205">Brute-Force</a></li><li><a href="#FLANN_3211">FLANN</a></li></ul><li><a href="#862_API_3215">8.6.2 API</a></li><ul><li><a href="#_3216">构造函数</a></li><li><a href="#_3247">描述子匹配</a></li><li><a href="#BruteForceFLANN_3280">Brute-Force与FLANN对输入描述子的要求</a></li><li><a href="#drawMatches_3285">drawMatches绘制匹配结果</a></li></ul><li><a href="#863__3326">8.6.3 流程</a></li><li><a href="#864__3330">8.6.4 效果</a></li><ul><li><a href="#_3413">不进行比率筛选</a></li><li><a href="#_3417">进行比率筛选</a></li></ul></ul></ul><li><a href="#9_3422">9.结语与感谢</a></li></ul></div><p></p>
<hr>
<h1><a id="1_4"></a>1.数据类型</h1>
<p>CV_8U:占8位的unsigned</p>
<p>CV_8UC(n):占8位的unsigned char</p>
<p>CV_8UC1:占8位的unsigned char 一通道</p>
<p>CV_8UC2:占8位的unsigned char 二通道</p>
<p>CV_8UC3:占8位的unsigned char 三通道</p>
<p>CV_8UC4:占8位的unsigned char 四通道</p>
<p>CV_8S:占8位的signed</p>
<p>CV_8SC(n):占8位的signed char</p>
<p>CV_8SC1:占8位的signed char 一通道</p>
<p>CV_8SC2:占8位的signed char 二通道</p>
<p>CV_8SC3:占8位的signed char 三通道</p>
<p>CV_8SC4:占8位的signed char 四通道</p>
<p>CV_16U:占16位的unsigned</p>
<p>CV_16UC(n):占16位的unsigned char</p>
<p>CV_16UC1:占16位的unsigned char 一通道</p>
<p>CV_16U2:占16位的unsigned char 二通道</p>
<p>CV_16U3:占16位的unsigned char 三通道</p>
<p>CV_16U4:占16位的unsigned char 四通道</p>
<p>CV_16S:占16位的signed</p>
<p>CV_16SC(n):占16位的signed char</p>
<p>CV_16SC1:占16位的signed char 一通道</p>
<p>CV_16SC2:占16位的signed char 二通道</p>
<p>CV_16SC3:占16位的signed char 三通道</p>
<p>CV_16SC4:占16位的signed char 四通道</p>
<p>CV_16F:占16位的float</p>
<p>CV_16FC(n):占16位的float char</p>
<p>CV_16FC1:占16位的float char 一通道</p>
<p>CV_16FC2:占16位的float char 二通道</p>
<p>CV_16FC3:占16位的float char 三通道</p>
<p>CV_16FC4:占16位的float char 四通道</p>
<p>CV_32S:占32位的signed</p>
<p>CV_32SC(n):占32位的signed char</p>
<p>CV_32SC1:占32位的signed char 一通道</p>
<p>CV_32SC2:占32位的signed char 二通道</p>
<p>CV_32SC3:占32位的signed char 三通道</p>
<p>CV_32SC4:占32位的signed char 四通道</p>
<p>CV_32F:占32位的float</p>
<p>CV_32FC(n):占32位的float char</p>
<p>CV_32FC1:占32位的float char 一通道</p>
<p>CV_32FC2:占32位的float char 二通道</p>
<p>CV_32FC3:占32位的float char 三通道</p>
<p>CV_32FC4:占23位的float char 四通道</p>
<p>CV_64F:占64位的float</p>
<p>CV_64FC(n):占64位的float char</p>
<p>CV_64FC1:占64位的float char 一通道</p>
<p>CV_64FC2:占64位的float char 二通道</p>
<p>CV_64FC3:占64位的float char 三通道</p>
<p>CV_64FC4:占64位的float char 四通道</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/0db745ea6e64294aefefebc92c0147ca.png" alt=""></p>
<h1><a id="2_104"></a>2.矩阵基本操作</h1>
<h2><a id="21__106"></a>2.1 全零矩阵</h2>
<pre><code class="prism language-cpp">CV_NODISCARD_STD <span class="token keyword">static</span> MatExpr <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token keyword">int</span> rows<span class="token punctuation">,</span> <span class="token keyword">int</span> cols<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
CV_NODISCARD_STD <span class="token keyword">static</span> MatExpr <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">zeros</span><span class="token punctuation">(</span>Size size<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>

CV_NODISCARD_STD <span class="token keyword">static</span> MatExpr <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token keyword">int</span> ndims<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> sz<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//not recommended</span>
</code></pre>
<p>rows:行数</p>
<p>cols:列数</p>
<p>type:数据类型（CV_16F）</p>
<p>size:Size（宽（列数），高（行数））</p>
<ul>
<li>Size与Mat中的成员函数.size()的返回值，有相同的数据类型，是[宽*高]。</li>
<li>Mat中的成员变量.size，与以上二者不同，是 rows*cols</li>
</ul>
<h2><a id="22__127"></a>2.2 全一矩阵</h2>
<pre><code class="prism language-cpp">CV_NODISCARD_STD <span class="token keyword">static</span> MatExpr <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">ones</span><span class="token punctuation">(</span><span class="token keyword">int</span> rows<span class="token punctuation">,</span> <span class="token keyword">int</span> cols<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
CV_NODISCARD_STD <span class="token keyword">static</span> MatExpr <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">ones</span><span class="token punctuation">(</span>Size size<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>

CV_NODISCARD_STD <span class="token keyword">static</span> MatExpr <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">ones</span><span class="token punctuation">(</span><span class="token keyword">int</span> ndims<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> sz<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//not recommended</span>
</code></pre>
<p>rows:行数</p>
<p>cols:列数</p>
<p>type:数据类型（CV_16F）</p>
<p>size:Size（宽（列数），高（行数））</p>
<h2><a id="23__145"></a>2.3 单位矩阵</h2>
<pre><code class="prism language-cpp">CV_NODISCARD_STD <span class="token keyword">static</span> MatExpr <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">eye</span><span class="token punctuation">(</span><span class="token keyword">int</span> rows<span class="token punctuation">,</span> <span class="token keyword">int</span> cols<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
CV_NODISCARD_STD <span class="token keyword">static</span> MatExpr <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">eye</span><span class="token punctuation">(</span>Size size<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>rows:行数</p>
<p>cols:列数</p>
<p>type:数据类型（CV_16F）</p>
<p>size:Size（宽（列数），高（行数））</p>
<h2><a id="24__160"></a>2.4 矩阵转置</h2>
<pre><code class="prism language-cpp">MatExpr <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
</code></pre>
<h2><a id="25__166"></a>2.5 求逆矩阵</h2>
<pre><code class="prism language-cpp">MatExpr <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">inv</span><span class="token punctuation">(</span><span class="token keyword">int</span> method<span class="token operator">=</span>DECOMP_LU<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
</code></pre>
<h2><a id="26__172"></a>2.6 逗号式分隔创建矩阵，常用于自定义卷积核</h2>
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token operator">&gt;</span> <span class="token keyword">inline</span>
<span class="token class-name">Mat_</span><span class="token operator">&lt;</span>_Tp<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">Mat_</span><span class="token punctuation">(</span><span class="token keyword">int</span> _rows<span class="token punctuation">,</span> <span class="token keyword">int</span> _cols<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">Mat</span><span class="token punctuation">(</span>_rows<span class="token punctuation">,</span> _cols<span class="token punctuation">,</span> traits<span class="token double-colon punctuation">::</span>Type<span class="token operator">&lt;</span>_Tp<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token operator">&gt;</span> <span class="token keyword">inline</span>
<span class="token class-name">Mat_</span><span class="token operator">&lt;</span>_Tp<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">Mat_</span><span class="token punctuation">(</span><span class="token keyword">int</span> _rows<span class="token punctuation">,</span> <span class="token keyword">int</span> _cols<span class="token punctuation">,</span> <span class="token keyword">const</span> _Tp<span class="token operator">&amp;</span> value<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">Mat</span><span class="token punctuation">(</span>_rows<span class="token punctuation">,</span> _cols<span class="token punctuation">,</span> traits<span class="token double-colon punctuation">::</span>Type<span class="token operator">&lt;</span>_Tp<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token operator">*</span><span class="token keyword">this</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token operator">&gt;</span> <span class="token keyword">inline</span>
<span class="token class-name">Mat_</span><span class="token operator">&lt;</span>_Tp<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">Mat_</span><span class="token punctuation">(</span>Size _sz<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">Mat</span><span class="token punctuation">(</span>_sz<span class="token punctuation">.</span>height<span class="token punctuation">,</span> _sz<span class="token punctuation">.</span>width<span class="token punctuation">,</span> traits<span class="token double-colon punctuation">::</span>Type<span class="token operator">&lt;</span>_Tp<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token operator">&gt;</span> <span class="token keyword">inline</span>
<span class="token class-name">Mat_</span><span class="token operator">&lt;</span>_Tp<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">Mat_</span><span class="token punctuation">(</span>Size _sz<span class="token punctuation">,</span> <span class="token keyword">const</span> _Tp<span class="token operator">&amp;</span> value<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">Mat</span><span class="token punctuation">(</span>_sz<span class="token punctuation">.</span>height<span class="token punctuation">,</span> _sz<span class="token punctuation">.</span>width<span class="token punctuation">,</span> traits<span class="token double-colon punctuation">::</span>Type<span class="token operator">&lt;</span>_Tp<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token operator">*</span><span class="token keyword">this</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>以下为使用实例</p>
<pre><code>Mat a=Mat_&lt;int&gt;(2,2)&lt;&lt;(1,2,3,4);
Mat b=Mat_&lt;double&gt;(Size(2,2))&lt;&lt;(1,2,3,4);
</code></pre>
<p><strong>注意</strong> ：给出的数据类型必须是基本数据类型，如int,double。不能是CV_16F等。</p>
<h2><a id="27__210"></a>2.7 矩阵定义(只列出常用的)</h2>
<pre><code class="prism language-cpp"><span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> CV_NOEXCEPT<span class="token punctuation">;</span>
<span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">Mat</span><span class="token punctuation">(</span><span class="token keyword">int</span> rows<span class="token punctuation">,</span> <span class="token keyword">int</span> cols<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">Mat</span><span class="token punctuation">(</span>Size size<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">Mat</span><span class="token punctuation">(</span><span class="token keyword">int</span> rows<span class="token punctuation">,</span> <span class="token keyword">int</span> cols<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">,</span> <span class="token keyword">const</span> Scalar<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">Mat</span><span class="token punctuation">(</span>Size size<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">,</span> <span class="token keyword">const</span> Scalar<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">Mat</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> sizes<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">Mat</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> sizes<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">,</span> <span class="token keyword">const</span> Scalar<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">Mat</span><span class="token punctuation">(</span><span class="token keyword">const</span> Mat<span class="token operator">&amp;</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">int</span> rows<span class="token punctuation">,</span> <span class="token keyword">int</span> cols<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span>Size size<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> sizes<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>rows:行数</p>
<p>cols:列数</p>
<p>type:数据类型（CV_16F）</p>
<p>size:Size（宽（列数），高（行数））</p>
<h3><a id="271_Scalar_235"></a>2.7.1 数据类型Scalar</h3>
<ul>
<li>Scalar(gray)</li>
<li>Scalar(blue,green,red)</li>
</ul>
<h2><a id="28_ptrat_240"></a>2.8 通过ptr与at函数遍历矩阵</h2>
<h3><a id="281_Vec_242"></a>2.8.1 Vec类型</h3>
<pre><code class="prism language-cpp"><span class="token keyword">typedef</span> Vec<span class="token operator">&lt;</span>uchar<span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">&gt;</span> Vec2b<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> Vec<span class="token operator">&lt;</span>uchar<span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">&gt;</span> Vec3b<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> Vec<span class="token operator">&lt;</span>uchar<span class="token punctuation">,</span> <span class="token number">4</span><span class="token operator">&gt;</span> Vec4b<span class="token punctuation">;</span>
 
<span class="token keyword">typedef</span> Vec<span class="token operator">&lt;</span><span class="token keyword">short</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">&gt;</span> Vec2s<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> Vec<span class="token operator">&lt;</span><span class="token keyword">short</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">&gt;</span> Vec3s<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> Vec<span class="token operator">&lt;</span><span class="token keyword">short</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token operator">&gt;</span> Vec4s<span class="token punctuation">;</span>
 
<span class="token keyword">typedef</span> Vec<span class="token operator">&lt;</span>ushort<span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">&gt;</span> Vec2w<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> Vec<span class="token operator">&lt;</span>ushort<span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">&gt;</span> Vec3w<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> Vec<span class="token operator">&lt;</span>ushort<span class="token punctuation">,</span> <span class="token number">4</span><span class="token operator">&gt;</span> Vec4w<span class="token punctuation">;</span>
 
<span class="token keyword">typedef</span> Vec<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">&gt;</span> Vec2i<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> Vec<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">&gt;</span> Vec3i<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> Vec<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token operator">&gt;</span> Vec4i<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> Vec<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token operator">&gt;</span> Vec6i<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> Vec<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token operator">&gt;</span> Vec8i<span class="token punctuation">;</span>
 
<span class="token keyword">typedef</span> Vec<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">&gt;</span> Vec2f<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> Vec<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">&gt;</span> Vec3f<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> Vec<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token operator">&gt;</span> Vec4f<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> Vec<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token operator">&gt;</span> Vec6f<span class="token punctuation">;</span>
 
<span class="token keyword">typedef</span> Vec<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">&gt;</span> Vec2d<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> Vec<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">&gt;</span> Vec3d<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> Vec<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token operator">&gt;</span> Vec4d<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> Vec<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token operator">&gt;</span> Vec6d<span class="token punctuation">;</span>
</code></pre>
<p>以下为实例</p>
<pre><code class="prism language-cpp">Mat <span class="token function">a</span><span class="token punctuation">(</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">2560</span><span class="token punctuation">,</span><span class="token number">1440</span><span class="token punctuation">)</span><span class="token punctuation">,</span>CV_8UC3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>a<span class="token punctuation">.</span>rows<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>a<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          a<span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
          a<span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
          a<span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>a<span class="token punctuation">.</span>rows<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>a<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          a<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">ptr</span><span class="token generic class-name"><span class="token operator">&lt;</span>Vec3b<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
          a<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">ptr</span><span class="token generic class-name"><span class="token operator">&lt;</span>Vec3b<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
          a<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">ptr</span><span class="token generic class-name"><span class="token operator">&lt;</span>Vec3b<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>a<span class="token punctuation">.</span>rows<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>a<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          a<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>Vec3b<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
          a<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>Vec3b<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
          a<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>Vec3b<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>用ptr访问可以不加Vec类型，<strong>ptr访问是最快的</strong></li>
<li>用at访问必须加Vec类型，<strong>at访问比ptr略微慢一些</strong></li>
</ul>
<h2><a id="29_easy_but_very_very_slow_304"></a>2.9 通过迭代器遍历矩阵(easy but very very slow)</h2>
<pre><code class="prism language-cpp">Mat <span class="token function">a</span><span class="token punctuation">(</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">2560</span><span class="token punctuation">,</span><span class="token number">1440</span><span class="token punctuation">)</span><span class="token punctuation">,</span>CV_8UC3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> iter<span class="token operator">=</span>a<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">begin</span><span class="token generic class-name"><span class="token operator">&lt;</span>Vec3b<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>iter<span class="token operator">!=</span>a<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">end</span><span class="token generic class-name"><span class="token operator">&lt;</span>Vec3b<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>iter<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      iter<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">;</span>
      iter<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      iter<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h1><a id="3_315"></a>3.图像基本操作</h1>
<h2><a id="31__317"></a>3.1 图片读取</h2>
<pre><code class="prism language-cpp">CV_EXPORTS_W Mat <span class="token function">imread</span><span class="token punctuation">(</span> <span class="token keyword">const</span> String<span class="token operator">&amp;</span> filename<span class="token punctuation">,</span> <span class="token keyword">int</span> flags <span class="token operator">=</span> IMREAD_COLOR <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">enum</span> <span class="token class-name">ImreadModes</span> <span class="token punctuation">{</span>

       IMREAD_UNCHANGED            <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> 
<span class="token comment">//!&lt; If set, return the loaded image as is (with alpha channel, otherwise it gets cropped). Ignore EXIF orientation.</span>

       IMREAD_GRAYSCALE            <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>  
<span class="token comment">//!&lt; If set, always convert image to the single channel grayscale image (codec internal conversion).</span>

       IMREAD_COLOR                <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>  
<span class="token comment">//!&lt; If set, always convert image to the 3 channel BGR color image.</span>

       IMREAD_ANYDEPTH             <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>  
<span class="token comment">//!&lt; If set, return 16-bit/32-bit image when the input has the corresponding depth, otherwise convert it to 8-bit.</span>

       IMREAD_ANYCOLOR             <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span>  
<span class="token comment">//!&lt; If set, the image is read in any possible color format.</span>

       IMREAD_LOAD_GDAL            <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span>  
<span class="token comment">//!&lt; If set, use the gdal driver for loading the image.</span>

       IMREAD_REDUCED_GRAYSCALE_2  <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span> 
<span class="token comment">//!&lt; If set, always convert image to the single channel grayscale image and the image size reduced 1/2.</span>

       IMREAD_REDUCED_COLOR_2      <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">,</span> 
<span class="token comment">//!&lt; If set, always convert image to the 3 channel BGR color image and the image size reduced 1/2.</span>

       IMREAD_REDUCED_GRAYSCALE_4  <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">,</span> 
<span class="token comment">//!&lt; If set, always convert image to the single channel grayscale image and the image size reduced 1/4.</span>

       IMREAD_REDUCED_COLOR_4      <span class="token operator">=</span> <span class="token number">33</span><span class="token punctuation">,</span> 
<span class="token comment">//!&lt; If set, always convert image to the 3 channel BGR color image and the image size reduced 1/4.</span>

       IMREAD_REDUCED_GRAYSCALE_8  <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">,</span> 
<span class="token comment">//!&lt; If set, always convert image to the single channel grayscale image and the image size reduced 1/8.</span>

       IMREAD_REDUCED_COLOR_8      <span class="token operator">=</span> <span class="token number">65</span><span class="token punctuation">,</span> 
<span class="token comment">//!&lt; If set, always convert image to the 3 channel BGR color image and the image size reduced 1/8.</span>

       IMREAD_IGNORE_ORIENTATION   <span class="token operator">=</span> <span class="token number">128</span> 
<span class="token comment">//!&lt; If set, do not rotate the image according to EXIF's orientation flag.</span>
     <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h2><a id="32__364"></a>3.2 创建窗口</h2>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token keyword">const</span> String<span class="token operator">&amp;</span> winname<span class="token punctuation">,</span> <span class="token keyword">int</span> flags <span class="token operator">=</span> WINDOW_AUTOSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>winname(window name)：窗体名</p>
<h2><a id="33__372"></a>3.3 图片显示</h2>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token keyword">const</span> String<span class="token operator">&amp;</span> winname<span class="token punctuation">,</span> InputArray mat<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>winname(window name)：窗体名</p>
<p>若窗体未创建，会自动进行创建</p>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">int</span> <span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token keyword">int</span> delay <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>控制图片的展示时间，如设置delay=0，则表示一直展示，按SPACE停止展示</p>
<p>如设置delay不为0，则表示停留delay毫秒</p>
<h2><a id="34__390"></a>3.4 图片保存</h2>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">bool</span> <span class="token function">imwrite</span><span class="token punctuation">(</span> <span class="token keyword">const</span> String<span class="token operator">&amp;</span> filename<span class="token punctuation">,</span> InputArray img<span class="token punctuation">,</span>
              <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> params <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>filename：保存的文件名</p>
<h2><a id="35__399"></a>3.5 视频输入输出</h2>
<pre><code class="prism language-cpp">CV_WRAP <span class="token keyword">explicit</span> <span class="token class-name">VideoCapture</span><span class="token double-colon punctuation">::</span><span class="token function">VideoCapture</span><span class="token punctuation">(</span><span class="token keyword">const</span> String<span class="token operator">&amp;</span> filename<span class="token punctuation">,</span> <span class="token keyword">int</span> apiPreference <span class="token operator">=</span> CAP_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
CV_WRAP <span class="token keyword">explicit</span> <span class="token class-name">VideoCapture</span><span class="token double-colon punctuation">::</span><span class="token function">VideoCapture</span><span class="token punctuation">(</span><span class="token keyword">const</span> String<span class="token operator">&amp;</span> filename<span class="token punctuation">,</span> <span class="token keyword">int</span> apiPreference<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>

CV_WRAP <span class="token keyword">explicit</span> <span class="token class-name">VideoCapture</span><span class="token double-colon punctuation">::</span><span class="token function">VideoCapture</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token keyword">int</span> apiPreference <span class="token operator">=</span> CAP_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>

CV_WRAP <span class="token keyword">explicit</span> <span class="token class-name">VideoCapture</span><span class="token double-colon punctuation">::</span><span class="token function">VideoCapture</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token keyword">int</span> apiPreference<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>

CV_WRAP <span class="token class-name">VideoWriter</span><span class="token double-colon punctuation">::</span><span class="token function">VideoWriter</span><span class="token punctuation">(</span><span class="token keyword">const</span> String<span class="token operator">&amp;</span> filename<span class="token punctuation">,</span> <span class="token keyword">int</span> fourcc<span class="token punctuation">,</span> <span class="token keyword">double</span> fps<span class="token punctuation">,</span>Size frameSize<span class="token punctuation">,</span> <span class="token keyword">bool</span> isColor <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

CV_WRAP <span class="token class-name">VideoWriter</span><span class="token double-colon punctuation">::</span><span class="token function">VideoWriter</span><span class="token punctuation">(</span><span class="token keyword">const</span> String<span class="token operator">&amp;</span> filename<span class="token punctuation">,</span> <span class="token keyword">int</span> fourcc<span class="token punctuation">,</span> <span class="token keyword">double</span> fps<span class="token punctuation">,</span> <span class="token keyword">const</span> Size<span class="token operator">&amp;</span> frameSize<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>

CV_WRAP <span class="token class-name">VideoWriter</span><span class="token double-colon punctuation">::</span><span class="token function">VideoWriter</span><span class="token punctuation">(</span><span class="token keyword">const</span> String<span class="token operator">&amp;</span> filename<span class="token punctuation">,</span> <span class="token keyword">int</span> apiPreference<span class="token punctuation">,</span> <span class="token keyword">int</span> fourcc<span class="token punctuation">,</span> <span class="token keyword">double</span> fps<span class="token punctuation">,</span><span class="token keyword">const</span> Size<span class="token operator">&amp;</span> frameSize<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//fps:帧率</span>
<span class="token comment">//frameSize：输出视频中每一帧的尺寸</span>
</code></pre>
<h3><a id="351_filename_420"></a>3.5.1 filename</h3>
<p>影片档案名称（例如video.avi）</p>
<p>图片序列（例如img_%02d.jpg，将读取像这样的样本img_00.jpg, img_01.jpg, img_02.jpg, …）</p>
<p>视频流的网址（例如protocol://host:port/script_name?script_params|auth）。请注意，每个视频流或IP摄像机源均具有其自己的URL方案。请参考源流的文档以了解正确的URL。</p>
<h3><a id="352_index_428"></a>3.5.2 index</h3>
<p><strong>要打开的视频捕获设备的ID</strong>。要使用默认后端打开默认摄像头，只需传递0。</p>
<p>当apiPreference为CAP_ANY时，使用camera_id + domain_offset（CAP_ *）向后兼容有效。</p>
<h3><a id="353_fourcc_434"></a>3.5.3 fourcc</h3>
<p>用于编码视频文件的编码器，通过VideoWriter::fourcc函数获得</p>
<pre><code class="prism language-cpp">    CV_WRAP <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">fourcc</span><span class="token punctuation">(</span><span class="token keyword">char</span> c1<span class="token punctuation">,</span> <span class="token keyword">char</span> c2<span class="token punctuation">,</span> <span class="token keyword">char</span> c3<span class="token punctuation">,</span> <span class="token keyword">char</span> c4<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>

<table>
<thead>
<tr>
<th>代码</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>VideoWriter::fourcc(‘P’,‘I’,‘M’,‘1’)</td>
<td>MPEG-1编码，输出文件拓展名avi</td>
</tr>
<tr>
<td>VideoWriter::fourcc(‘X’,‘V’,‘I’,‘D’)</td>
<td>MPEG-4编码，输出文件拓展名avi</td>
</tr>
<tr>
<td>VideoWriter::fourcc(‘M’,‘P’,‘4’,‘V’)</td>
<td>旧MPEG-4编码，输出文件拓展名avi</td>
</tr>
<tr>
<td>VideoWriter::fourcc(‘I’,‘4’,‘2’,‘0’)</td>
<td>YUV编码，输出文件拓展名avi</td>
</tr>
<tr>
<td>VideoWriter::fourcc(‘X’,‘2’,‘6’,‘4’)</td>
<td>MPEG-4编码，输出文件拓展名mp4</td>
</tr>
<tr>
<td>VideoWriter::fourcc(‘T’,‘H’,‘E’,‘O’)</td>
<td>ogg vorbis编码，输出文件拓展名ogv</td>
</tr>
<tr>
<td>VideoWriter::fourcc(‘F’,L’,‘V’,‘1’)</td>
<td>flash video编码，输出文件拓展名flv</td>
</tr>
</tbody>
</table><h3><a id="354_apiPreferencenot__important_450"></a>3.5.4 apiPreference（not  important）</h3>
<p>首选使用的Capture API后端。如果有多个可用的读取器实现，则可以用于实施特定的读取器实现。</p>
<p>设置读取的摄像头编号，默认CAP_ANY=0,自动检测摄像头。多个摄像头时，使用索引0,1,2，…进行编号调用摄像头。 apiPreference = -1时单独出现窗口，选取相应编号摄像头。</p>
<h3><a id="355__456"></a>3.5.5 演示</h3>
<pre><code class="prism language-cpp">VideoCapture <span class="token function">video</span><span class="token punctuation">(</span><span class="token string">"demo.mp4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Mat fps<span class="token punctuation">;</span>
video<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>fps<span class="token punctuation">)</span><span class="token punctuation">;</span>
VideoWriter <span class="token function">video_out</span><span class="token punctuation">(</span><span class="token string">"demo_out.avi"</span><span class="token punctuation">,</span><span class="token class-name">VideoWriter</span><span class="token double-colon punctuation">::</span><span class="token function">fourcc</span><span class="token punctuation">(</span><span class="token char">'P'</span><span class="token punctuation">,</span><span class="token char">'I'</span><span class="token punctuation">,</span><span class="token char">'M'</span><span class="token punctuation">,</span><span class="token char">'1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span>fps<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        Mat fps<span class="token punctuation">;</span>
        video<span class="token operator">&gt;&gt;</span>fps<span class="token punctuation">;</span>
        <span class="token comment">//video.read(fps);</span>
        fps<span class="token operator">&gt;&gt;</span>video_out<span class="token punctuation">;</span>
        <span class="token comment">//video_out.write(fps);</span>
        <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"video"</span><span class="token punctuation">,</span>fps<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//控制帧率</span>
    <span class="token punctuation">}</span>
</code></pre>
<h2><a id="36__474"></a>3.6 通道分离与合并</h2>
<h3><a id="361__476"></a>3.6.1 分离</h3>
<h4><a id="API_478"></a>API（一）</h4>
<pre><code class="prism language-cpp">CV_EXPORTS <span class="token keyword">void</span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token keyword">const</span> Mat<span class="token operator">&amp;</span> src<span class="token punctuation">,</span> Mat<span class="token operator">*</span> mvbegin<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src(source)：输入图像。</p>
<p>mvbegin(mat vector begin)：分离后的Mat数组。</p>
<h4><a id="API_488"></a>API（二）</h4>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">split</span><span class="token punctuation">(</span>InputArray m<span class="token punctuation">,</span> OutputArrayOfArrays mv<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>m(mat)：输入图像。</p>
<p>mv(mat vector)：分离后的的Mat数组，<strong>可以使用STL容器vector。</strong></p>
<h3><a id="362__498"></a>3.6.2 合并</h3>
<h4><a id="API_500"></a>API（一）</h4>
<pre><code class="prism language-cpp">CV_EXPORTS <span class="token keyword">void</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token keyword">const</span> Mat<span class="token operator">*</span> mv<span class="token punctuation">,</span> size_t count<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>mv(mat vector)：欲合并的图像数组。</p>
<p>count：欲合并的图像的个数</p>
<p>dst(destination)：输出图片。</p>
<h4><a id="API_512"></a>API（二）</h4>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">merge</span><span class="token punctuation">(</span>InputArrayOfArrays mv<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>mv(mat vector)：欲合并的图像数组，<strong>可以使用STL容器vector。</strong></p>
<p>dst(destination)：输出图片。</p>
<h2><a id="37__522"></a>3.7 图片色彩模式转换</h2>
<h3><a id="371_API_523"></a>3.7.1 API</h3>
<pre><code>CV_EXPORTS_W void cvtColor( InputArray src, OutputArray dst, int code, int dstCn = 0 );
</code></pre>
<p>code：转换码</p>
<h3><a id="372__530"></a>3.7.2 转换类型和转换码</h3>
<ul>
<li>RGB和BGR（opencv默认的彩色图像的颜色空间是BGR）颜色空间的转换</li>
</ul>
<p>cv::COLOR_BGR2RGB</p>
<p>cv::COLOR_RGB2BGR</p>
<p>cv::COLOR_RGBA2BGRA</p>
<p>cv::COLOR_BGRA2RGBA</p>
<ul>
<li>向RGB和BGR图像中增添alpha通道</li>
</ul>
<p>cv::COLOR_RGB2RGBA</p>
<p>cv::COLOR_BGR2BGRA</p>
<ul>
<li>从RGB和BGR图像中去除alpha通道</li>
</ul>
<p>cv::COLOR_RGBA2RGB</p>
<p>cv::COLOR_BGRA2BGR</p>
<ul>
<li>从RBG和BGR颜色空间转换到灰度空间</li>
</ul>
<p>cv::COLOR_RGB2GRAY</p>
<p>cv::COLOR_BGR2GRAY</p>
<p>cv::COLOR_RGBA2GRAY</p>
<p>cv::COLOR_BGRA2GRAY</p>
<ul>
<li>从灰度空间转换到RGB和BGR颜色空间</li>
</ul>
<p>cv::COLOR_GRAY2RGB</p>
<p>cv::COLOR_GRAY2BGR</p>
<p>cv::COLOR_GRAY2RGBA</p>
<p>cv::COLOR_GRAY2BGRA</p>
<ul>
<li>RGB和BGR颜色空间与BGR565颜色空间之间的转换</li>
</ul>
<p>cv::COLOR_RGB2BGR565</p>
<p>cv::COLOR_BGR2BGR565</p>
<p>cv::COLOR_BGR5652RGB</p>
<p>cv::COLOR_BGR5652BGR</p>
<p>cv::COLOR_RGBA2BGR565</p>
<p>cv::COLOR_BGRA2BGR565</p>
<p>cv::COLOR_BGR5652RGBA</p>
<p>cv::COLOR_BGR5652BGRA</p>
<ul>
<li>灰度空间与BGR565之间的转换</li>
</ul>
<p>cv::COLOR_GRAY2BGR555</p>
<p>cv::COLOR_BGR5552GRAY</p>
<ul>
<li>RGB和BGR颜色空间与CIE XYZ之间的转换</li>
</ul>
<p>cv::COLOR_RGB2XYZ</p>
<p>cv::COLOR_BGR2XYZ</p>
<p>cv::COLOR_XYZ2RGB</p>
<p>cv::COLOR_XYZ2BGR</p>
<ul>
<li>RGB和BGR颜色空间与uma色度（YCrCb空间）之间的转换</li>
</ul>
<p>cv::COLOR_RGB2YCrCb</p>
<p>cv::COLOR_BGR2YCrCb</p>
<p>cv::COLOR_YCrCb2RGB</p>
<p>cv::COLOR_YCrCb2BGR</p>
<ul>
<li>RGB和BGR颜色空间与HSV颜色空间之间的相互转换</li>
</ul>
<p>cv::COLOR_RGB2HSV</p>
<p>cv::COLOR_BGR2HSV</p>
<p>cv::COLOR_HSV2RGB</p>
<p>cv::COLOR_HSV2BGR</p>
<ul>
<li>RGB和BGR颜色空间与HLS颜色空间之间的相互转换</li>
</ul>
<p>cv::COLOR_RGB2HLS</p>
<p>cv::COLOR_BGR2HLS</p>
<p>cv::COLOR_HLS2RGB</p>
<p>cv::COLOR_HLS2BGR</p>
<ul>
<li>RGB和BGR颜色空间与CIE Lab颜色空间之间的相互转换</li>
</ul>
<p>cv::COLOR_RGB2Lab</p>
<p>cv::COLOR_BGR2Lab</p>
<p>cv::COLOR_Lab2RGB</p>
<p>cv::COLOR_Lab2BGR</p>
<ul>
<li>RGB和BGR颜色空间与CIE Luv颜色空间之间的相互转换</li>
</ul>
<p>cv::COLOR_RGB2Luv</p>
<p>cv::COLOR_BGR2Luv</p>
<p>cv::COLOR_Luv2RGB</p>
<p>cv::COLOR_Luv2BGR</p>
<ul>
<li>Bayer格式（raw data）向RGB或BGR颜色空间的转换</li>
</ul>
<p>cv::COLOR_BayerBG2RGB</p>
<p>cv::COLOR_BayerGB2RGB</p>
<p>cv::COLOR_BayerRG2RGB</p>
<p>cv::COLOR_BayerGR2RGB</p>
<p>cv::COLOR_BayerBG2BGR</p>
<p>cv::COLOR_BayerGB2BGR</p>
<p>cv::COLOR_BayerRG2BGR</p>
<p>cv::COLOR_BayerGR2BGR</p>
<h2><a id="38__676"></a>3.8 改变图片的对比度和亮度</h2>
<h3><a id="381__678"></a>3.8.1 概述</h3>
<pre><code class="prism language-cpp">Mat<span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token operator">=</span>Mat<span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token operator">*</span>a<span class="token operator">+</span>b
</code></pre>
<p>a：控制对比度增益</p>
<p>b：控制亮度增益</p>
<h3><a id="382_saturate_cast_688"></a>3.8.2 手动（使用saturate_cast函数确保输出值不溢出范围）</h3>
<pre><code class="prism language-cpp">Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span> xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>xuenai<span class="token punctuation">.</span>rows<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>xuenai<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>k<span class="token operator">&lt;</span>xuenai<span class="token punctuation">.</span><span class="token function">channels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                xuenai<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>Vec3b<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">saturate_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>Vec3b<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">*</span>                 <span class="token number">1.2</span> <span class="token operator">+</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_convertTo"</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/9b2596c3d34b202dce725c0c5a9dba15.png" alt=""></p>
<h3><a id="383_APIMatconvertTo_706"></a>3.8.3 调用API：Mat::convertTo</h3>
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">convertTo</span><span class="token punctuation">(</span> OutputArray m<span class="token punctuation">,</span> <span class="token keyword">int</span> rtype<span class="token punctuation">,</span> <span class="token keyword">double</span> alpha<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">double</span> beta<span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
</code></pre>
<pre><code>Mat xuenai = imread("xuenai.jpg");
imshow("xuenai", xuenai);
xuenai.convertTo(xuenai,-1,1.2,30);
imshow("xuenai_convertTo",xuenai);
waitKey();
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/7745ecb5a494f7742ce8ca6d1acda14f.png" alt=""></p>
<p>可以看到效果是一样的</p>
<h2><a id="39__724"></a>3.9 图片混合</h2>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">addWeighted</span><span class="token punctuation">(</span>InputArray src1<span class="token punctuation">,</span> <span class="token keyword">double</span> alpha<span class="token punctuation">,</span> InputArray src2<span class="token punctuation">,</span>
                              <span class="token keyword">double</span> beta<span class="token punctuation">,</span> <span class="token keyword">double</span> gamma<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">,</span> <span class="token keyword">int</span> dtype <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src(source1)：输入图片1</p>
<p>alpha：src1的权重</p>
<p>src2(source2)：输入图片2</p>
<p>beta：src2的权重</p>
<p>gamma：额外的增量</p>
<p>dst(destination)：输出图片</p>
<p>dtype(destination type)：输出图片的数据类型，-1表示与输入图片一致</p>
<h2><a id="310__745"></a>3.10 图片尺寸调整</h2>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">resize</span><span class="token punctuation">(</span> InputArray src<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">,</span>
                          Size dsize<span class="token punctuation">,</span> <span class="token keyword">double</span> fx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">double</span> fy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
                          <span class="token keyword">int</span> interpolation <span class="token operator">=</span> INTER_LINEAR <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src(source)：输入图片</p>
<p>dst(destination)：输出图片</p>
<p>dsize(destination size)：输出图片的尺寸</p>
<p>fx：x方向(width方向)的缩放比例，如果它是0，那么它就会按照(double)dsize.width/src.cols来计算；</p>
<p>fy：y方向(height方向)的缩放比例，如果它是0，那么它就会按照(double)dsize.height/src.rows来计算；</p>
<p>interpolation：插值算法的选择</p>
<h3><a id="3101_not_important_765"></a>3.10.1 插值算法(not important)</h3>
<pre><code class="prism language-cpp"><span class="token keyword">enum</span> <span class="token class-name">InterpolationFlags</span><span class="token punctuation">{</span>
    <span class="token comment">/** nearest neighbor interpolation */</span>
    INTER_NEAREST        <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token comment">/** bilinear interpolation */</span>
    INTER_LINEAR         <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token comment">/** bicubic interpolation */</span>
    INTER_CUBIC          <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token comment">/** resampling using pixel area relation. It may be a preferred method for image decimation, as
    it gives moire'-free results. But when the image is zoomed, it is similar to the INTER_NEAREST
    method. */</span>
    INTER_AREA           <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token comment">/** Lanczos interpolation over 8x8 neighborhood */</span>
    INTER_LANCZOS4       <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token comment">/** Bit exact bilinear interpolation */</span>
    INTER_LINEAR_EXACT <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token comment">/** Bit exact nearest neighbor interpolation. This will produce same results as
    the nearest neighbor method in PIL, scikit-image or Matlab. */</span>
    INTER_NEAREST_EXACT  <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span>
    <span class="token comment">/** mask for interpolation codes */</span>
    INTER_MAX            <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">,</span>
    <span class="token comment">/** flag, fills all of the destination image pixels. If some of them correspond to outliers in the
    source image, they are set to zero */</span>
    WARP_FILL_OUTLIERS   <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span>
    <span class="token comment">/** flag, inverse transformation

    For example, #linearPolar or #logPolar transforms:
    - flag is __not__ set: \f$dst( \rho , \phi ) = src(x,y)\f$
    - flag is set: \f$dst(x,y) = src( \rho , \phi )\f$
    */</span>
    WARP_INVERSE_MAP     <span class="token operator">=</span> <span class="token number">16</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h3><a id="3102__801"></a>3.10.2 注意事项</h3>
<p>使用注意事项：</p>
<ul>
<li>dsize和fx/fy不能同时为0</li>
</ul>
<ol>
<li>指定dsize的值，让fx和fy空置直接使用默认值。</li>
<li>让dsize为0，指定好fx和fy的值，比如fx=fy=0.5，那么就相当于把原图两个方向缩小一倍。</li>
</ol>
<h2><a id="311__810"></a>3.11 图像金字塔（常用于神经网络的池化层，对图像进行成倍的放大或缩小）</h2>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">pyrDown</span><span class="token punctuation">(</span> InputArray src<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">,</span>
                           <span class="token keyword">const</span> Size<span class="token operator">&amp;</span> dstsize <span class="token operator">=</span> <span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">int</span> borderType <span class="token operator">=</span> BORDER_DEFAULT <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//缩小一倍</span>
</code></pre>
<p>src(source)：输入图片</p>
<p>dst(destination)：输出图片</p>
<p>dstsize(destination size)：输出图片的尺寸，默认自动调整</p>
<p>borderType：边界填充方式，默认为黑边。如果没有设置dstsize，则不会出现黑边，因为已经进行了自动调整</p>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">pyrUp</span><span class="token punctuation">(</span> InputArray src<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">,</span>
                         <span class="token keyword">const</span> Size<span class="token operator">&amp;</span> dstsize <span class="token operator">=</span> <span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">int</span> borderType <span class="token operator">=</span> BORDER_DEFAULT <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//放大一倍</span>
</code></pre>
<p>src(source)：输入图片</p>
<p>dst(destination)：输出图片</p>
<p>dstsize(destination size)：输出图片的尺寸，默认自动调整</p>
<p>borderType：边界填充方式，默认为黑边。如果没有设置dstsize，则不会出现黑边，因为已经进行了自动调整</p>
<h2><a id="312__840"></a>3.12 二值化（对灰度图）</h2>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">double</span> <span class="token function">threshold</span><span class="token punctuation">(</span> InputArray src<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">,</span>
                               <span class="token keyword">double</span> thresh<span class="token punctuation">,</span> <span class="token keyword">double</span> maxval<span class="token punctuation">,</span> <span class="token keyword">int</span> type <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src(source)：输入图片</p>
<p>dst(destination)：输出图片</p>
<p>thresh(threshold)：阈值</p>
<p>maxval(max value)：最大值</p>
<p>type：阈值类型</p>
<h3><a id="3121__857"></a>3.12.1 阈值类型</h3>
<pre><code class="prism language-cpp"><span class="token keyword">enum</span> <span class="token class-name">ThresholdTypes</span> <span class="token punctuation">{</span>
    THRESH_BINARY     <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//!&lt; \f[\texttt{dst} (x,y) =  \fork{\texttt{maxval}}{if \(\texttt{src}(x,y) &gt; \texttt{thresh}\)}{0}{otherwise}\f]</span>
    THRESH_BINARY_INV <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//!&lt; \f[\texttt{dst} (x,y) =  \fork{0}{if \(\texttt{src}(x,y) &gt; \texttt{thresh}\)}{\texttt{maxval}}{otherwise}\f]</span>
    THRESH_TRUNC      <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">//!&lt; \f[\texttt{dst} (x,y) =  \fork{\texttt{threshold}}{if \(\texttt{src}(x,y) &gt; \texttt{thresh}\)}{\texttt{src}(x,y)}{otherwise}\f]</span>
    THRESH_TOZERO     <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">//!&lt; \f[\texttt{dst} (x,y) =  \fork{\texttt{src}(x,y)}{if \(\texttt{src}(x,y) &gt; \texttt{thresh}\)}{0}{otherwise}\f]</span>
    THRESH_TOZERO_INV <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">//!&lt; \f[\texttt{dst} (x,y) =  \fork{0}{if \(\texttt{src}(x,y) &gt; \texttt{thresh}\)}{\texttt{src}(x,y)}{otherwise}\f]</span>
    THRESH_MASK       <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">,</span>
    THRESH_OTSU       <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token comment">//!&lt; flag, use Otsu algorithm to choose the optimal threshold value</span>
    THRESH_TRIANGLE   <span class="token operator">=</span> <span class="token number">16</span> <span class="token comment">//!&lt; flag, use Triangle algorithm to choose the optimal threshold value</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h4><a id="Threshold_Binary_872"></a>阈值二值化（Threshold Binary）</h4>
<p>首先指定像素的灰度值的阈值，遍历图像中像素值，如果像素的灰度值大于这个阈值，则将这个像素设置为最大像素值(8位灰度值最大为255)；若像素的灰度值小于阈值，则将该像素点像素值赋值为0。公式以及示意图如下：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/ff06947279d2a3b26264114f05528468.webp?x-oss-process=image/format,png" alt=""></p>
<h4><a id="Threshold_Binary_Inverted_878"></a>阈值反二值化（Threshold Binary Inverted）</h4>
<p>首先也要指定一个阈值，不同的是在对图像进行阈值化操作时与阈值二值化相反，当像素的灰度值超过这个阈值的时候为该像素点赋值为0；当该像素的灰度值低于该阈值时赋值为最大值。公式及示意图如下：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/879cf4f4a68b0014379ca013021cf1f8.webp?x-oss-process=image/format,png" alt=""></p>
<h4><a id="Truncate_884"></a>截断（Truncate）</h4>
<p>给定像素值阈值，在图像中像素的灰度值大于该阈值的像素点被设置为该阈值，而小于该阈值的像素值保持不变。公式以及示意图如下：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/4c4f0ea5608db2397e01041fea4a59e2.webp?x-oss-process=image/format,png" alt=""></p>
<h4><a id="Threshold_To_Zero_890"></a>阈值取零（Threshold To Zero）</h4>
<p>与截断阈值化相反，像素点的灰度值如果大于该阈值则像素值不变，如果像素点的灰度值小于该阈值，则该像素值设置为0.公式以及示意图如下：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/52764c3ebcb5320522b068d775362963.webp?x-oss-process=image/format,png" alt=""></p>
<h4><a id="Threshold_To_Zero_Inverted_896"></a>阈值反取零（Threshold To Zero Inverted）</h4>
<p>像素值大于阈值的像素赋值为0，而小于该阈值的像素值则保持不变，公式以及示意图如下：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/c171b53f81490cd480590e6f500d38cb.webp?x-oss-process=image/format,png" alt=""></p>
<h2><a id="313__902"></a>3.13 图片裁剪</h2>
<h3><a id="3131__904"></a>3.13.1 方式一</h3>
<pre><code class="prism language-cpp"><span class="token keyword">inline</span>
Mat <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span> <span class="token keyword">const</span> Rect<span class="token operator">&amp;</span> roi <span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Mat</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">,</span> roi<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>以下为实例</p>
<pre><code class="prism language-cpp">Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">resize</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>xuenai<span class="token punctuation">,</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span> xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>
Mat <span class="token function">tuanzi</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token function">Rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"tuanzi"</span><span class="token punctuation">,</span>tuanzi<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3><a id="3132__925"></a>3.13.2 方式二</h3>
<pre><code class="prism language-cpp"><span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">Mat</span><span class="token punctuation">(</span><span class="token keyword">const</span> Mat<span class="token operator">&amp;</span> m<span class="token punctuation">,</span> <span class="token keyword">const</span> Rect<span class="token operator">&amp;</span> roi<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>以下为实例</p>
<pre><code class="prism language-cpp">Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">resize</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>xuenai<span class="token punctuation">,</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span> xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>
Mat <span class="token function">tuanzi</span><span class="token punctuation">(</span><span class="token function">xuenai</span><span class="token punctuation">(</span><span class="token function">Rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"tuanzi"</span><span class="token punctuation">,</span>tuanzi<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/02eccb3bc7e3a06bbdce62fc0735efea.png" alt=""></p>
<h3><a id="3133_Rect_944"></a>3.13.3 Rect类构造</h3>
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token operator">&gt;</span> <span class="token keyword">inline</span>
<span class="token class-name">Rect_</span><span class="token operator">&lt;</span>_Tp<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">Rect_</span><span class="token punctuation">(</span>_Tp _x<span class="token punctuation">,</span> _Tp _y<span class="token punctuation">,</span> _Tp _width<span class="token punctuation">,</span> _Tp _height<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">x</span><span class="token punctuation">(</span>_x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">y</span><span class="token punctuation">(</span>_y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">width</span><span class="token punctuation">(</span>_width<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">height</span><span class="token punctuation">(</span>_height<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token operator">&gt;</span> <span class="token keyword">inline</span>
<span class="token class-name">Rect_</span><span class="token operator">&lt;</span>_Tp<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">Rect_</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point_<span class="token operator">&lt;</span>_Tp<span class="token operator">&gt;</span><span class="token operator">&amp;</span> org<span class="token punctuation">,</span> <span class="token keyword">const</span> Size_<span class="token operator">&lt;</span>_Tp<span class="token operator">&gt;</span><span class="token operator">&amp;</span> sz<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">x</span><span class="token punctuation">(</span>org<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">y</span><span class="token punctuation">(</span>org<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">width</span><span class="token punctuation">(</span>sz<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">height</span><span class="token punctuation">(</span>sz<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token operator">&gt;</span> <span class="token keyword">inline</span>
<span class="token class-name">Rect_</span><span class="token operator">&lt;</span>_Tp<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">Rect_</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point_<span class="token operator">&lt;</span>_Tp<span class="token operator">&gt;</span><span class="token operator">&amp;</span> pt1<span class="token punctuation">,</span> <span class="token keyword">const</span> Point_<span class="token operator">&lt;</span>_Tp<span class="token operator">&gt;</span><span class="token operator">&amp;</span> pt2<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    x <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">min</span><span class="token punctuation">(</span>pt1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pt2<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    y <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">min</span><span class="token punctuation">(</span>pt1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pt2<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    width <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span>pt1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pt2<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">-</span> x<span class="token punctuation">;</span>
    height <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span>pt1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pt2<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">-</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a id="314__965"></a>3.14 基本变换</h2>
<h3><a id="3141__967"></a>3.14.1 翻转</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">flip</span><span class="token punctuation">(</span>InputArray src<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">,</span> <span class="token keyword">int</span> flipCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src(source)：输入图片</p>
<p>dst(destination)：输出图片</p>
<p>flipCode：翻转类型</p>
<pre><code>flipcode==0;//上下翻转
flipcod&gt;0;//左右翻转
flipcode&lt;0;//上下加左右翻转,等价于旋转180°
</code></pre>
<h4><a id="_985"></a>效果</h4>
<pre><code class="prism language-cpp">Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span> xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>
Mat <span class="token function">xuenai_flip</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">flip</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span> xuenai_flip<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_flip"</span><span class="token punctuation">,</span> xuenai_flip<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">waitKet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/8fac1ce122c3ba3dc7ba08dfac14fc05.png" alt=""></p>
<h3><a id="3142_90_998"></a>3.14.2 90°旋转</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">rotate</span><span class="token punctuation">(</span>InputArray src<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">,</span> <span class="token keyword">int</span> rotateCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">enum</span> <span class="token class-name">RotateFlags</span> <span class="token punctuation">{</span>
    ROTATE_90_CLOCKWISE <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//!&lt;Rotate 90 degrees clockwise</span>
    ROTATE_180 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//!&lt;Rotate 180 degrees clockwise</span>
    ROTATE_90_COUNTERCLOCKWISE <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">//!&lt;Rotate 270 degrees clockwise</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>src(source)：输入图片</p>
<p>dst(destination)：输出图片</p>
<p>rotateCode：旋转类型</p>
<h4><a id="_1015"></a>效果</h4>
<pre><code class="prism language-cpp">Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span> xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>
Mat <span class="token function">xuenai_rotate</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">rotate</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span> xuenai_rotate<span class="token punctuation">,</span> ROTATE_180<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_rotate"</span><span class="token punctuation">,</span> xuenai_rotate<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">waitKet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/46c763929af7e67f3c6909042466340f.png" alt=""></p>
<h2><a id="315__1028"></a>3.15 仿射变换与透射变换</h2>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">warpAffine</span><span class="token punctuation">(</span> InputArray src<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">,</span>
                              InputArray M<span class="token punctuation">,</span> Size dsize<span class="token punctuation">,</span>
                              <span class="token keyword">int</span> flags <span class="token operator">=</span> INTER_LINEAR<span class="token punctuation">,</span>
                              <span class="token keyword">int</span> borderMode <span class="token operator">=</span> BORDER_CONSTANT<span class="token punctuation">,</span>
                              <span class="token keyword">const</span> Scalar<span class="token operator">&amp;</span> borderValue <span class="token operator">=</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src(source)：输入图片</p>
<p>dst(destination)：输出图片</p>
<p>M：变换矩阵</p>
<p>dsize(destination size)：输出图片的尺寸，<strong>若不对输出图片的尺寸进行调整，那么很可能会出现黑边</strong></p>
<p>flags：插值算法</p>
<p>borderMode：边界外推法</p>
<p>borderValue：填充边界的值</p>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">warpPerspective</span><span class="token punctuation">(</span> InputArray src<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">,</span>
                                   InputArray M<span class="token punctuation">,</span> Size dsize<span class="token punctuation">,</span>
                                   <span class="token keyword">int</span> flags <span class="token operator">=</span> INTER_LINEAR<span class="token punctuation">,</span>
                                   <span class="token keyword">int</span> borderMode <span class="token operator">=</span> BORDER_CONSTANT<span class="token punctuation">,</span>
                                   <span class="token keyword">const</span> Scalar<span class="token operator">&amp;</span> borderValue <span class="token operator">=</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src(source)：输入图片</p>
<p>dst(destination)：输出图片</p>
<p>M：变换矩阵</p>
<p>dsize(destination size)：输出图片的尺寸，<strong>若不对输出图片的尺寸进行调整，那么很可能会出现黑边</strong></p>
<p>flags：插值算法</p>
<p>borderMode：边界外推法</p>
<p>borderValue：填充边界的值</p>
<h3><a id="3151__1073"></a>3.15.1 平移</h3>
<p>只需将变换矩阵M设置成如下形式：</p>
<pre><code class="prism language-cpp"><span class="token keyword">float</span> delta_x<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">,</span>delta_y<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">;</span>
<span class="token keyword">float</span>  M_values<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>delta_x<span class="token punctuation">,</span>
                   <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>delta_y<span class="token punctuation">}</span><span class="token punctuation">;</span>
Mat <span class="token function">M</span><span class="token punctuation">(</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>CV_32F<span class="token punctuation">,</span>M_values<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>delta_x：x方向上的偏移量</p>
<p>delta_y：y方向上的偏移量</p>
<p>M_values：<strong>必须是浮点类型的数组对象</strong></p>
<p>M：<strong>必须是CV_32F，不能用逗号式分隔创建</strong></p>
<h4><a id="_1092"></a>效果</h4>
<pre><code class="prism language-cpp">Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span>  M_values<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span>
                    <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Mat <span class="token function">M</span><span class="token punctuation">(</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CV_64F<span class="token punctuation">,</span>M_values<span class="token punctuation">)</span><span class="token punctuation">;</span>
Mat <span class="token function">xuenai_shift</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">warpAffine</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>xuenai_shift<span class="token punctuation">,</span>M<span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_shift"</span><span class="token punctuation">,</span>xuenai_shift<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">waitKet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/2ec0dea0c7b256210c37921ae457aaf5.png" alt=""></p>
<h3><a id="3152__1108"></a>3.15.2 任意角度旋转</h3>
<h4><a id="M_1110"></a>获得变换矩阵M</h4>
<pre><code class="prism language-cpp"><span class="token keyword">inline</span>
Mat <span class="token function">getRotationMatrix2D</span><span class="token punctuation">(</span>Point2f center<span class="token punctuation">,</span> <span class="token keyword">double</span> angle<span class="token punctuation">,</span> <span class="token keyword">double</span> scale<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Mat</span><span class="token punctuation">(</span><span class="token function">getRotationMatrix2D_</span><span class="token punctuation">(</span>center<span class="token punctuation">,</span> angle<span class="token punctuation">,</span> scale<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>center：旋转中心点的坐标</p>
<p>angle：逆时针偏角</p>
<p>scale：生成图与原图之比</p>
<h4><a id="_1126"></a>效果</h4>
<pre><code class="prism language-cpp">Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span> xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>
Mat M<span class="token operator">=</span> <span class="token function">getRotationMatrix2D</span><span class="token punctuation">(</span><span class="token function">Point2f</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span>cols<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span>rows<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Mat <span class="token function">xuenai_rotate</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">warpAffine</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>xuenai_rotate<span class="token punctuation">,</span>M<span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_flip"</span><span class="token punctuation">,</span>xuenai_rotate<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/6ad57811155de9587dbaab1fcc91cff3.png" alt=""></p>
<h3><a id="3153__1139"></a>3.15.3 仿射（不破坏几何关系）</h3>
<h4><a id="M_1141"></a>获得变换矩阵M</h4>
<pre><code class="prism language-cpp">CV_EXPORTS Mat <span class="token function">getAffineTransform</span><span class="token punctuation">(</span> <span class="token keyword">const</span> Point2f src<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">const</span> Point2f dst<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src<a href="source%5B%5D"></a>：输入图片的<strong>坐标点集，含三个坐标点</strong></p>
<p>dst<a href="destination%5B%5D"></a>：三个坐标点变换的<strong>目标位置</strong></p>
<p><strong>三个点要一一对应</strong></p>
<h3><a id="3154__1153"></a>3.15.4 透射（破坏几何关系）</h3>
<h4><a id="M_1155"></a>已知变换后图片，逆推变换矩阵M</h4>
<pre><code class="prism language-cpp">CV_EXPORTS_W Mat <span class="token function">getPerspectiveTransform</span><span class="token punctuation">(</span>InputArray src<span class="token punctuation">,</span> InputArray dst<span class="token punctuation">,</span> <span class="token keyword">int</span> solveMethod <span class="token operator">=</span> DECOMP_LU<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src(source)：输入图片</p>
<p>dst(destination)：输出图片</p>
<h4><a id="M_1165"></a>获得变换矩阵M</h4>
<pre><code class="prism language-cpp">CV_EXPORTS Mat <span class="token function">getPerspectiveTransform</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point2f src<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">const</span> Point2f dst<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> solveMethod <span class="token operator">=</span> DECOMP_LU<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src<a href="source%5B%5D"></a>：输入图片的<strong>坐标点集，含四个坐标点</strong></p>
<p>dst<a href="destination%5B%5D"></a>：四个坐标点变换的<strong>目标位置</strong></p>
<p><strong>四个点要一一对应</strong></p>
<h4><a id="_1177"></a>效果</h4>
<pre><code class="prism language-cpp">        Mat origin <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"origin.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Point2f point2F_origin<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">Point2f</span> <span class="token punctuation">(</span><span class="token number">405</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">Point2f</span><span class="token punctuation">(</span><span class="token number">2469</span><span class="token punctuation">,</span><span class="token number">217</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">Point2f</span><span class="token punctuation">(</span><span class="token number">2573</span><span class="token punctuation">,</span><span class="token number">3489</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">Point2f</span><span class="token punctuation">(</span><span class="token number">349</span><span class="token punctuation">,</span><span class="token number">3547</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        Point2f point2F_tansform<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">Point2f</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">Point2f</span><span class="token punctuation">(</span><span class="token number">2500</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">Point2f</span><span class="token punctuation">(</span><span class="token number">2500</span><span class="token punctuation">,</span><span class="token number">3500</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">Point2f</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3500</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        Mat M<span class="token operator">=</span><span class="token function">getPerspectiveTransform</span><span class="token punctuation">(</span>point2F_origin<span class="token punctuation">,</span>point2F_tansform<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Mat <span class="token function">transfrom</span><span class="token punctuation">(</span>origin<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>origin<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">warpPerspective</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span>transfrom<span class="token punctuation">,</span>M<span class="token punctuation">,</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">2500</span><span class="token punctuation">,</span><span class="token number">3500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resize</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span>origin<span class="token punctuation">,</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resize</span><span class="token punctuation">(</span>transfrom<span class="token punctuation">,</span>transfrom<span class="token punctuation">,</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"origin"</span><span class="token punctuation">,</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"transform"</span><span class="token punctuation">,</span>transfrom<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/974f93dbdde4431a8218245816741fd3.png#pic_center" alt="在这里插入图片描述"></p>
<h1><a id="4_1194"></a>4.滤波及边缘检测</h1>
<h2><a id="41__1196"></a>4.1 均值滤波</h2>
<h3><a id="411__1198"></a>4.1.1 卷积核形状</h3>
<pre><code class="prism language-cpp">Mat kernal<span class="token operator">=</span><span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">ones</span><span class="token punctuation">(</span><span class="token function">Size</span><span class="token punctuation">(</span>ksize<span class="token punctuation">,</span>ksize<span class="token punctuation">)</span><span class="token punctuation">,</span>CV_64F<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>ksize<span class="token operator">*</span>ksize<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3><a id="412_API_1204"></a>4.1.2 API</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">blur</span><span class="token punctuation">(</span> InputArray src<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">,</span>
                        Size ksize<span class="token punctuation">,</span> Point anchor <span class="token operator">=</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token keyword">int</span> borderType <span class="token operator">=</span> BORDER_DEFAULT <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src(source)：输入图片</p>
<p>dst(destination)：输出图片</p>
<p>ksize(kernal size)：卷积核大小，<strong>必须是正奇数</strong></p>
<p>anchor：滤波器中心像素位置，取（-1，-1）表示几何中心</p>
<p>borderType：边界填充方式，默认为黑边</p>
<h3><a id="413__1222"></a>4.1.3 效果</h3>
<pre><code class="prism language-cpp">Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>
Mat <span class="token function">xuenai_blur</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">blur</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>xuenai_blur<span class="token punctuation">,</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_blur"</span><span class="token punctuation">,</span>xuenai_blur<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">waitKet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/3e3a93194ade7a2ec7ba56ae29323c5e.png" alt=""></p>
<h2><a id="42__1235"></a>4.2 高斯滤波</h2>
<h3><a id="421__1237"></a>4.2.1 卷积核形状</h3>
<p>二维高斯函数表述为：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/a2c8dd843c2c2253e6ab5d81aa44b464.jpeg" alt=""></p>
<p>对应图形：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/89a95474bda24917c6c4e4eedebbbbcd.png" alt=""></p>
<p>代码实现（不区分sigmaX与sigmaY）</p>
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">GetGaussianKernel</span><span class="token punctuation">(</span>Mat kernal<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> ksize<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">double</span> sigma<span class="token punctuation">)</span>  
<span class="token punctuation">{</span>  
    <span class="token keyword">const</span> <span class="token keyword">double</span> PI<span class="token operator">=</span><span class="token number">4.0</span><span class="token operator">*</span><span class="token function">atan</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//圆周率π赋值  </span>
    <span class="token keyword">int</span> center<span class="token operator">=</span> ksize<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>  
    <span class="token keyword">double</span> sum<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>  
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>ksize<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>  
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>ksize<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>  
        <span class="token punctuation">{</span>  
            kernal<span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>PI<span class="token operator">*</span>sigma<span class="token operator">*</span>sigma<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token operator">-</span>center<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>i<span class="token operator">-</span>center<span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span>j<span class="token operator">-</span>center<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>j<span class="token operator">-</span>center<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>sigma<span class="token operator">*</span>sigma<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            sum<span class="token operator">+=</span>kernal<span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>ksize<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>  
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>ksize<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>  
        <span class="token punctuation">{</span>  
            kernal<span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token operator">/=</span>sum<span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
    <span class="token keyword">return</span> <span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre>
<h3><a id="422_API_1275"></a>4.2.2 API</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">GaussianBlur</span><span class="token punctuation">(</span> InputArray src<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">,</span> Size ksize<span class="token punctuation">,</span>
                                <span class="token keyword">double</span> sigmaX<span class="token punctuation">,</span> <span class="token keyword">double</span> sigmaY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
                                <span class="token keyword">int</span> borderType <span class="token operator">=</span> BORDER_DEFAULT <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src(source)：输入图片</p>
<p>dst(destination)：输出图片</p>
<p>ksize(kernal size)：卷积核大小。<strong>如果这个值我们设其为非正数，那么OpenCV会从第五个参数sigmaSpace来计算出它来。</strong></p>
<p>sigmaX：x方向上的标准差</p>
<p>sigmaY：y方向上的标准差。<strong>默认输入量为0，则将其设置为等于sigmaX，如果两个轴的标准差均为0，则根据输入的高斯滤波器尺寸计算标准偏差。</strong></p>
<p>borderType：边界填充方式，默认为黑边</p>
<h3><a id="423__1295"></a>4.2.3 效果</h3>
<pre><code class="prism language-cpp">    Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Mat <span class="token function">xuenai_Gauss</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">GaussianBlur</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>xuenai_Gauss<span class="token punctuation">,</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_Gauss"</span><span class="token punctuation">,</span>xuenai_Gauss<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">waitKet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/3961d2c582edfe68df4e98e4a743c219.png" alt=""></p>
<h2><a id="43__1308"></a>4.3 中值滤波</h2>
<h3><a id="431__1310"></a>4.3.1 原理</h3>
<p>取滤波器内的中值作为输出，<strong>可以很好的抑制椒盐噪声</strong></p>
<h3><a id="432_API_1314"></a>4.3.2 API</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">medianBlur</span><span class="token punctuation">(</span> InputArray src<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">,</span> <span class="token keyword">int</span> ksize <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src(source)：输入图片</p>
<p>dst(destination)：输出图片</p>
<p>ksize(kernal size)：卷积核边长，<strong>必须是正奇数</strong></p>
<h3><a id="433__1326"></a>4.3.3 效果</h3>
<pre><code class="prism language-cpp">    Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Mat <span class="token function">xuenai_median</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">medianBlur</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>xuenai_median<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_median"</span><span class="token punctuation">,</span>xuenai_median<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">waitKet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/c3eb7d88bd4bb0e44aa794369f50c541.png" alt=""></p>
<h2><a id="44__1339"></a>4.4 高斯双边滤波</h2>
<h3><a id="441__1341"></a>4.4.1 原理</h3>
<p>双边滤波器的好处是可以做边缘保存（edge preserving），一般用高斯滤波去降噪，会较明显地模糊边缘，对于高频细节的保护效果并不明显。双边滤波器顾名思义比高斯滤波多了一个高斯方差sigma－d，它是基于空间分布的高斯滤波函数，所以在边缘附近，离的较远的像素不会太多影响到边缘上的像素值，这样就保证了边缘附近像素值的保存。但是由于保存了过多的高频信息，对于彩色图像里的高频噪声，双边滤波器不能够干净的滤掉，只能够对于低频信息进行较好的滤波。</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/33513cc34283f3251b2a4d420c900b31.png" alt=""></p>
<h3><a id="442_API_1347"></a>4.4.2 API</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">bilateralFilter</span><span class="token punctuation">(</span> InputArray src<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">,</span>
                                   <span class="token keyword">double</span> sigmaColor<span class="token punctuation">,</span> <span class="token keyword">double</span> sigmaSpace<span class="token punctuation">,</span>
                                   <span class="token keyword">int</span> borderType <span class="token operator">=</span> BORDER_DEFAULT <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src(source)：输入图片</p>
<p>dst(destination)：输出图片</p>
<p>d：卷积核边长。<strong>如果这个值我们设其为非正数，那么OpenCV会从第五个参数sigmaSpace来计算出它来。</strong></p>
<p>sigmaColor：颜色空间滤波器的sigma值。这个参数的值越大，就表明该像素邻域内有更宽广的颜色会被混合到一起，产生较大的半相等颜色区域。</p>
<p>sigmaSpace：坐标空间中滤波器的sigma值，坐标空间的标注方差。他的数值越大，意味着越远的像素会相互影响，从而使更大的区域足够相似的颜色获取相同的颜色。当d&gt;0，卷积核大小已被指定且与sigmaSpace无关。否则，d正比于sigmaSpace。</p>
<p>borderType：边界填充方式，默认为黑边</p>
<h3><a id="443__1367"></a>4.4.3 效果</h3>
<pre><code class="prism language-cpp">    Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Mat <span class="token function">xuenai_bilateral</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">bilateralFilter</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>xuenai_bilateral<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_bilateral"</span><span class="token punctuation">,</span>xuenai_bilateral<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">waitKet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/8a771a085b9410de2ba8186bb8c0ee8a.png" alt=""></p>
<h2><a id="45__1380"></a>4.5 获取用来形态学操作的滤波器</h2>
<pre><code class="prism language-cpp">CV_EXPORTS_W Mat <span class="token function">getStructuringElement</span><span class="token punctuation">(</span><span class="token keyword">int</span> shape<span class="token punctuation">,</span> Size ksize<span class="token punctuation">,</span> Point anchor <span class="token operator">=</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">enum</span> <span class="token class-name">MorphShapes</span> <span class="token punctuation">{</span>
    MORPH_RECT    <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//!&lt; a rectangular structuring element:  \f[E_{ij}=1\f]</span>
    MORPH_CROSS   <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//!&lt; a cross-shaped structuring element:</span>
                       <span class="token comment">//!&lt; \f[E_{ij} = \begin{cases} 1 &amp; \texttt{if } {i=\texttt{anchor.y } {or } {j=\texttt{anchor.x}}} \\0 &amp; \texttt{otherwise} \end{cases}\f]</span>
    MORPH_ELLIPSE <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment">//!&lt; an elliptic structuring element, that is, a filled ellipse inscribed</span>
                      <span class="token comment">//!&lt; into the rectangle Rect(0, 0, esize.width, 0.esize.height)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>shape：滤波器形状</p>
<p>ksize(kernal size)：滤波器大小</p>
<p>anchor：滤波器中心像素位置，取（-1，-1）表示几何中心</p>
<h2><a id="46__1399"></a>4.6 腐蚀和膨胀（对二值图）</h2>
<h3><a id="461__1401"></a>4.6.1 原理</h3>
<p>腐蚀：取滤波器内的最小值作为输出</p>
<p>膨胀：取滤波器内的最大值作为输出</p>
<h3><a id="462_API_1407"></a>4.6.2 腐蚀API</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">erode</span><span class="token punctuation">(</span> InputArray src<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">,</span> InputArray kernel<span class="token punctuation">,</span>
                         Point anchor <span class="token operator">=</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">int</span> iterations <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
                         <span class="token keyword">int</span> borderType <span class="token operator">=</span> BORDER_CONSTANT<span class="token punctuation">,</span>
                         <span class="token keyword">const</span> Scalar<span class="token operator">&amp;</span> borderValue <span class="token operator">=</span> <span class="token function">morphologyDefaultBorderValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src(source)：输入图片</p>
<p>dst(destination)：输出图片</p>
<p>kernal：滤波器矩阵</p>
<p>anchor：滤波器中心像素位置，取（-1，-1）表示几何中心</p>
<p>iterations：执行erode函数的次数，默认执行一次</p>
<p>borderType：边界填充方式</p>
<p>borderValue：填充边界的值</p>
<h3><a id="463__1430"></a>4.6.3 效果</h3>
<pre><code class="prism language-cpp">    Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat <span class="token function">xuenai_gray</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">cvtColor</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>xuenai_gray<span class="token punctuation">,</span>COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Mat <span class="token function">xuenai_threshold</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">threshold</span><span class="token punctuation">(</span>xuenai_gray<span class="token punctuation">,</span>xuenai_threshold<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>THRESH_BINARY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_threshold"</span><span class="token punctuation">,</span>xuenai_threshold<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat kernal<span class="token operator">=</span><span class="token function">getStructuringElement</span><span class="token punctuation">(</span>MORPH_RECT<span class="token punctuation">,</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat <span class="token function">xuenai_erode</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">erode</span><span class="token punctuation">(</span>xuenai_threshold<span class="token punctuation">,</span>xuenai_erode<span class="token punctuation">,</span>kernal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_erode"</span><span class="token punctuation">,</span>xuenai_erode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">waitKet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/f4cee99e5ac7db4894d4f95f6a8ca857.png" alt=""></p>
<h3><a id="464_API_1451"></a>4.6.4 膨胀API</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">dilate</span><span class="token punctuation">(</span> InputArray src<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">,</span> InputArray kernel<span class="token punctuation">,</span>
                          Point anchor <span class="token operator">=</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">int</span> iterations <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
                          <span class="token keyword">int</span> borderType <span class="token operator">=</span> BORDER_CONSTANT<span class="token punctuation">,</span>
                          <span class="token keyword">const</span> Scalar<span class="token operator">&amp;</span> borderValue <span class="token operator">=</span> <span class="token function">morphologyDefaultBorderValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src(source)：输入图片</p>
<p>dst(destination)：输出图片</p>
<p>kernal：滤波器矩阵</p>
<p>anchor：滤波器中心像素位置，取（-1，-1）表示几何中心</p>
<p>iterations：执行erode函数的次数</p>
<p>borderType：边界填充方式</p>
<p>borderValue：填充边界的值</p>
<h3><a id="465__1474"></a>4.6.5 效果</h3>
<pre><code class="prism language-cpp">    Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat <span class="token function">xuenai_gray</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">cvtColor</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>xuenai_gray<span class="token punctuation">,</span>COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Mat <span class="token function">xuenai_threshold</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">threshold</span><span class="token punctuation">(</span>xuenai_gray<span class="token punctuation">,</span>xuenai_threshold<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>THRESH_BINARY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_threshold"</span><span class="token punctuation">,</span>xuenai_threshold<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat kernal<span class="token operator">=</span><span class="token function">getStructuringElement</span><span class="token punctuation">(</span>MORPH_RECT<span class="token punctuation">,</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat <span class="token function">xuenai_dilate</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dilate</span><span class="token punctuation">(</span>xuenai_threshold<span class="token punctuation">,</span>xuenai_dilate<span class="token punctuation">,</span>kernal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_dilate"</span><span class="token punctuation">,</span>xuenai_dilate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">waitKet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/caf9a26636f9740e51f17509b5fef700.png" alt=""></p>
<h2><a id="47__1495"></a>4.7 形态学操作（对二值图）</h2>
<h3><a id="471_API_1497"></a>4.7.1 API</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">morphologyEx</span><span class="token punctuation">(</span> InputArray src<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">,</span>
                                <span class="token keyword">int</span> op<span class="token punctuation">,</span> InputArray kernel<span class="token punctuation">,</span>
                                Point anchor <span class="token operator">=</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">int</span> iterations <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
                                <span class="token keyword">int</span> borderType <span class="token operator">=</span> BORDER_CONSTANT<span class="token punctuation">,</span>
                                <span class="token keyword">const</span> Scalar<span class="token operator">&amp;</span> borderValue <span class="token operator">=</span> <span class="token function">morphologyDefaultBorderValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src(source)：输入图片</p>
<p>dst(destination)：输出图片</p>
<p>op：变换类型</p>
<p>kernal：滤波器矩阵</p>
<p>anchor：滤波器中心像素位置，取（-1，-1）表示几何中心</p>
<p>iterations：执行erode函数的次数</p>
<p>borderType：边界填充方式</p>
<p>borderValue：填充边界的值</p>
<h3><a id="472__1523"></a>4.7.2 变换类型</h3>
<pre><code class="prism language-cpp"><span class="token keyword">enum</span> <span class="token class-name">MorphTypes</span><span class="token punctuation">{</span>
    MORPH_ERODE    <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//腐蚀</span>

    MORPH_DILATE   <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//膨胀</span>

    MORPH_OPEN     <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">//开</span>
                        
    MORPH_CLOSE    <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">//闭</span>
                        
    MORPH_GRADIENT <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">//形态学梯度</span>
                        
    MORPH_TOPHAT   <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">//顶帽</span>
                        
    MORPH_BLACKHAT <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token comment">//黑帽</span>

    MORPH_HITMISS  <span class="token operator">=</span> <span class="token number">7</span>  <span class="token comment">//击中击不中变换</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h3><a id="473__1546"></a>4.7.3 开</h3>
<h4><a id="_1548"></a>原理</h4>
<p>对输入图片先进行腐蚀，然后进行膨胀。可以用来<strong>屏蔽与滤波器大小相当的亮部</strong>。</p>
<h4><a id="_1552"></a>效果</h4>
<pre><code class="prism language-cpp">    Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Mat <span class="token function">xuenai_gray</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">cvtColor</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>xuenai_gray<span class="token punctuation">,</span>COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Mat <span class="token function">xuenai_threshold</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">threshold</span><span class="token punctuation">(</span>xuenai_gray<span class="token punctuation">,</span>xuenai_threshold<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>THRESH_BINARY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_threshold"</span><span class="token punctuation">,</span>xuenai_threshold<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat kernal<span class="token operator">=</span><span class="token function">getStructuringElement</span><span class="token punctuation">(</span>MORPH_RECT<span class="token punctuation">,</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat <span class="token function">xuenai_morphology</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">morphologyEx</span><span class="token punctuation">(</span>xuenai_threshold<span class="token punctuation">,</span>xuenai_morphology<span class="token punctuation">,</span>MORPH_OPEN<span class="token punctuation">,</span>kernal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_morphology"</span><span class="token punctuation">,</span>xuenai_morphology<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">waitKet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/fd0e88c5798ffe5ea8fdec2c3b679661.png" alt=""></p>
<h3><a id="474__1572"></a>4.7.4 闭</h3>
<h4><a id="_1574"></a>原理</h4>
<p>对输入图片先进行膨胀，然后进行腐蚀。可以用来<strong>屏蔽与滤波器大小相当的暗部</strong>。</p>
<h4><a id="_1578"></a>效果</h4>
<pre><code class="prism language-cpp">    Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat <span class="token function">xuenai_gray</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">cvtColor</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>xuenai_gray<span class="token punctuation">,</span>COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Mat <span class="token function">xuenai_threshold</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">threshold</span><span class="token punctuation">(</span>xuenai_gray<span class="token punctuation">,</span>xuenai_threshold<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>THRESH_BINARY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_threshold"</span><span class="token punctuation">,</span>xuenai_threshold<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat kernal<span class="token operator">=</span><span class="token function">getStructuringElement</span><span class="token punctuation">(</span>MORPH_RECT<span class="token punctuation">,</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    Mat <span class="token function">xuenai_morphology</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">morphologyEx</span><span class="token punctuation">(</span>xuenai_threshold<span class="token punctuation">,</span>xuenai_morphology<span class="token punctuation">,</span>MORPH_CLOSE<span class="token punctuation">,</span>kernal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_morphology"</span><span class="token punctuation">,</span>xuenai_morphology<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">waitKet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/a7c3a6e91c41e87a41b8b08aae5e1db3.png" alt=""></p>
<h3><a id="475__1599"></a>4.7.5 顶帽</h3>
<h4><a id="_1601"></a>原理</h4>
<p>对输入图片先进行开操作，然后原图-开操作图。可以用来<strong>提取与滤波器大小相当的亮部</strong>。</p>
<h4><a id="_1605"></a>效果</h4>
<pre><code class="prism language-cpp">    Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat <span class="token function">xuenai_gray</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">cvtColor</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>xuenai_gray<span class="token punctuation">,</span>COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Mat <span class="token function">xuenai_threshold</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">threshold</span><span class="token punctuation">(</span>xuenai_gray<span class="token punctuation">,</span>xuenai_threshold<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>THRESH_BINARY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_threshold"</span><span class="token punctuation">,</span>xuenai_threshold<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat kernal<span class="token operator">=</span><span class="token function">getStructuringElement</span><span class="token punctuation">(</span>MORPH_RECT<span class="token punctuation">,</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat <span class="token function">xuenai_morphology</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">morphologyEx</span><span class="token punctuation">(</span>xuenai_threshold<span class="token punctuation">,</span>xuenai_morphology<span class="token punctuation">,</span>MORPH_TOPHAT<span class="token punctuation">,</span>kernal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_morphology"</span><span class="token punctuation">,</span>xuenai_morphology<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">waitKet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/62e00915fed78453ff24da0217ab2341.png" alt=""></p>
<h3><a id="476__1626"></a>4.7.6 黑帽</h3>
<h4><a id="_1628"></a>原理</h4>
<p>对输入图片先进行闭操作，然后闭操作图-原图。可以用来<strong>提取与滤波器大小相当的暗部</strong>。</p>
<h4><a id="_1632"></a>效果</h4>
<pre><code class="prism language-cpp">    Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat <span class="token function">xuenai_gray</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">cvtColor</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>xuenai_gray<span class="token punctuation">,</span>COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Mat <span class="token function">xuenai_threshold</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">threshold</span><span class="token punctuation">(</span>xuenai_gray<span class="token punctuation">,</span>xuenai_threshold<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>THRESH_BINARY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_threshold"</span><span class="token punctuation">,</span>xuenai_threshold<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat kernal<span class="token operator">=</span><span class="token function">getStructuringElement</span><span class="token punctuation">(</span>MORPH_RECT<span class="token punctuation">,</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat <span class="token function">xuenai_morphology</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">morphologyEx</span><span class="token punctuation">(</span>xuenai_threshold<span class="token punctuation">,</span>xuenai_morphology<span class="token punctuation">,</span>MORPH_BLACKHAT<span class="token punctuation">,</span>kernal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_morphology"</span><span class="token punctuation">,</span>xuenai_morphology<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">waitKet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/ada2d8f8881f2f98318328370604a267.png" alt=""></p>
<h3><a id="477__1653"></a>4.7.7 形态学梯度</h3>
<h4><a id="_1655"></a>原理</h4>
<p>膨胀图与腐蚀图之差。可以用来 <strong>提取边界轮廓</strong> ，但提取效果比不上专业的边缘检测算法。</p>
<h4><a id="_1659"></a>效果</h4>
<pre><code class="prism language-cpp">    Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat <span class="token function">xuenai_gray</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">cvtColor</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>xuenai_gray<span class="token punctuation">,</span>COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Mat <span class="token function">xuenai_threshold</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">threshold</span><span class="token punctuation">(</span>xuenai_gray<span class="token punctuation">,</span>xuenai_threshold<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>THRESH_BINARY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_threshold"</span><span class="token punctuation">,</span>xuenai_threshold<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat kernal<span class="token operator">=</span><span class="token function">getStructuringElement</span><span class="token punctuation">(</span>MORPH_RECT<span class="token punctuation">,</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat <span class="token function">xuenai_morphology</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">morphologyEx</span><span class="token punctuation">(</span>xuenai_threshold<span class="token punctuation">,</span>xuenai_morphology<span class="token punctuation">,</span>MORPH_GRADIENT<span class="token punctuation">,</span>kernal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_morphology"</span><span class="token punctuation">,</span>xuenai_morphology<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">waitKet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/6af0c45fc131cafaa30323e4af6dd70f.png" alt=""></p>
<h3><a id="478__1680"></a>4.7.8 击中击不中变换</h3>
<h4><a id="_1682"></a>原理</h4>
<p>击中击不中变换由下面三步构成：</p>
<p>用结构元素B1来腐蚀输入图像</p>
<p>用结构元素B2来腐蚀输入图像的补集</p>
<p>前两步结果的与运算</p>
<p>结构元素B1和B2可以结合为一个元素B。例如：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/e06a9e05f206e3912353642fd254008c.png" alt=""></p>
<p>结构元素：左B1（击中元素），中B2（击不中元素），右B（两者结合）</p>
<p>本例中，我们寻找这样一种结构模式，中间像素属于背景，其上下左右属于前景，其余领域像素忽略不计（背景为黑色，前景为白色）。然后用上面的核在输入图像中找这种结构。从下面的输出图像中可以看到，输入图像中只有一个位置满足要求。</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/8478a5898a1cef4166176c7b7597839a.png" alt=""></p>
<p>输入二值图像</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/0ddc8fc8f461e91d6fb59f67b13745bd.png" alt=""></p>
<p>输出二值图像</p>
<h2><a id="48__1708"></a>4.8 边缘检测：选择合适的输出深度</h2>
<p>参照以下表格</p>

<table>
<thead>
<tr>
<th align="left">int sdepth</th>
<th align="left">int ddepth</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">CV_8U</td>
<td align="left">CV_16S/CV_32F/CV_64F</td>
</tr>
<tr>
<td align="left">CV_16U/CV_16S</td>
<td align="left">CV_32F/CV_64F</td>
</tr>
<tr>
<td align="left">CV_32F</td>
<td align="left">CV_32F/CV_64F</td>
</tr>
<tr>
<td align="left">CV_64F</td>
<td align="left">CV_64F</td>
</tr>
</tbody>
</table><h3><a id="481_normalize_1718"></a>4.8.1 normalize归一化函数</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">normalize</span><span class="token punctuation">(</span> InputArray src<span class="token punctuation">,</span> InputOutputArray dst<span class="token punctuation">,</span> <span class="token keyword">double</span> alpha <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">double</span> beta <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
                             <span class="token keyword">int</span> norm_type <span class="token operator">=</span> NORM_L2<span class="token punctuation">,</span> <span class="token keyword">int</span> dtype <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> InputArray mask <span class="token operator">=</span> <span class="token function">noArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src(source)：输入数组</p>
<p>dst(destination)：输出数组</p>
<p>alpha ：<strong>如果norm_type为NORM_MINMAX ，则alpha为最小值或最大值；如果norm_type为其他类型，则为归一化要乘的系数</strong></p>
<p>beta ：<strong>如果norm_type为NORM_MINMAX ，则beta为最小值或最大值；如果norm_type为其他类型，beta被忽略.</strong></p>
<p>norm_type ：归一化类型</p>
<p>dtype ：输出数组的深度，若输入-1则表示与src一致。<strong>如果不能判断需要的深度，则可以输入-1然后使用convertScaleAbs绝对值化，这也是最推荐的做法，而不推荐自己判断深度</strong>。</p>
<p>mask ：掩码，用于指示函数是否仅仅对指定的元素进行操作。大小必须与src保持一致。具体用法见8.1.4</p>
<h4><a id="_1738"></a>归一化类型（只介绍常用的四种）</h4>
<pre><code class="prism language-cpp"><span class="token keyword">enum</span> <span class="token class-name">NormTypes</span> <span class="token punctuation">{</span>
                NORM_INF       <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
                NORM_L1        <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
                NORM_L2        <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span>
                NORM_L2SQR     <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span>
                NORM_HAMMING   <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span>
                NORM_HAMMING2  <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">,</span>
                NORM_TYPE_MASK <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token comment">//!&lt; bit-mask which can be used to separate norm type from norm flags</span>
                NORM_RELATIVE  <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token comment">//!&lt; flag</span>
                NORM_MINMAX    <span class="token operator">=</span> <span class="token number">32</span> <span class="token comment">//!&lt; flag</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<ul>
<li>
<p>NORM_L1<br>
<img src="https://img-blog.csdnimg.cn/377e1301b4e04957bf51a4a6f984dd99.png#pic_center" alt="在这里插入图片描述"></p>
</li>
<li>
<p>NORM_L2<br>
<img src="https://img-blog.csdnimg.cn/43eb9e08647946eea3008c772bb7787f.png#pic_center" alt="在这里插入图片描述"></p>
</li>
<li>
<p>NORM_INF</p>
</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/6b7aa2691e9740fd982f79d38cfc7025.png#pic_center" alt="在这里插入图片描述"></p>
<ul>
<li>NORM_MINMAX(recommended)<br>
<img src="https://img-blog.csdnimg.cn/c14ae1eed1e949b0852b93585f71a792.png#pic_center" alt="在这里插入图片描述"></li>
</ul>
<h3><a id="482_convertScaleAbs_1766"></a>4.8.2 convertScaleAbs绝对值化</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">convertScaleAbs</span><span class="token punctuation">(</span>InputArray src<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">,</span>
                                  <span class="token keyword">double</span> alpha <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">double</span> beta <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src(source)：输入图片</p>
<p>dst(destination)：输出图片</p>
<h2><a id="49_sobel_1777"></a>4.9 sobel（对灰度图）</h2>
<h3><a id="491_ksize3_1779"></a>4.9.1 卷积核形状（ksize=3）</h3>
<pre><code class="prism language-cpp">Mat kernalX<span class="token operator">=</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>
                                    <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span>
                                    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Mat kernalY<span class="token operator">=</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span>
                                     <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span>
                                     <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3><a id="492_API_1790"></a>4.9.2 API</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">Sobel</span><span class="token punctuation">(</span> InputArray src<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">,</span> <span class="token keyword">int</span> ddepth<span class="token punctuation">,</span>
                         <span class="token keyword">int</span> dx<span class="token punctuation">,</span> <span class="token keyword">int</span> dy<span class="token punctuation">,</span> <span class="token keyword">int</span> ksize <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
                         <span class="token keyword">double</span> scale <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">double</span> delta <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
                         <span class="token keyword">int</span> borderType <span class="token operator">=</span> BORDER_DEFAULT <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src(source)：输入图片</p>
<p>dst(destination)：输出图片</p>
<p>ddepth(destination depth)：输出图片的深度（CV_16F）</p>
<p>dx：x方向导数的阶数，一般取1</p>
<p>dy：y方向导数的阶数，一般取1</p>
<p>ksize：卷积核边长，默认为3</p>
<p>scale：生成图与原图的缩放比例，默认为1</p>
<p>delta：额外的增量，默认为0</p>
<p>borderType：边界填充方式，默认为黑边</p>
<h3><a id="493__1817"></a>4.9.3 流程</h3>
<ol>
<li>用cvtColor函数转<strong>灰度图</strong></li>
<li><strong>在x,y方向上分别各调用一次Sobel</strong></li>
<li><strong>用convertScaleAbs函数转换到CV_8U，否则无法显示</strong></li>
<li><strong>用addWeighted函数把两张输出图片加在一起</strong></li>
</ol>
<h3><a id="494_xySobel_1824"></a>4.9.4 同时在x,y方向上调用Sobel和分开调用的效果对比</h3>
<pre><code class="prism language-cpp">Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span> xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//转灰度图</span>
Mat <span class="token function">xuenai_gray</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">cvtColor</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>xuenai_gray<span class="token punctuation">,</span>COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//同时在x,y方向上调用Sobel</span>
Mat <span class="token function">xuenai_sobel1</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Sobel</span><span class="token punctuation">(</span>xuenai_gray<span class="token punctuation">,</span>xuenai_sobel1<span class="token punctuation">,</span>CV_16S<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">convertScaleAbs</span><span class="token punctuation">(</span>xuenai_sobel1<span class="token punctuation">,</span>xuenai_sobel1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_sobel1"</span><span class="token punctuation">,</span>xuenai_sobel1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//在x,y方向上分别各调用一次Sobel</span>
Mat <span class="token function">xuenai_xsobel</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Mat <span class="token function">xuenai_ysobel</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Mat <span class="token function">xuenai_sobel2</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Sobel</span><span class="token punctuation">(</span>xuenai_gray<span class="token punctuation">,</span>xuenai_xsobel<span class="token punctuation">,</span>CV_16S<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">convertScaleAbs</span><span class="token punctuation">(</span>xuenai_xsobel<span class="token punctuation">,</span>xuenai_xsobel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Sobel</span><span class="token punctuation">(</span>xuenai_gray<span class="token punctuation">,</span>xuenai_ysobel<span class="token punctuation">,</span>CV_16S<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">convertScaleAbs</span><span class="token punctuation">(</span>xuenai_ysobel<span class="token punctuation">,</span>xuenai_ysobel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">addWeighted</span><span class="token punctuation">(</span>xuenai_xsobel<span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span>xuenai_ysobel<span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>xuenai_sobel2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_sobel2"</span><span class="token punctuation">,</span>xuenai_sobel2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/e3544bbf449d8a07c0bacc38d91d04ca.png" alt=""></p>
<p><strong>可以看到效果差了很多</strong></p>
<h2><a id="410_scharr_1855"></a>4.10 scharr（对灰度图）</h2>
<h3><a id="4101_ksize3_1857"></a>4.10.1 卷积核形状（ksize恒定为3）</h3>
<p>虽然Sobel算子可以有效的提取图像边缘，但是对图像中较弱的边缘提取效果较差。因此为了能够有效的提取出较弱的边缘，需要将像素值间的差距增大，因此引入Scharr算子。Scharr算子是对Sobel算子差异性的增强，因此两者之间的在检测图像边缘的原理和使用方式上相同。</p>
<pre><code class="prism language-cpp">Mat kernalX<span class="token operator">=</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span>
                                    <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span>
                                    <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Mat kernalY<span class="token operator">=</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">3</span>
                                     <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span>
                                     <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3><a id="4102_API_1870"></a>4.10.2 API</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">Scharr</span><span class="token punctuation">(</span> InputArray src<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">,</span> <span class="token keyword">int</span> ddepth<span class="token punctuation">,</span>
                          <span class="token keyword">int</span> dx<span class="token punctuation">,</span> <span class="token keyword">int</span> dy<span class="token punctuation">,</span> <span class="token keyword">double</span> scale <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">double</span> delta <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
                          <span class="token keyword">int</span> borderType <span class="token operator">=</span> BORDER_DEFAULT <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src(source)：输入图片</p>
<p>dst(destination)：输出图片</p>
<p>ddepth(destination depth)：输出图片的深度（CV_16F）</p>
<p>dx：x方向导数的阶数，一般取1</p>
<p>dy：y方向导数的阶数，一般取1</p>
<p>scale：生成图与原图的缩放比例，默认为1</p>
<p>delta：额外的增量，默认为0</p>
<p>borderType：边界填充方式，默认为黑边</p>
<h3><a id="4103__1894"></a>4.10.3 流程</h3>
<ol>
<li>用cvtColor函数转<strong>灰度图</strong></li>
<li><strong>在x,y方向上分别各调用一次Scharr</strong></li>
<li><strong>用convertScaleAbs函数转换到CV_8U，否则无法显示</strong></li>
<li><strong>用addWeighted函数把两张输出图片加在一起</strong></li>
</ol>
<h2><a id="411_Laplacian_1901"></a>4.11 Laplacian（对灰度图）</h2>
<h3><a id="4111_ksize3_1903"></a>4.11.1 卷积核形状（ksize=3）</h3>
<pre><code class="prism language-cpp">Mat kernal<span class="token operator">=</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span>
                                   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span>
                                   <span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Laplacian算子的卷积核形状决定了它 <strong>对噪声非常敏感</strong> ，因此，通常需要通过 <strong>滤波平滑处理</strong> 。</p>
<h3><a id="4112_API_1913"></a>4.11.2 API</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">Laplacian</span><span class="token punctuation">(</span> InputArray src<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">,</span> <span class="token keyword">int</span> ddepth<span class="token punctuation">,</span>
                             <span class="token keyword">int</span> ksize <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">double</span> scale <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">double</span> delta <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
                             <span class="token keyword">int</span> borderType <span class="token operator">=</span> BORDER_DEFAULT <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src(source)：输入图片</p>
<p>dst(destination)：输出图片</p>
<p>ddepth(destination depth)：输出图片的深度（CV_16F）</p>
<p>scale：生成图与原图的缩放比例，默认为1</p>
<p>delta：额外的增量，默认为0</p>
<p>borderType：边界填充方式，默认为黑边</p>
<h3><a id="4113__1933"></a>4.11.3 流程</h3>
<ol>
<li><strong>用中值滤波等操作平滑处理</strong></li>
<li>用cvtColor函数转<strong>灰度图</strong></li>
<li>用Laplacian函数处理</li>
<li><strong>用convertScaleAbs函数转换到CV_8U，否则无法显示</strong></li>
</ol>
<h2><a id="412_Cannyrecommended_1940"></a>4.12 Canny（recommended）</h2>
<h3><a id="4121_API_1942"></a>4.12.1 API</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">Canny</span><span class="token punctuation">(</span> InputArray image<span class="token punctuation">,</span> OutputArray edges<span class="token punctuation">,</span>
                         <span class="token keyword">double</span> threshold1<span class="token punctuation">,</span> <span class="token keyword">double</span> threshold2<span class="token punctuation">,</span>
                         <span class="token keyword">int</span> apertureSize <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token keyword">bool</span> L2gradient <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>image：输入图片</p>
<p>edges：输出图片</p>
<p>threshold1：最小阈值</p>
<p>threshold2：最大阈值</p>
<p><strong>高于threshold2被认为是真边界，低于threshold1被抛弃，介于二者之间，则取决于是否与真边界相连。</strong></p>
<p>apertureSize：Sobel卷积核的大小，默认为3。 <strong>核越大，对噪声越不敏感，但是边缘检测的错误也会随之增加</strong> 。</p>
<p>L2gradient：计算图像梯度幅度的标识，默认为false，表示L1范数（直接将两个方向的导数的绝对值相加）。如果使用true，表示L2范数（两个方向的导数的平方和再开方）</p>
<h3><a id="4122__1964"></a>4.12.2 流程</h3>
<ol>
<li><strong>用中值滤波等操作平滑处理</strong></li>
<li>用Canny函数处理  <strong>（不支持原地运算）</strong></li>
</ol>
<h3><a id="4123__1969"></a>4.12.3 效果</h3>
<pre><code class="prism language-cpp">    Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat <span class="token function">xuenai_canny</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Canny</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>xuenai_canny<span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_canny"</span><span class="token punctuation">,</span>xuenai_canny<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">waitKet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/e0509f034d9e5e414f1d1e0cf362540c.png" alt=""></p>
<h2><a id="413__1982"></a>4.13 添加噪声</h2>
<p>为了检测算法的稳定性，常常需要在图片中人为地添加一些噪声来进行检验。</p>
<h3><a id="4131__1984"></a>4.13.1 椒盐噪声</h3>
<pre><code class="prism language-cpp"><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">addSaltNoise</span><span class="token punctuation">(</span><span class="token keyword">const</span> Mat<span class="token operator">&amp;</span> src<span class="token punctuation">,</span>Mat<span class="token operator">&amp;</span> dst<span class="token punctuation">,</span><span class="token keyword">int</span> num<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    dst<span class="token operator">=</span>src<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> num<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//随机取值行列，得到像素点(i,j)</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> dst<span class="token punctuation">.</span>rows<span class="token punctuation">;</span>
        <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> dst<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>
        <span class="token comment">//修改像素点(i,j)的像素值</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> channel<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>channel<span class="token operator">&lt;</span>src<span class="token punctuation">.</span><span class="token function">channels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>channel<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            dst<span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">[</span>channel<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> num<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//随机取值行列</span>
        default_random_engine engine<span class="token punctuation">;</span>
        uniform_int_distribution<span class="token operator">&lt;</span><span class="token keyword">unsigned</span><span class="token operator">&gt;</span><span class="token function">u</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> dst<span class="token punctuation">.</span>rows<span class="token punctuation">;</span>
        <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> dst<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>
        <span class="token comment">//修改像素点(i,j)的像素值</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> channel<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>channel<span class="token operator">&lt;</span>src<span class="token punctuation">.</span><span class="token function">channels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>channel<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            dst<span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">[</span>channel<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>src(source)：输入图片<br>
dst(destination)：输出图片<br>
num(number)：噪声的个数</p>
<h3><a id="4132__2018"></a>4.13.2 高斯噪声</h3>
<pre><code class="prism language-cpp"><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">addGaussianNoise</span><span class="token punctuation">(</span><span class="token keyword">const</span> Mat<span class="token operator">&amp;</span> src<span class="token punctuation">,</span>Mat<span class="token operator">&amp;</span> dst<span class="token punctuation">,</span>InputArray meanValue<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>InputArray std<span class="token operator">=</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    dst<span class="token operator">=</span>src<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//构造高斯噪声矩阵</span>
    Mat <span class="token function">noise</span><span class="token punctuation">(</span>dst<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>dst<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    RNG <span class="token function">rng</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rng<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>noise<span class="token punctuation">,</span> RNG<span class="token double-colon punctuation">::</span>NORMAL<span class="token punctuation">,</span> meanValue<span class="token punctuation">,</span> std<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//将高斯噪声矩阵与原图像叠加得到含噪图像</span>
    dst<span class="token operator">+=</span>noise<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>src(source)：输入图片<br>
dst(destination)：输出图片<br>
meanValue：高斯函数均值<br>
std(standard deviation)：高斯函数标准差</p>
<h4><a id="_2036"></a>随机数填充矩阵</h4>
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">RNG</span><span class="token double-colon punctuation">::</span><span class="token function">fill</span><span class="token punctuation">(</span> InputOutputArray mat<span class="token punctuation">,</span> <span class="token keyword">int</span> distType<span class="token punctuation">,</span> InputArray a<span class="token punctuation">,</span> InputArray b<span class="token punctuation">,</span> <span class="token keyword">bool</span> saturateRange <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>mat：输入输出矩阵，最多支持4通道，超过4通道先用reshape()改变结构<br>
distType：可选UNIFORM 或 NORMAL，分别表示均匀分布和高斯分布<br>
a：disType是UNIFORM,a表示下界(闭区间)；disType是NORMAL,a表示均值<br>
b：disType是UNIFORM,b表示上界(开区间)；disType是NORMAL,b表示标准差<br>
saturateRange：只针对均匀分布有效。当为真的时候，会先把产生随机数的范围变换到数据类型的范围，再产生随机数；如果为假，会先产生随机数，再进行截断到数据类型的有效区间。</p>
<h1><a id="5_2046"></a>5.画几何图形</h1>
<h2><a id="51__2047"></a>5.1 直线</h2>
<h3><a id="511_API_2048"></a>5.1.1 API</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">line</span><span class="token punctuation">(</span>InputOutputArray img<span class="token punctuation">,</span> Point pt1<span class="token punctuation">,</span> Point pt2<span class="token punctuation">,</span> <span class="token keyword">const</span> Scalar<span class="token operator">&amp;</span> color<span class="token punctuation">,</span><span class="token keyword">int</span> thickness <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">int</span> lineType <span class="token operator">=</span> LINE_8<span class="token punctuation">,</span> <span class="token keyword">int</span> shift <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>img(image)：输入图片</p>
<p>pt1(point1)：端点1</p>
<p>pt2(point2)：端点2</p>
<p>color：颜色</p>
<p>thickness：粗细</p>
<p>lineType：连通类型</p>
<p>shift：坐标点小数点位数(not important)</p>
<h3><a id="512_2068"></a>5.1.2连通类型</h3>
<pre><code class="prism language-cpp"><span class="token keyword">enum</span> <span class="token class-name">LineTypes</span> <span class="token punctuation">{</span>
    FILLED  <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    LINE_4  <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">//!&lt; 4-connected line</span>
    LINE_8  <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token comment">//!&lt; 8-connected line</span>
    LINE_AA <span class="token operator">=</span> <span class="token number">16</span> <span class="token comment">//!&lt; antialiased line</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<ul>
<li>LINE_4与LINE_8差别不大，而LINE_AA的抗锯齿效果显著</li>
</ul>
<h2><a id="52__2081"></a>5.2 正矩形</h2>
<h3><a id="521API_2083"></a>5.2.1API</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">rectangle</span><span class="token punctuation">(</span>InputOutputArray img<span class="token punctuation">,</span> Point pt1<span class="token punctuation">,</span> Point pt2<span class="token punctuation">,</span>
                          <span class="token keyword">const</span> Scalar<span class="token operator">&amp;</span> color<span class="token punctuation">,</span> <span class="token keyword">int</span> thickness <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
                          <span class="token keyword">int</span> lineType <span class="token operator">=</span> LINE_8<span class="token punctuation">,</span> <span class="token keyword">int</span> shift <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>img(image)：输入图片</p>
<p>pt1(point1)：左上角端点</p>
<p>pt2(point2)：右下角端点</p>
<p>color：颜色</p>
<p>thickness：粗细</p>
<p>lineType：连通类型</p>
<p>shift：坐标点小数点位数(not important)</p>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">rectangle</span><span class="token punctuation">(</span>InputOutputArray img<span class="token punctuation">,</span> Rect rec<span class="token punctuation">,</span>
                          <span class="token keyword">const</span> Scalar<span class="token operator">&amp;</span> color<span class="token punctuation">,</span> <span class="token keyword">int</span> thickness <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
                          <span class="token keyword">int</span> lineType <span class="token operator">=</span> LINE_8<span class="token punctuation">,</span> <span class="token keyword">int</span> shift <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>img(image)：输入图片</p>
<p>rec(rect)：一个矩形</p>
<p>color：颜色</p>
<p>thickness：粗细</p>
<p>lineType：连通类型</p>
<p>shift：坐标点小数点位数(not important)</p>
<h2><a id="53__2123"></a>5.3 圆形</h2>
<h3><a id="531_API_2125"></a>5.3.1 API</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">circle</span><span class="token punctuation">(</span>InputOutputArray img<span class="token punctuation">,</span> Point center<span class="token punctuation">,</span> <span class="token keyword">int</span> radius<span class="token punctuation">,</span>
                       <span class="token keyword">const</span> Scalar<span class="token operator">&amp;</span> color<span class="token punctuation">,</span> <span class="token keyword">int</span> thickness <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
                       <span class="token keyword">int</span> lineType <span class="token operator">=</span> LINE_8<span class="token punctuation">,</span> <span class="token keyword">int</span> shift <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>img(image)：输入图片</p>
<p>center：圆心坐标</p>
<p>radius：半径</p>
<p>color：颜色</p>
<p><strong>thickness：粗细。若取负值，则表示进行填充</strong></p>
<p>lineType：连通类型</p>
<p>shift：坐标点小数点位数(not important)</p>
<h2><a id="54__2147"></a>5.4 椭圆</h2>
<h3><a id="541_API_2149"></a>5.4.1 API</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">ellipse</span><span class="token punctuation">(</span>InputOutputArray img<span class="token punctuation">,</span> Point center<span class="token punctuation">,</span> Size axes<span class="token punctuation">,</span>
                        <span class="token keyword">double</span> angle<span class="token punctuation">,</span> <span class="token keyword">double</span> startAngle<span class="token punctuation">,</span> <span class="token keyword">double</span> endAngle<span class="token punctuation">,</span>
                        <span class="token keyword">const</span> Scalar<span class="token operator">&amp;</span> color<span class="token punctuation">,</span> <span class="token keyword">int</span> thickness <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
                        <span class="token keyword">int</span> lineType <span class="token operator">=</span> LINE_8<span class="token punctuation">,</span> <span class="token keyword">int</span> shift <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>img(image)：输入图片</p>
<p>center：圆心坐标</p>
<p>axes：（x方向上半轴长，y方向上半轴长）</p>
<p>angle：<strong>顺时针偏角</strong></p>
<p>startAngle：以x方向上的半轴为起点，偏移一定角度后的起点，从此起点开始画椭圆</p>
<p>endAngle：以x方向上的半轴为起点，偏移一定角度后的终点，到此为止结束画椭圆</p>
<p><strong>确定起点和终点后，顺时针方向画</strong></p>
<p>color：颜色</p>
<p><strong>thickness：粗细。若取负值，则表示进行填充</strong></p>
<p>lineType：连通类型</p>
<p>shift：坐标点小数点位数(not important)</p>
<h3><a id="542__2180"></a>5.4.2 效果</h3>
<pre><code class="prism language-cpp">Mat <span class="token function">canvas</span><span class="token punctuation">(</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>CV_8U<span class="token punctuation">,</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">ellipse</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span><span class="token function">Point2f</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">,</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"canvas"</span><span class="token punctuation">,</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/94f1559f52fec20adc03fee8e954ece4.png" alt=""></p>
<pre><code>Mat canvas(Size(1000,1000),CV_8U,Scalar(255));
ellipse(canvas,Point2f(500,500),Size(50,100),20,0,360,Scalar(0,0,0),5);
imshow("canvas",canvas);
waitKey();
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/7ee8733f0daf524b918d560b71ff29b9.png" alt=""></p>
<pre><code>Mat canvas(Size(1000,1000),CV_8U,Scalar(255));
ellipse(canvas,Point2f(500,500),Size(50,100),20,0,180,Scalar(0,0,0),5);
imshow("canvas",canvas);
waitKey();
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/abecc8bdb3f811eaa659d42737dc8d32.png" alt=""></p>
<h2><a id="55__2209"></a>5.5 斜矩形</h2>
<h3><a id="551_APIRotatedRectline_2211"></a>5.5.1 API(通过RotatedRect类和line函数实现)</h3>
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">CV_EXPORTS</span> RotatedRect
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">//! default constructor</span>
    <span class="token function">RotatedRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token comment">/*center：质心坐标
      size：（x方向上全边长，y方向上全边长）
      angle：顺时针偏角
    */</span>
    <span class="token function">RotatedRect</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point2f<span class="token operator">&amp;</span> center<span class="token punctuation">,</span> <span class="token keyword">const</span> Size2f<span class="token operator">&amp;</span> size<span class="token punctuation">,</span> <span class="token keyword">float</span> angle<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
    三点确定一矩形，记得要互相垂直
     */</span>
    <span class="token function">RotatedRect</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point2f<span class="token operator">&amp;</span> point1<span class="token punctuation">,</span> <span class="token keyword">const</span> Point2f<span class="token operator">&amp;</span> point2<span class="token punctuation">,</span> <span class="token keyword">const</span> Point2f<span class="token operator">&amp;</span> point3<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/** 返回四个角点坐标，要用Point2f类型的数组对象作为参数传入，不能是仅仅是Point类型的数组对象*/</span>
    <span class="token keyword">void</span> <span class="token function">points</span><span class="token punctuation">(</span>Point2f pts<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>

    <span class="token comment">//! returns the minimal up-right integer rectangle containing the rotated rectangle</span>
    Rect <span class="token function">boundingRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>

    <span class="token comment">//! returns the minimal (exact) floating point rectangle containing the rotated rectangle, not intended for use with images</span>
    Rect_<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> <span class="token function">boundingRect2f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>

    <span class="token comment">//! returns the rectangle mass center</span>
    Point2f center<span class="token punctuation">;</span>

    <span class="token comment">//! returns width and height of the rectangle</span>
    Size2f size<span class="token punctuation">;</span>

    <span class="token comment">//! returns the rotation angle. When the angle is 0, 90, 180, 270 etc., the rectangle becomes an up-right rectangle.</span>
    <span class="token keyword">float</span> angle<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>下面是自定义的一个快捷画斜矩形的函数</p>
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">drawRotatedRect</span><span class="token punctuation">(</span>InputOutputArray img<span class="token punctuation">,</span> RotatedRect rRect<span class="token punctuation">,</span><span class="token keyword">const</span> Scalar<span class="token operator">&amp;</span> color<span class="token punctuation">,</span> <span class="token keyword">int</span> thickness <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">int</span> lineType <span class="token operator">=</span> LINE_8<span class="token punctuation">,</span> <span class="token keyword">int</span> shift <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    Point2f vertices<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    rRect<span class="token punctuation">.</span><span class="token function">points</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">line</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>vertices<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>color<span class="token punctuation">,</span>lineType<span class="token punctuation">,</span>shift<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h1><a id="6Trackbar_2263"></a>6.Trackbar控件</h1>
<h2><a id="61_createTrackbar_2265"></a>6.1 createTrackbar创建滚动条</h2>
<h3><a id="611_API_2267"></a>6.1.1 API</h3>
<pre><code class="prism language-cpp">CV_EXPORTS <span class="token keyword">int</span> <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token keyword">const</span> String<span class="token operator">&amp;</span> trackbarname<span class="token punctuation">,</span> <span class="token keyword">const</span> String<span class="token operator">&amp;</span> winname<span class="token punctuation">,</span>
                              <span class="token keyword">int</span><span class="token operator">*</span> value<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">,</span>
                              TrackbarCallback onChange <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
                              <span class="token keyword">void</span><span class="token operator">*</span> userdata <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>trackbarname：滚动条名字</p>
<p>winname(window name)：窗体名字。<strong>要先用nameWindow创建好同名窗体，滚动条才会出现</strong></p>
<p>value：欲控制的<strong>变量的地址</strong></p>
<p>count：欲控制的变量的最大值（最小为0）</p>
<p>onChange：回调函数，默认为空。如果想要传入，那么其 <strong>参数是固定的</strong> 。</p>
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>userdata：万能指针，默认为空。如果想要传入，通常用一个类的对象的地址。</p>
<h2><a id="62_getTrackbarPos_2292"></a>6.2 getTrackbarPos获得滚动条当前的值</h2>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">int</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token keyword">const</span> String<span class="token operator">&amp;</span> trackbarname<span class="token punctuation">,</span> <span class="token keyword">const</span> String<span class="token operator">&amp;</span> winname<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>trackbarname：滚动条名字</p>
<p>winname(window name)：窗体名字</p>
<h2><a id="63_recommended_2302"></a>6.3 使用方式一(recommended)</h2>
<h3><a id="631__2304"></a>6.3.1 原理</h3>
<p>不使用createTrackbar函数的参数value、onChange、userdata参数。<strong>通过while(1)的无限循环</strong>，在循环中不断地用getTrackbarPos函数<strong>动态地获取</strong>滚动条的值，然后<strong>在循环内部</strong>用这些值进行操作。</p>
<h3><a id="632__2308"></a>6.3.2 效果</h3>
<pre><code class="prism language-cpp">    Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"xuenai_rotate"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Mat <span class="token function">xuenai_rotate</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"angle"</span><span class="token punctuation">,</span><span class="token string">"xuenai_rotate"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span><span class="token number">360</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> angle<span class="token operator">=</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token string">"angle"</span><span class="token punctuation">,</span><span class="token string">"xuenai_rotate"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Mat M <span class="token operator">=</span> <span class="token function">getRotationMatrix2D</span><span class="token punctuation">(</span><span class="token function">Point2f</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span>cols <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> xuenai<span class="token punctuation">.</span>rows <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> angle<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">warpAffine</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span> xuenai_rotate<span class="token punctuation">,</span> M<span class="token punctuation">,</span> xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_rotate"</span><span class="token punctuation">,</span>xuenai_rotate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/a221a77f99d1449d72cae400f3faea8d.png" alt=""></p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/16b2444105c18183ac864cc02c7b976e.png" alt=""></p>
<h2><a id="64__2330"></a>6.4 使用方式二</h2>
<h3><a id="641__2332"></a>6.4.1 原理</h3>
<p>不使用getTrackbarPos函数，使用createTrackbar的全部参数，<strong>在onChange回调函数中完成所有操作</strong>，由于回调函数的参数表是固定的，因此**需要userdata传入所需数据。**在每次移动滚动条时，<strong>相当于调用了一次回调函数</strong>，就完成了操作。<strong>结尾没有waitKey(0)就显示不了多久。</strong></p>
<h3><a id="642__2336"></a>6.4.2 效果</h3>
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">TrackbarUserdata</span><span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    Mat input<span class="token punctuation">;</span>
    Mat output<span class="token punctuation">;</span>
    <span class="token keyword">int</span> angle<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    string winname<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">RotateonChange</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">void</span> <span class="token operator">*</span>userdata<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    TrackbarUserdata <span class="token operator">*</span>data <span class="token operator">=</span> <span class="token punctuation">(</span>TrackbarUserdata <span class="token operator">*</span><span class="token punctuation">)</span> userdata<span class="token punctuation">;</span>
    <span class="token keyword">int</span> rows <span class="token operator">=</span> data<span class="token operator">-&gt;</span>input<span class="token punctuation">.</span>rows<span class="token punctuation">;</span>
    <span class="token keyword">int</span> cols <span class="token operator">=</span> data<span class="token operator">-&gt;</span>output<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>
    Mat M <span class="token operator">=</span> <span class="token function">getRotationMatrix2D</span><span class="token punctuation">(</span><span class="token function">Point2f</span><span class="token punctuation">(</span>rows <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> cols <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token operator">-&gt;</span>angle<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">warpAffine</span><span class="token punctuation">(</span>data<span class="token operator">-&gt;</span>input<span class="token punctuation">,</span>data<span class="token operator">-&gt;</span>output<span class="token punctuation">,</span>M<span class="token punctuation">,</span>data<span class="token operator">-&gt;</span>input<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span>data<span class="token operator">-&gt;</span>winname<span class="token punctuation">,</span>data<span class="token operator">-&gt;</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat <span class="token function">xuenai_rotate</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    TrackbarUserdata userdata<span class="token punctuation">;</span>
    userdata<span class="token punctuation">.</span>input<span class="token operator">=</span>xuenai<span class="token punctuation">;</span>
    userdata<span class="token punctuation">.</span>output<span class="token operator">=</span>xuenai_rotate<span class="token punctuation">;</span>
    userdata<span class="token punctuation">.</span>winname<span class="token operator">=</span><span class="token string">"xuenai_rotate"</span><span class="token punctuation">;</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span>userdata<span class="token punctuation">.</span>winname<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"angle"</span><span class="token punctuation">,</span>userdata<span class="token punctuation">.</span>winname<span class="token punctuation">,</span> <span class="token operator">&amp;</span>userdata<span class="token punctuation">.</span>angle<span class="token punctuation">,</span><span class="token number">360</span><span class="token punctuation">,</span> RotateonChange<span class="token punctuation">,</span><span class="token operator">&amp;</span>userdata<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/img_convert/1755517361ad73efe5aa8281fcdbfcd4.png" alt=""></p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/bccd07ac8de3722cd5cc6e6ac04b9933.png" alt=""></p>
<h1><a id="7_2380"></a>7.轮廓检测（一般对二值图）</h1>
<h2><a id="71__2382"></a>7.1 查找轮廓</h2>
<h3><a id="711_API_2384"></a>7.1.1 API</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">findContours</span><span class="token punctuation">(</span> InputArray image<span class="token punctuation">,</span> OutputArrayOfArrays contours<span class="token punctuation">,</span>
                              OutputArray hierarchy<span class="token punctuation">,</span> <span class="token keyword">int</span> mode<span class="token punctuation">,</span>
                              <span class="token keyword">int</span> method<span class="token punctuation">,</span> Point offset <span class="token operator">=</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/** @overload */</span>
CV_EXPORTS <span class="token keyword">void</span> <span class="token function">findContours</span><span class="token punctuation">(</span> InputArray image<span class="token punctuation">,</span> OutputArrayOfArrays contours<span class="token punctuation">,</span>
                              <span class="token keyword">int</span> mode<span class="token punctuation">,</span> <span class="token keyword">int</span> method<span class="token punctuation">,</span> Point offset <span class="token operator">=</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>image：输入图片</p>
<p>contours：保存输出轮廓的点坐标。<strong>通常用vector&lt;vector&gt;数据类型担任，通过Point可以看出存储的是坐标。</strong></p>
<p>hierarchy：可选参数，保存输出轮廓的层级关系。<strong>通常用vector数据类型担任。</strong></p>
<p><strong>hierarchy[i][0]：第i个轮廓的同一层级后一个轮廓的索引编号。</strong></p>
<p><strong>hierarchy[i][1]：第i个轮廓的同一层级前一个轮廓的索引编号。</strong></p>
<p><strong>hierarchy[i][2]：第i个轮廓的子轮廓的索引编号。</strong></p>
<p><strong>hierarchy[i][3]：第i个轮廓的父轮廓的索引编号。</strong></p>
<p>如果当前轮廓没有对应的后一个轮廓、前一个轮廓、父轮廓或内嵌轮廓的话，则hierarchy[i][0] ~hierarchy[i][3]的相应位被设置为默认值-1。</p>
<p>mode：轮廓层级的检测模式。</p>
<p>method：轮廓坐标点的储存方式</p>
<p>offset：额外偏移量，<strong>在每一个检测出的轮廓点上加上该偏移量，可以是负值。当所分析图像是另外一个图像的ROI的时候，通过加减这个偏移量，可以把ROI图像的检测结果投影到原始图像对应位置上。</strong></p>
<h3><a id="712__2418"></a>7.1.2 轮廓层级检测模式：索引号（层级）</h3>
<pre><code class="prism language-cpp"><span class="token keyword">enum</span> <span class="token class-name">RetrievalModes</span> <span class="token punctuation">{</span>
    RETR_EXTERNAL  <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    RETR_LIST      <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
    RETR_CCOMP     <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
    RETR_TREE      <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h4><a id="RETR_EXTERNAL_2429"></a>RETR_EXTERNAL（索引顺序：从右下到左上）</h4>
<p>只检测最外围轮廓，包含在外围轮廓内的内围轮廓被忽略<br>
<img src="https://img-blog.csdnimg.cn/d29a060b4cf14dc8872e1f38bb63aeb2.jpeg#pic_center" alt="在这里插入图片描述"></p>
<h4><a id="RETR_LISTrecommended_2435"></a>RETR_LIST(recommended)（索引顺序：从右下到左上，由外到内）</h4>
<p>检测所有的轮廓，包括内围、外围轮廓，但是检测到的轮廓不建立层级关系，这就意味着这个检索模式下不存在父轮廓或内嵌轮廓，所以hierarch[i]向量内所有元素的第3、第4个分量都会被置为-1。</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/9420b0b5d69ce6d404a556896f94eed0.jpeg" alt=""></p>
<h4><a id="RETR_CCOMPnot_recommended_2441"></a>RETR_CCOMP(not recommended)（索引顺序：由内到外，从右下到左上）</h4>
<p>检测所有的轮廓，但所有轮廓只建立两个等级关系，外围为顶层，若外围内的内围轮廓还包含了其他的轮廓信息，则内围内的所有轮廓均归属于顶层</p>
<p><img src="https://img-blog.csdnimg.cn/90b1e5ea29814672b6dc37bcd0844d3b.jpeg#pic_center" alt="在这里插入图片描述"></p>
<h4><a id="RETR_TREErecommended_2448"></a>RETR_TREE(recommended)</h4>
<p>检测所有轮廓，所有轮廓建立一个等级树结构。外层轮廓包含内层轮廓，内层轮廓还可以继续包含内嵌轮廓。</p>
<p><img src="https://img-blog.csdnimg.cn/31d9ba62e87c45f6b99068091e7b6daa.jpeg#pic_center" alt="在这里插入图片描述"></p>
<h3><a id="713__2455"></a>7.1.3 轮廓坐标点储存方式</h3>
<pre><code>enum ContourApproximationModes {
    CHAIN_APPROX_NONE      = 1,
    CHAIN_APPROX_SIMPLE    = 2,
    CHAIN_APPROX_TC89_L1   = 3,
    CHAIN_APPROX_TC89_KCOS = 4
};
</code></pre>
<p>CHAIN_APPROX_NONE：保存物体边界上所有连续的轮廓点到contours向量内</p>
<p>CHAIN_APPROX_SIMPLE(recommended)：仅保存轮廓的拐点信息，把所有轮廓拐点处的点保存入contours向量内，<strong>拐点与拐点之间直线段上的信息点不予保留，效率比较高。</strong></p>
<p>CHAIN_APPROX_TC89_L1，CV_CHAIN_APPROX_TC89_KCOS：使用tehChinl chain 近似算法(not important)</p>
<h2><a id="72__2472"></a>7.2 绘制轮廓</h2>
<h3><a id="721_API_2474"></a>7.2.1 API</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">drawContours</span><span class="token punctuation">(</span> InputOutputArray image<span class="token punctuation">,</span> InputArrayOfArrays contours<span class="token punctuation">,</span>
                              <span class="token keyword">int</span> contourIdx<span class="token punctuation">,</span> <span class="token keyword">const</span> Scalar<span class="token operator">&amp;</span> color<span class="token punctuation">,</span>
                              <span class="token keyword">int</span> thickness <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">int</span> lineType <span class="token operator">=</span> LINE_8<span class="token punctuation">,</span>
                              InputArray hierarchy <span class="token operator">=</span> <span class="token function">noArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                              <span class="token keyword">int</span> maxLevel <span class="token operator">=</span> INT_MAX<span class="token punctuation">,</span> Point offset <span class="token operator">=</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>image：输入图片</p>
<p>contours：输入轮廓数组</p>
<p>contourIdx(contour index)：欲绘制的轮廓的索引值，输入-1可以绘制所有轮廓</p>
<p>color：绘制颜色</p>
<p>thickness：线条粗细，默认为1。输入-1则表示填充。</p>
<p>lineType：连通类型。</p>
<p>hierarchy：可选的层次结构信息。它仅在当你需要绘制一些轮廓线时被使用。（详见参数maxLevel）默认为noArray(),返回一个空数组。</p>
<p>maxLevel：绘制轮廓线的最高级别。此参数仅在参数hierarchy有效时被考虑。</p>
<ul>
<li>如果为0，只有被指定的轮廓被绘制。</li>
<li>如果为1，绘制被指定的轮廓和 <strong>其下一级轮廓</strong> 。</li>
<li>如果为2，绘制被指定的轮廓和 <strong>其所有子轮廓</strong> 。</li>
</ul>
<p>offset：额外偏移量。</p>
<h2><a id="73__2506"></a>7.3 轮廓面积和周长</h2>
<h3><a id="731__2508"></a>7.3.1 面积（非原地算法）</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">double</span> <span class="token function">contourArea</span><span class="token punctuation">(</span> InputArray contour<span class="token punctuation">,</span> <span class="token keyword">bool</span> oriented <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>contour：某<strong>一个</strong>轮廓，数据类型vector&lt;Point&gt;</p>
<p>oriented: 有方向的区域标志。(not important)</p>
<ol>
<li>true: 此函数依赖轮廓的方向（顺时针或逆时针）返回一个已标记区域的值。</li>
<li>false: 默认值。意味着返回不带方向的绝对值。</li>
</ol>
<p><strong>此函数利用格林公式计算轮廓的面积。对于具有自交点的轮廓，该函数几乎肯定会给出错误的结果。</strong></p>
<h3><a id="732_2523"></a>7.3.2周长（非原地算法）</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">double</span> <span class="token function">arcLength</span><span class="token punctuation">(</span> InputArray curve<span class="token punctuation">,</span> <span class="token keyword">bool</span> closed <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>curve：某<strong>一个</strong>轮廓，数据类型vector&lt;Point&gt;</p>
<p>closed：轮廓是否是闭合的。</p>
<h2><a id="74__2533"></a>7.4 多边形逼近</h2>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">approxPolyDP</span><span class="token punctuation">(</span> InputArray curve<span class="token punctuation">,</span>
                                OutputArray approxCurve<span class="token punctuation">,</span>
                                <span class="token keyword">double</span> epsilon<span class="token punctuation">,</span> <span class="token keyword">bool</span> closed <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>curve：某<strong>一个</strong>轮廓，数据类型vector&lt;Point&gt;</p>
<p>approxCurve：输出多边形的点集，数据类型vector</p>
<p>epsilon：设置精度，越小则精度越高，多边形越趋近于曲线，拟合效果更好但效率低。</p>
<p>closed：轮廓是否是闭合的。</p>
<h2><a id="75__2549"></a>7.5 凸包</h2>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">convexHull</span><span class="token punctuation">(</span> InputArray points<span class="token punctuation">,</span> OutputArray hull<span class="token punctuation">,</span>
                              <span class="token keyword">bool</span> clockwise <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">bool</span> returnPoints <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>points：输入点集</p>
<p>hull：输出凸包。 <strong>数据类型取决于returnPoints，vector&lt;Point&gt;或vector&lt;int&gt;</strong></p>
<p>clockwise：拟合凸包的直线的转动方向，TRUE为顺时针，否则为逆时针。</p>
<p>returnPoints：若为true，则在hull中存储点的坐标。若为false，则在hull中存储点的索引，索引值根据参数points得到。默认为true</p>
<h2><a id="76__2564"></a>7.6 外接矩形</h2>
<h3><a id="761RotatedRect_2566"></a>7.6.1最小外接矩形（返回RotatedRect）</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W RotatedRect <span class="token function">minAreaRect</span><span class="token punctuation">(</span> InputArray points <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>points：输入点集</p>
<h3><a id="762Rect_2574"></a>7.6.2最大外界矩形（返回Rect）</h3>
<pre><code>CV_EXPORTS_W Rect boundingRect( InputArray array );
</code></pre>
<p>points：输入点集</p>
<h1><a id="8_2581"></a>8.特征工程</h1>
<h2><a id="81__2582"></a>8.1 模板匹配</h2>
<h3><a id="811__2583"></a>8.1.1 原理</h3>
<p>模板图像在原图像上从原点开始移动，计算<strong>模板与原图被模板覆盖的地方</strong>的差别程度，计算方法有几种，然后将每次计算的结果放进输出矩阵。若原图像为A*B大小，模板为a*b大小，则 <strong>输出矩阵为(A-a+1)*(B-b+1)</strong> 大小。</p>
<h3><a id="812_API_2585"></a>8.1.2 API</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">matchTemplate</span><span class="token punctuation">(</span> InputArray image<span class="token punctuation">,</span> InputArray templ<span class="token punctuation">,</span>
                                 OutputArray result<span class="token punctuation">,</span> <span class="token keyword">int</span> method<span class="token punctuation">,</span> InputArray mask <span class="token operator">=</span> <span class="token function">noArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>image：输入图像</p>
<p>templ(template)：模板图像</p>
<p>result：输出矩阵，<strong>深度为CV_32FC1</strong>。若原图像为A*B大小，模板为a*b大小，则 <strong>输出矩阵为(A-a+1)*(B-b+1)</strong> 大小。</p>
<p>method：模板匹配计算方法。</p>
<p>mask：掩码图像。<strong>其大小与模板图像必须相同，且必须为灰度图</strong>。匹配时，对于掩码中的非0像素匹配算法起作用，掩码中的灰度值为0的像素位置，匹配算法不起作用。</p>
<h3><a id="813__2600"></a>8.1.3 模板匹配计算方法</h3>
<pre><code class="prism language-cpp"><span class="token keyword">enum</span> <span class="token class-name">TemplateMatchModes</span> <span class="token punctuation">{</span>
    TM_SQDIFF        <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> 
    TM_SQDIFF_NORMED <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> 
    TM_CCORR         <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> 
    TM_CCORR_NORMED  <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> 
    TM_CCOEFF        <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> 
    TM_CCOEFF_NORMED <span class="token operator">=</span> <span class="token number">5</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre>
<p>TM_SQDIFF：计算平方误差，计算出来的值越小，则匹配得越好<br>
TM_CCORR：计算相关性，计算出来的值越大，则匹配得越好<br>
TM_CCOEFF：计算相关系数，计算出来的值越大，则匹配得越好<br>
TM_SQDIFF_NORMED：计算归一化平方误差，计算出来的值越接近0，则匹配得越好<br>
TM_CCORR_NORMED：计算归一化相关性，计算出来的值越接近1，则匹配得越好<br>
TM_CCOEFF_NORMED：计算归一化相关系数，计算出来的值越接近1，则匹配得越好<br>
<img src="https://img-blog.csdnimg.cn/16c0a3fe93e740e98bb3318eef303a96.png#pic_center" alt="在这里插入图片描述"></p>
<h3><a id="814__2620"></a>8.1.4 掩码的使用</h3>
<p>在进行特征匹配时，我们有时并不需要用整个图片作为模板，<strong>因为模板的背景可能会干扰匹配的结果</strong>。因此，我们需要加入掩码，就可以屏蔽掉背景进行模板匹配</p>
<h4><a id="_2622"></a>获得掩码</h4>
<ol>
<li>模板图像转灰度图</li>
<li>二值化屏蔽背景</li>
</ol>
<h3><a id="815__2626"></a>8.1.5 效果</h3>
<pre><code class="prism language-cpp">        Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        Mat templ<span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai_rect.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"template"</span><span class="token punctuation">,</span>templ<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Mat match_result<span class="token punctuation">;</span>
        <span class="token function">matchTemplate</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>templ<span class="token punctuation">,</span>match_result<span class="token punctuation">,</span>TM_SQDIFF<span class="token punctuation">)</span><span class="token punctuation">;</span>

        Point temLoc<span class="token punctuation">;</span>
        Point minLoc<span class="token punctuation">;</span>
        Point maxLoc<span class="token punctuation">;</span>
        <span class="token keyword">double</span> min<span class="token punctuation">,</span>max<span class="token punctuation">;</span>
        <span class="token function">minMaxLoc</span><span class="token punctuation">(</span>match_result<span class="token punctuation">,</span><span class="token operator">&amp;</span>min<span class="token punctuation">,</span><span class="token operator">&amp;</span>max<span class="token punctuation">,</span><span class="token operator">&amp;</span>minLoc<span class="token punctuation">,</span><span class="token operator">&amp;</span>maxLoc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        temLoc<span class="token operator">=</span>minLoc<span class="token punctuation">;</span>

        <span class="token function">rectangle</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span><span class="token function">Rect</span><span class="token punctuation">(</span>temLoc<span class="token punctuation">.</span>x<span class="token punctuation">,</span>temLoc<span class="token punctuation">.</span>y<span class="token punctuation">,</span>templ<span class="token punctuation">.</span>cols<span class="token punctuation">,</span>templ<span class="token punctuation">.</span>rows<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_match"</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/906b5f8c8b4446eca64b3f9883b6188c.png#pic_center" alt="在这里插入图片描述"><br>
<img src="https://img-blog.csdnimg.cn/8be117c0005b4843bd1e480a09cc7f7d.png#pic_center" alt="在这里插入图片描述"></p>
<h3><a id="815__2653"></a>8.1.5 模板匹配的缺陷</h3>
<h4><a id="_2654"></a>无法应对旋转</h4>
<pre><code class="prism language-cpp">        Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">rotate</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>xuenai<span class="token punctuation">,</span>ROTATE_90_CLOCKWISE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>

        Mat templ<span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai_rect.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Mat match_result<span class="token punctuation">;</span>
        <span class="token function">matchTemplate</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>templ<span class="token punctuation">,</span>match_result<span class="token punctuation">,</span>TM_SQDIFF<span class="token punctuation">)</span><span class="token punctuation">;</span>

        Point temLoc<span class="token punctuation">;</span>
        Point minLoc<span class="token punctuation">;</span>
        Point maxLoc<span class="token punctuation">;</span>
        <span class="token keyword">double</span> min<span class="token punctuation">,</span>max<span class="token punctuation">;</span>
        <span class="token function">minMaxLoc</span><span class="token punctuation">(</span>match_result<span class="token punctuation">,</span><span class="token operator">&amp;</span>min<span class="token punctuation">,</span><span class="token operator">&amp;</span>max<span class="token punctuation">,</span><span class="token operator">&amp;</span>minLoc<span class="token punctuation">,</span><span class="token operator">&amp;</span>maxLoc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        temLoc<span class="token operator">=</span>minLoc<span class="token punctuation">;</span>

        <span class="token function">rectangle</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span><span class="token function">Rect</span><span class="token punctuation">(</span>temLoc<span class="token punctuation">.</span>x<span class="token punctuation">,</span>temLoc<span class="token punctuation">.</span>y<span class="token punctuation">,</span>templ<span class="token punctuation">.</span>cols<span class="token punctuation">,</span>templ<span class="token punctuation">.</span>rows<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_match"</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/f4c272690da049688bea5bbd14db6a22.png#pic_center" alt="在这里插入图片描述"></p>
<h4><a id="_2679"></a>无法应对缩放</h4>
<pre><code class="prism language-cpp">        Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resize</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>xuenai<span class="token punctuation">,</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>

        Mat templ<span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai_rect.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Mat match_result<span class="token punctuation">;</span>
        <span class="token function">matchTemplate</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>templ<span class="token punctuation">,</span>match_result<span class="token punctuation">,</span>TM_SQDIFF<span class="token punctuation">)</span><span class="token punctuation">;</span>

        Point temLoc<span class="token punctuation">;</span>
        Point minLoc<span class="token punctuation">;</span>
        Point maxLoc<span class="token punctuation">;</span>
        <span class="token keyword">double</span> min<span class="token punctuation">,</span>max<span class="token punctuation">;</span>
        <span class="token function">minMaxLoc</span><span class="token punctuation">(</span>match_result<span class="token punctuation">,</span><span class="token operator">&amp;</span>min<span class="token punctuation">,</span><span class="token operator">&amp;</span>max<span class="token punctuation">,</span><span class="token operator">&amp;</span>minLoc<span class="token punctuation">,</span><span class="token operator">&amp;</span>maxLoc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        temLoc<span class="token operator">=</span>minLoc<span class="token punctuation">;</span>

        <span class="token function">rectangle</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span><span class="token function">Rect</span><span class="token punctuation">(</span>temLoc<span class="token punctuation">.</span>x<span class="token punctuation">,</span>temLoc<span class="token punctuation">.</span>y<span class="token punctuation">,</span>templ<span class="token punctuation">.</span>cols<span class="token punctuation">,</span>templ<span class="token punctuation">.</span>rows<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_match"</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/a7a6d393150147b3916fc8450633232d.png#pic_center" alt="在这里插入图片描述"></p>
<h2><a id="82_cornerHarris_2702"></a>8.2 cornerHarris（对灰度图）</h2>
<h3><a id="821__2703"></a>8.2.1 角点的描述</h3>
<ul>
<li>一阶导数(即灰度的梯度)的局部最大所对应的像素点；</li>
<li>两条及两条以上边缘的交点；</li>
<li>图像中梯度值和梯度方向的变化速率都很高的点；</li>
<li>角点处的一阶导数最大，二阶导数为零，指示物体边缘变化不连续的方向。</li>
</ul>
<h3><a id="822_bolcksize2_2710"></a>8.2.2 原理（前置知识要求：线性代数）(bolcksize=2的情况)</h3>
<p>使用一个固定窗口在图像上进行任意方向上的滑动，比较滑动前与滑动后两种情况，窗口中的像素灰度变化程度，如果存在任意方向上的滑动，都有着较大灰度变化，那么我们可以认为该窗口中存在角点。<br>
考虑到一个灰度图像 . 划动窗口  (with displacements  在x方向和  方向)  计算像素灰度变化。</p>
<p><img src="https://img-blog.csdnimg.cn/a4ba8fb091bf40fc84a5e206b522d237.png#pic_center" alt="在这里插入图片描述"></p>
<p>其中:</p>
<ul>
<li>w(x,y) is the window at position (x,y)</li>
<li>I(x,y) is the intensity at (x,y)</li>
<li>I(x+u,y+v) is the intensity at the moved window (x+u,y+v)、</li>
</ul>
<p>为了寻找带角点的窗口，搜索像素灰度变化较大的窗口。于是, 我们期望最大化以下式子:<br>
<img src="https://img-blog.csdnimg.cn/c2defb22ed5240a4a57cd7535956b97a.png#pic_center" alt="在这里插入图片描述"><br>
泰勒展开:<br>
<img src="https://img-blog.csdnimg.cn/a2612fdd83e547e2bb4fa0c22205a6bb.png#pic_center" alt="在这里插入图片描述"></p>
<ul>
<li>Ix，Iy是通过<strong>sobel算子</strong>计算的一阶导数</li>
</ul>
<p>矩阵化:<br>
<img src="https://img-blog.csdnimg.cn/059f87c8f0c8499bb1cabdbeba91023b.png#pic_center" alt="在这里插入图片描述"><br>
得二次型:<br>
<img src="https://img-blog.csdnimg.cn/28b99fb274df4ec8ba89c7b92432c150.png#pic_center" alt="在这里插入图片描述"><br>
因此有等式:<br>
<img src="https://img-blog.csdnimg.cn/907f9a4b10c14ab792cddf69273e6c87.png#pic_center" alt="在这里插入图片描述"><br>
每个窗口中计算得到一个值。这个值决定了这个窗口中是否包含了角点。<br>
<img src="https://img-blog.csdnimg.cn/9224ab1492c748b1b3bc9cf879feadc7.png#pic_center" alt="在这里插入图片描述"></p>
<p>其中，det(M) = 矩阵M的行列式，trace(M) = 矩阵M的迹</p>
<ul>
<li>R为正值时，检测到的是角点，R为负时检测到的是边，R很小时检测到的是平坦区域。</li>
</ul>
<h3><a id="823_API_2740"></a>8.2.3 API</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">cornerHarris</span><span class="token punctuation">(</span> InputArray src<span class="token punctuation">,</span> OutputArray dst<span class="token punctuation">,</span> <span class="token keyword">int</span> blockSize<span class="token punctuation">,</span>
                                <span class="token keyword">int</span> ksize<span class="token punctuation">,</span> <span class="token keyword">double</span> k<span class="token punctuation">,</span>
                                <span class="token keyword">int</span> borderType <span class="token operator">=</span> BORDER_DEFAULT <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>src(source)：输入图片 <strong>（灰度图）</strong>，<strong>深度要求：CV_8UC1或CV_32FC1</strong></p>
<p>dst(destination)：输出图片</p>
<p>bolckSize：检测窗口的大小，<strong>越大则对角点越敏感，一般取2</strong></p>
<p>ksize(kernal size)：使用sobel算子计算一阶导数时的滤波器大小，一般取3即可。</p>
<p>k：计算用到的系数，<strong>公认一般取值在0.02~0.06。</strong></p>
<p>borderType ：边界填充方式，默认为黑边。</p>
<h3><a id="824__2759"></a>8.2.4 流程</h3>
<ol>
<li>转灰度图</li>
<li>使用cornerHarris函数检测</li>
<li><strong>使用normalize函数归一化处理和convertScaleAbs绝对化</strong></li>
<li>遍历输出图像并筛选角点。<strong>不要使用迭代器的遍历方式，因为太慢！</strong></li>
</ol>
<ul>
<li>经过实测，以下这种<strong>用行数调用ptr函数</strong>的遍历方式是最快的</li>
</ul>
<pre><code class="prism language-cpp">        Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span> xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//转灰度图</span>
        Mat <span class="token function">xuenai_gray</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">cvtColor</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">,</span>xuenai_gray<span class="token punctuation">,</span>COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>

        Mat xuenai_harris<span class="token punctuation">;</span>
        <span class="token function">cornerHarris</span><span class="token punctuation">(</span>xuenai_gray<span class="token punctuation">,</span>xuenai_harris<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0.04</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">normalize</span><span class="token punctuation">(</span>xuenai_harris<span class="token punctuation">,</span>xuenai_harris<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>NORM_MINMAX<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">convertScaleAbs</span><span class="token punctuation">(</span>xuenai_harris<span class="token punctuation">,</span>xuenai_harris<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"xuenai_harris"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"threshold"</span><span class="token punctuation">,</span><span class="token string">"xuenai_harris"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> thres <span class="token operator">=</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token string">"threshold"</span><span class="token punctuation">,</span> <span class="token string">"xuenai_harris"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>thres<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>thres<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>
            Mat harris_result<span class="token operator">=</span>xuenai<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>xuenai_harris<span class="token punctuation">.</span>rows<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                uchar <span class="token operator">*</span> ptr <span class="token operator">=</span>xuenai_harris<span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>xuenai_harris<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">int</span> value<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token operator">*</span>ptr<span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>value<span class="token operator">&gt;</span>thres<span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token function">circle</span><span class="token punctuation">(</span>harris_result<span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    ptr<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_harris"</span><span class="token punctuation">,</span>harris_result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'q'</span><span class="token punctuation">)</span><span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/16d050f0065d4586b3b70bcfc00e9baf.png#pic_center" alt="在这里插入图片描述"></p>
<h3><a id="825__2802"></a>8.2.5 优点与缺点</h3>
<h4><a id="_2803"></a>测试代码</h4>
<pre><code class="prism language-cpp">        Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span> xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"threshold"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"angle"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span><span class="token number">360</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"width"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"height"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> thres <span class="token operator">=</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token string">"threshold"</span><span class="token punctuation">,</span> <span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>thres<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>thres<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token string">"width"</span><span class="token punctuation">,</span> <span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>width<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>width<span class="token operator">=</span>xuenai<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>
            <span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token string">"height"</span><span class="token punctuation">,</span> <span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>height<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>height<span class="token operator">=</span>xuenai<span class="token punctuation">.</span>rows<span class="token punctuation">;</span>
            <span class="token keyword">int</span> angle <span class="token operator">=</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token string">"angle"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            

            Mat xuenai_harris<span class="token punctuation">,</span> xuenai_transform<span class="token operator">=</span>xuenai<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">resize</span><span class="token punctuation">(</span>xuenai_transform<span class="token punctuation">,</span>xuenai_transform<span class="token punctuation">,</span><span class="token function">Size</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span>height<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Mat M<span class="token operator">=</span> <span class="token function">getRotationMatrix2D</span><span class="token punctuation">(</span><span class="token function">Point2f</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span>cols<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span>rows<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>angle<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">warpAffine</span><span class="token punctuation">(</span>xuenai_transform<span class="token punctuation">,</span>xuenai_transform<span class="token punctuation">,</span>M<span class="token punctuation">,</span>xuenai_transform<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Mat <span class="token function">xuenai_gray</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">cvtColor</span><span class="token punctuation">(</span>xuenai_transform<span class="token punctuation">,</span>xuenai_gray<span class="token punctuation">,</span>COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">cornerHarris</span><span class="token punctuation">(</span>xuenai_gray<span class="token punctuation">,</span>xuenai_harris<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0.04</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">normalize</span><span class="token punctuation">(</span>xuenai_harris<span class="token punctuation">,</span>xuenai_harris<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>NORM_MINMAX<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">convertScaleAbs</span><span class="token punctuation">(</span>xuenai_harris<span class="token punctuation">,</span>xuenai_harris<span class="token punctuation">)</span><span class="token punctuation">;</span>

            Mat harris_result<span class="token operator">=</span>xuenai_transform<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>xuenai_harris<span class="token punctuation">.</span>rows<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                uchar <span class="token operator">*</span> ptr <span class="token operator">=</span>xuenai_harris<span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>xuenai_harris<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">int</span> value<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token operator">*</span>ptr<span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>value<span class="token operator">&gt;</span>thres<span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token function">circle</span><span class="token punctuation">(</span>harris_result<span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    ptr<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_harris"</span><span class="token punctuation">,</span>harris_result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'q'</span><span class="token punctuation">)</span><span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre>
<h4><a id="_2854"></a>图片旋转，角点不变</h4>
<p><img src="https://img-blog.csdnimg.cn/3023822133ad489fbcca66b8a692544e.png#pic_center" alt="在这里插入图片描述"><br>
<img src="https://img-blog.csdnimg.cn/f7bcbf5e918d4488bc08310ab5e89760.png#pic_center" alt="在这里插入图片描述"></p>
<h4><a id="_2858"></a>图片缩放，角点改变</h4>
<p><img src="https://img-blog.csdnimg.cn/bf2c05b6a7f1425893df5c0dba046a9f.png#pic_center" alt="在这里插入图片描述"><br>
<img src="https://img-blog.csdnimg.cn/fa1d6fa2b4b34a4bb64bb670cbe46521.png#pic_center" alt="在这里插入图片描述"></p>
<h2><a id="83__ShiTomasi_2863"></a>8.3  Shi-Tomasi（对灰度图）</h2>
<h3><a id="831__2864"></a>8.3.1 原理</h3>
<p>由于cornerHarris角点检的稳定性与k密切相关，而k是个经验值，难以设定最佳值，Shi-Tomasi在这一点上进行了改进</p>
<ul>
<li>计算角点分数<br>
<img src="https://img-blog.csdnimg.cn/7574b7b25aae46dfa6fbbaca1516054c.png#pic_center" alt="在这里插入图片描述"></li>
</ul>
<h3><a id="832_API_2868"></a>8.3.2 API</h3>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">goodFeaturesToTrack</span><span class="token punctuation">(</span> InputArray image<span class="token punctuation">,</span> OutputArray corners<span class="token punctuation">,</span>
                                     <span class="token keyword">int</span> maxCorners<span class="token punctuation">,</span> <span class="token keyword">double</span> qualityLevel<span class="token punctuation">,</span> <span class="token keyword">double</span> minDistance<span class="token punctuation">,</span>
                                     InputArray mask <span class="token operator">=</span> <span class="token function">noArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">int</span> blockSize <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
                                     <span class="token keyword">bool</span> useHarrisDetector <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">double</span> k <span class="token operator">=</span> <span class="token number">0.04</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">goodFeaturesToTrack</span><span class="token punctuation">(</span> InputArray image<span class="token punctuation">,</span> OutputArray corners<span class="token punctuation">,</span>
                                     <span class="token keyword">int</span> maxCorners<span class="token punctuation">,</span> <span class="token keyword">double</span> qualityLevel<span class="token punctuation">,</span> <span class="token keyword">double</span> minDistance<span class="token punctuation">,</span>
                                     InputArray mask<span class="token punctuation">,</span> <span class="token keyword">int</span> blockSize<span class="token punctuation">,</span>
                                     <span class="token keyword">int</span> gradientSize<span class="token punctuation">,</span> <span class="token keyword">bool</span> useHarrisDetector <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                                     <span class="token keyword">double</span> k <span class="token operator">=</span> <span class="token number">0.04</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>image：输入图片</p>
<p>corners：输出角点的点集，数据类型vector</p>
<p>maxCorners：控制输出角点点集的上限个数，即控制corners.size()。<strong>输入0则表示不限制上限</strong></p>
<p>qualityLevel：质量系数（小于1.0的正数，一般在0.01-0.1之间），<strong>表示可接受角点的最低质量水平</strong>。该系数乘以输入图像中最大的角点分数，作为可接受的最小分数；例如，如果输入图像中最大的角点分数值为1500且质量系数为0.01，那么所有角点分数小于15的角都将被忽略。</p>
<p>minDistance：角点之间的最小欧式距离，<strong>小于此距离的点将被忽略</strong>。</p>
<p>mask：掩码图像。<strong>其大小与输入图像必须相同，且必须为灰度图</strong>。计算时，对于掩码中的非0像素算法起作用，掩码中的灰度值为0的像素位置，算法不起作用。</p>
<p>blockSize：检测窗口的大小，<strong>越大则对角点越敏感</strong>。</p>
<p>useHarrisDetector：用于指定角点检测的方法，如果是true则使用Harris角点检测，false则使用Shi Tomasi算法。默认为False。</p>
<p>k：默认为0.04，只有useHarrisDetector参数为true时起作用。</p>
<h3><a id="833__2899"></a>8.3.3 流程</h3>
<ol>
<li>转灰度图</li>
<li>使用Shi-Tomasi函数检测</li>
<li>遍历角点集合即可</li>
</ol>
<h3><a id="834__2905"></a>8.3.4 效果</h3>
<ul>
<li>Shi-Tomasi同样具有旋转不变性和尺度可变性</li>
</ul>
<pre><code class="prism language-cpp">        Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span> xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"threshold"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"angle"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span><span class="token number">360</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"width"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"height"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> thres <span class="token operator">=</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token string">"threshold"</span><span class="token punctuation">,</span> <span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>thres<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>thres<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token string">"width"</span><span class="token punctuation">,</span> <span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>width<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>width<span class="token operator">=</span>xuenai<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>
            <span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token string">"height"</span><span class="token punctuation">,</span> <span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>height<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>height<span class="token operator">=</span>xuenai<span class="token punctuation">.</span>rows<span class="token punctuation">;</span>
            <span class="token keyword">int</span> angle <span class="token operator">=</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token string">"angle"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Mat xuenai_transform<span class="token operator">=</span>xuenai<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">resize</span><span class="token punctuation">(</span>xuenai_transform<span class="token punctuation">,</span>xuenai_transform<span class="token punctuation">,</span><span class="token function">Size</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span>height<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Mat M<span class="token operator">=</span> <span class="token function">getRotationMatrix2D</span><span class="token punctuation">(</span><span class="token function">Point2f</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span>cols<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span>rows<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>angle<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">warpAffine</span><span class="token punctuation">(</span>xuenai_transform<span class="token punctuation">,</span>xuenai_transform<span class="token punctuation">,</span>M<span class="token punctuation">,</span>xuenai_transform<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Mat <span class="token function">xuenai_gray</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">cvtColor</span><span class="token punctuation">(</span>xuenai_transform<span class="token punctuation">,</span>xuenai_gray<span class="token punctuation">,</span>COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>

            vector<span class="token operator">&lt;</span>Point2f<span class="token operator">&gt;</span>xuenai_cornersSet<span class="token punctuation">;</span>
            <span class="token function">goodFeaturesToTrack</span><span class="token punctuation">(</span>xuenai_gray<span class="token punctuation">,</span>xuenai_cornersSet<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> corner<span class="token operator">:</span>xuenai_cornersSet<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">circle</span><span class="token punctuation">(</span>xuenai_transform<span class="token punctuation">,</span>corner<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai_corners"</span><span class="token punctuation">,</span>xuenai_transform<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'q'</span><span class="token punctuation">)</span><span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/e11d955293d54951935325892819fc3d.png#pic_center" alt="在这里插入图片描述"><br>
<img src="https://img-blog.csdnimg.cn/b4b2ac33bc1243db8e1b7dc111defe3f.png#pic_center" alt="在这里插入图片描述"><br>
<img src="https://img-blog.csdnimg.cn/2ac71b6ab89542a793651284f9adc506.png#pic_center" alt="在这里插入图片描述"></p>
<h2><a id="84_SIFTSURF_2951"></a>8.4 SIFT与SURF（对灰度图）</h2>
<h3><a id="841__2952"></a>8.4.1 概述</h3>
<p>cornerHarris和Shi-Tomasi都没能保证角点在尺度上的稳定性，因此<strong>SIFT和SURF针对这一特点进行了优化</strong>。由于其数学原理较为复杂，请自行查阅相关论文和文献，本文不再赘述。<br>
相较于cornerHarris和Shi-Tomasi，SIFT和SURF的优点是显著的，其检测出的角点<strong>对旋转、尺度缩放、亮度变化等保持不变性，对视角变换、仿射变化、噪声也保持一定程度的稳定性</strong>，是一种非常优秀的局部特征描述算法。<br>
需要注意的是，SIFT和SURF的计算量较为庞大，<strong>难以做到实时运算</strong>。SIFT和SURF两者相比，<strong>SIFT更为精确，SURF更为高效。</strong></p>
<h3><a id="842_API_2956"></a>8.4.2 API</h3>
<h4><a id="_2957"></a>构造函数</h4>
<pre><code class="prism language-cpp">    CV_WRAP <span class="token keyword">static</span> Ptr<span class="token operator">&lt;</span>SIFT<span class="token operator">&gt;</span> <span class="token class-name">SIFT</span><span class="token double-colon punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">int</span> nfeatures <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> nOctaveLayers <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token keyword">double</span> contrastThreshold <span class="token operator">=</span> <span class="token number">0.04</span><span class="token punctuation">,</span> <span class="token keyword">double</span> edgeThreshold <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token keyword">double</span> sigma <span class="token operator">=</span> <span class="token number">1.6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    CV_WRAP <span class="token keyword">static</span> Ptr<span class="token operator">&lt;</span>SIFT<span class="token operator">&gt;</span> <span class="token class-name">SIFT</span><span class="token double-colon punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">int</span> nfeatures<span class="token punctuation">,</span> <span class="token keyword">int</span> nOctaveLayers<span class="token punctuation">,</span>
        <span class="token keyword">double</span> contrastThreshold<span class="token punctuation">,</span> <span class="token keyword">double</span> edgeThreshold<span class="token punctuation">,</span>
        <span class="token keyword">double</span> sigma<span class="token punctuation">,</span> <span class="token keyword">int</span> descriptorType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    CV_WRAP <span class="token keyword">static</span> Ptr<span class="token operator">&lt;</span>SURF<span class="token operator">&gt;</span> <span class="token class-name">SURF</span><span class="token double-colon punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">double</span> hessianThreshold<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>
                  <span class="token keyword">int</span> nOctaves <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token keyword">int</span> nOctaveLayers <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
                  <span class="token keyword">bool</span> extended <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">bool</span> upright <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ul>
<li>构造函数的参数设计复杂的数学原理，在此不进行解释，在使用时进行默认的构造即可。</li>
</ul>
<h4><a id="_2973"></a>进行关键点检测和描述子计算</h4>
<pre><code class="prism language-cpp">    CV_WRAP <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token class-name">Feature2D</span><span class="token double-colon punctuation">::</span><span class="token function">detect</span><span class="token punctuation">(</span> InputArray image<span class="token punctuation">,</span>
                                 CV_OUT std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>KeyPoint<span class="token operator">&gt;</span><span class="token operator">&amp;</span> keypoints<span class="token punctuation">,</span>
                                 InputArray mask<span class="token operator">=</span><span class="token function">noArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
                                 
    CV_WRAP <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token class-name">Feature2D</span><span class="token double-colon punctuation">::</span><span class="token function">detect</span><span class="token punctuation">(</span> InputArrayOfArrays images<span class="token punctuation">,</span>
                         CV_OUT std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>KeyPoint<span class="token operator">&gt;</span> <span class="token operator">&gt;</span><span class="token operator">&amp;</span> keypoints<span class="token punctuation">,</span>
                         InputArrayOfArrays masks<span class="token operator">=</span><span class="token function">noArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>image：输入图像</p>
<p>keypoints：含多个关键点的vector&lt;KeyPoint&gt;。<strong>使用detect时作为输出，使用compute时作为输入，使用detectAndCompute时可以作为输入也可以作为输出。</strong></p>
<p>mask：掩码图像。<strong>其大小与输入图像必须相同，且必须为灰度图</strong>。计算时，对于掩码中的非0像素算法起作用，掩码中的灰度值为0的像素位置，算法不起作用。</p>
<pre><code class="prism language-cpp">    CV_WRAP <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token class-name">Feature2D</span><span class="token double-colon punctuation">::</span><span class="token function">compute</span><span class="token punctuation">(</span> InputArray image<span class="token punctuation">,</span>
                                  CV_OUT CV_IN_OUT std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>KeyPoint<span class="token operator">&gt;</span><span class="token operator">&amp;</span> keypoints<span class="token punctuation">,</span>
                                  OutputArray descriptors <span class="token punctuation">)</span><span class="token punctuation">;</span>
    CV_WRAP <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token class-name">Feature2D</span><span class="token double-colon punctuation">::</span><span class="token function">compute</span><span class="token punctuation">(</span> InputArrayOfArrays images<span class="token punctuation">,</span>
                          CV_OUT CV_IN_OUT std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>KeyPoint<span class="token operator">&gt;</span> <span class="token operator">&gt;</span><span class="token operator">&amp;</span> keypoints<span class="token punctuation">,</span>
                          OutputArrayOfArrays descriptors <span class="token punctuation">)</span><span class="token punctuation">;</span>
    CV_WRAP <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token class-name">Feature2D</span><span class="token double-colon punctuation">::</span><span class="token function">detectAndCompute</span><span class="token punctuation">(</span> InputArray image<span class="token punctuation">,</span> InputArray mask<span class="token punctuation">,</span>
                                           CV_OUT std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>KeyPoint<span class="token operator">&gt;</span><span class="token operator">&amp;</span> keypoints<span class="token punctuation">,</span>
                                           OutputArray descriptors<span class="token punctuation">,</span>
                                           <span class="token keyword">bool</span> useProvidedKeypoints<span class="token operator">=</span><span class="token boolean">false</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>image：输入图像</p>
<p>keypoints：含多个关键点的vector&lt;KeyPoint&gt;。<strong>使用detect时作为输出，使用compute时作为输入，使用detectAndCompute时可以作为输入也可以作为输出。</strong></p>
<p>descriptors：描述子，数据类型Mat，。<strong>在进行特征匹配的时候会用到</strong>。</p>
<p>useProvidedKeypoints：<strong>false时，keypoints作为输出，并根据keypoints算出descriptors。true时，keypoints作为输入，不再进行detect，即不修改keypoints，并根据keypoints算出descriptors。</strong></p>
<h4><a id="drawKeypoints_3009"></a>drawKeypoints绘制关键点</h4>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">drawKeypoints</span><span class="token punctuation">(</span> InputArray image<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>KeyPoint<span class="token operator">&gt;</span><span class="token operator">&amp;</span> keypoints<span class="token punctuation">,</span> InputOutputArray outImage<span class="token punctuation">,</span>
                               <span class="token keyword">const</span> Scalar<span class="token operator">&amp;</span> color<span class="token operator">=</span><span class="token class-name">Scalar</span><span class="token double-colon punctuation">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DrawMatchesFlags flags<span class="token operator">=</span>DrawMatchesFlags<span class="token double-colon punctuation">::</span>DEFAULT <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">enum</span> <span class="token keyword">struct</span> <span class="token class-name">DrawMatchesFlags</span>
<span class="token punctuation">{</span>
  DEFAULT <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//!&lt; Output image matrix will be created (Mat::create),</span>
               <span class="token comment">//!&lt; i.e. existing memory of output image may be reused.</span>
               <span class="token comment">//!&lt; Two source image, matches and single keypoints will be drawn.</span>
               <span class="token comment">//!&lt; For each keypoint only the center point will be drawn (without</span>
               <span class="token comment">//!&lt; the circle around keypoint with keypoint size and orientation).</span>
  DRAW_OVER_OUTIMG <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//!&lt; Output image matrix will not be created (Mat::create).</span>
                        <span class="token comment">//!&lt; Matches will be drawn on existing content of output image.</span>
  NOT_DRAW_SINGLE_POINTS <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">//!&lt; Single keypoints will not be drawn.</span>
  DRAW_RICH_KEYPOINTS <span class="token operator">=</span> <span class="token number">4</span> <span class="token comment">//!&lt; For each keypoint the circle around keypoint with keypoint size and</span>
                          <span class="token comment">//!&lt; orientation will be drawn.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>image：输入图像</p>
<p>keypoints：含多个关键点的vector数组。</p>
<p>outImage：输出图像</p>
<p>color：绘制颜色信息，默认绘制的是随机彩色。</p>
<p>flags：特征点的绘制模式，其实就是设置特征点的那些信息需要绘制，那些不需要绘制。</p>
<p>DrawMatchesFlags::DEFAULT：只绘制特征点的坐标点，显示在图像上就是一个个小圆点，每个小圆点的圆心坐标都是特征点的坐标。</p>
<p>DrawMatchesFlags::DRAW_OVER_OUTIMG：函数不创建输出的图像，而是直接在输出图像变量空间绘制，要求本身输出图像变量就是一个初始化好了的，size与type都是已经初始化好的变量。</p>
<p>DrawMatchesFlags::NOT_DRAW_SINGLE_POINTS：单点的特征点不被绘制。</p>
<p>DrawMatchesFlags::DRAW_RICH_KEYPOINTS ：绘制特征点的时候绘制的是一个个带有方向的圆，这种方法同时显示图像的坐标，size和方向，是最能显示特征的一种绘制方式。</p>
<h3><a id="843__3047"></a>8.4.3 流程</h3>
<ol>
<li>实例化SIFT或SURF对象</li>
<li><strong>将输入图像转灰度图</strong></li>
<li>根据需要，调用detect函数或compute函数或detectAndCompute函数，检测关键点和计算描述子</li>
<li>调用drawKeypoints函数绘制关键点</li>
</ol>
<h3><a id="844__3054"></a>8.4.4 效果</h3>
<pre><code class="prism language-cpp">        Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span> xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"threshold"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"angle"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span><span class="token number">360</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"width"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"height"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> thres <span class="token operator">=</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token string">"threshold"</span><span class="token punctuation">,</span> <span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>thres<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>thres<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token string">"width"</span><span class="token punctuation">,</span> <span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>width<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>width<span class="token operator">=</span>xuenai<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>
            <span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token string">"height"</span><span class="token punctuation">,</span> <span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>height<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>height<span class="token operator">=</span>xuenai<span class="token punctuation">.</span>rows<span class="token punctuation">;</span>
            <span class="token keyword">int</span> angle <span class="token operator">=</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token string">"angle"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Mat xuenai_transform<span class="token operator">=</span>xuenai<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">resize</span><span class="token punctuation">(</span>xuenai_transform<span class="token punctuation">,</span>xuenai_transform<span class="token punctuation">,</span><span class="token function">Size</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span>height<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Mat M<span class="token operator">=</span> <span class="token function">getRotationMatrix2D</span><span class="token punctuation">(</span><span class="token function">Point2f</span><span class="token punctuation">(</span>xuenai_transform<span class="token punctuation">.</span>cols<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>xuenai_transform<span class="token punctuation">.</span>rows<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>angle<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">warpAffine</span><span class="token punctuation">(</span>xuenai_transform<span class="token punctuation">,</span>xuenai_transform<span class="token punctuation">,</span>M<span class="token punctuation">,</span>xuenai_transform<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Mat <span class="token function">xuenai_gray</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">cvtColor</span><span class="token punctuation">(</span>xuenai_transform<span class="token punctuation">,</span>xuenai_gray<span class="token punctuation">,</span>COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>

            Ptr<span class="token operator">&lt;</span>SIFT<span class="token operator">&gt;</span> sift<span class="token operator">=</span><span class="token class-name">SIFT</span><span class="token double-colon punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Ptr<span class="token operator">&lt;</span>SURF<span class="token operator">&gt;</span> surf<span class="token operator">=</span><span class="token class-name">SURF</span><span class="token double-colon punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            vector<span class="token operator">&lt;</span>KeyPoint<span class="token operator">&gt;</span>xuenai_SiftKp<span class="token punctuation">,</span>xuenai_Surfp<span class="token punctuation">;</span>
            sift<span class="token operator">-&gt;</span><span class="token function">detect</span><span class="token punctuation">(</span>xuenai_gray<span class="token punctuation">,</span>xuenai_SiftKp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            surf<span class="token operator">-&gt;</span><span class="token function">detect</span><span class="token punctuation">(</span>xuenai_gray<span class="token punctuation">,</span>xuenai_Surfp<span class="token punctuation">)</span><span class="token punctuation">;</span>

            Mat sift_result<span class="token operator">=</span>xuenai_transform<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>surf_result<span class="token operator">=</span>xuenai_transform<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">drawKeypoints</span><span class="token punctuation">(</span>sift_result<span class="token punctuation">,</span>xuenai_SiftKp<span class="token punctuation">,</span>sift_result<span class="token punctuation">,</span><span class="token class-name">Scalar</span><span class="token double-colon punctuation">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>DrawMatchesFlags<span class="token double-colon punctuation">::</span>DRAW_RICH_KEYPOINTS<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">drawKeypoints</span><span class="token punctuation">(</span>surf_result<span class="token punctuation">,</span>xuenai_Surfp<span class="token punctuation">,</span>surf_result<span class="token punctuation">,</span><span class="token class-name">Scalar</span><span class="token double-colon punctuation">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>DrawMatchesFlags<span class="token double-colon punctuation">::</span>DRAW_RICH_KEYPOINTS<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"sift_result"</span><span class="token punctuation">,</span>sift_result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"surf_result"</span><span class="token punctuation">,</span>surf_result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'q'</span><span class="token punctuation">)</span><span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/e7e177a72bce448c834c8e8781cc9580.png#pic_center" alt="在这里插入图片描述"></p>
<h4><a id="_3099"></a>进行缩放和旋转</h4>
<p><img src="https://img-blog.csdnimg.cn/e363923230c9424db30bc8443b67a34b.png#pic_center" alt="在这里插入图片描述"><br>
<img src="https://img-blog.csdnimg.cn/3eff2dacd5a14791aecfe8340405ef50.png#pic_center" alt="在这里插入图片描述"></p>
<ul>
<li>可以看到，无论是旋转还是缩放，关键点都保持得非常稳定。</li>
</ul>
<h2><a id="85_FASTOBR_3105"></a>8.5 FAST到OBR（对灰度图）</h2>
<h3><a id="851__3106"></a>8.5.1 概述</h3>
<p>前文已经阐述，SIFT和SURF已经做到了角点在旋转和缩放下的稳定性，但是它们还有一个致命的缺陷，<strong>就是它们难以做到实时运算</strong>，因此，FAST和OBR应运而生了。</p>
<h4><a id="FAST_3108"></a>FAST原理</h4>
<p>从图片中选取一个坐标点P,获取该点的像素值,接下来判定该点是否为特征点.<br>
选取一个以选取点P坐标为圆心的半径等于r的Bresenham圆(一个计算圆的轨迹的离散算法,得到整数级的圆的轨迹点),一般来说,这个圆上有16个点,如下所示<br>
<img src="https://img-blog.csdnimg.cn/40f0ba43a7d749a8891414754dfa157e.png#pic_center" alt="在这里插入图片描述"></p>
<ol>
<li>p在图像中表示一个被识别为兴趣点的像素。令它的强度为 Ip；</li>
<li>选择一个合适的阈值t；</li>
<li>考虑被测像素周围的16个像素的圆圈。 如果这16个像素中存在一组ñ个连续的像素的像素值，比 Ip+t 大，或比 Ip−t小，则像素p是一个角点。ñ被设置为12。</li>
<li>使用一种快速测试（high-speed test）可快速排除了大量的非角点。这个方法只检测在1、9、5、13个四个位置的像素，（首先检测1、9位置的像素与阈值比是否太亮或太暗，如果是，则检查5、13）。如果p是一个角点，则至少有3个像素比 Ip+t大或比 Ip−t暗。如果这两者都不是这样的话，那么p就不能成为一个角点。然后可以通过检查圆中的所有像素，将全部分段测试标准应用于通过的对候选的角点。这种探测器本身表现出很高的性能，但有一些缺点：</li>
</ol>
<ul>
<li>它不能拒绝n &lt;12的候选角点。当n&lt;12时可能会有较多的候选角点出现</li>
<li>检测到的角点不是最优的，因为它的效率取决于问题的排序和角点的分布。</li>
<li>角点分析的结果被扔掉了。过度依赖于阈值</li>
<li>多个特征点容易挤到一起。</li>
<li>前三点是用机器学习方法解决的。最后一个是使用非极大值抑制来解决。具体不再展开。</li>
</ul>
<p><strong>FAST算法虽然很快，但是没有建立关键点的描述子，也就无法进行特征匹配</strong></p>
<h4><a id="OBR_3124"></a>OBR简介</h4>
<p>ORB 是 Oriented Fast and Rotated Brief 的简称，从这个简介就可以看出，OBR算法是基础FAST算法的改进。其中，Fast 和 Brief 分别是特征检测算法和向量创建算法。ORB 首先会从图像中查找特殊区域，称为关键点。关键点即图像中突出的小区域，比如角点，比如它们具有像素值急剧的从浅色变为深色的特征。然后 ORB 会为每个关键点计算相应的特征向量。ORB 算法创建的特征向量只包含 1 和 0，称为二元特征向量。1 和 0 的顺序会根据特定关键点和其周围的像素区域而变化。该向量表示关键点周围的强度模式，因此多个特征向量可以用来识别更大的区域，甚至图像中的特定对象。<br>
关于Brief算法的具体原理本文不再赘述，请自行查阅相关论文和文献。</p>
<h3><a id="852_API_3128"></a>8.5.2 API</h3>
<h4><a id="_3129"></a>构造函数</h4>
<pre><code class="prism language-cpp">    CV_WRAP <span class="token keyword">static</span> Ptr<span class="token operator">&lt;</span>FastFeatureDetector<span class="token operator">&gt;</span> <span class="token function">create</span><span class="token punctuation">(</span> <span class="token keyword">int</span> threshold<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>
                                                    <span class="token keyword">bool</span> nonmaxSuppression<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">,</span>
                                                    FastFeatureDetector<span class="token double-colon punctuation">::</span>DetectorType type<span class="token operator">=</span>FastFeatureDetector<span class="token double-colon punctuation">::</span>TYPE_9_16 <span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                    
    CV_WRAP <span class="token keyword">static</span> Ptr<span class="token operator">&lt;</span>ORB<span class="token operator">&gt;</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">int</span> nfeatures<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token keyword">float</span> scaleFactor<span class="token operator">=</span><span class="token number">1.2f</span><span class="token punctuation">,</span> <span class="token keyword">int</span> nlevels<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token keyword">int</span> edgeThreshold<span class="token operator">=</span><span class="token number">31</span><span class="token punctuation">,</span>
                                   <span class="token keyword">int</span> firstLevel<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> WTA_K<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> ORB<span class="token double-colon punctuation">::</span>ScoreType scoreType<span class="token operator">=</span>ORB<span class="token double-colon punctuation">::</span>HARRIS_SCORE<span class="token punctuation">,</span> <span class="token keyword">int</span> patchSize<span class="token operator">=</span><span class="token number">31</span><span class="token punctuation">,</span> <span class="token keyword">int</span> fastThreshold<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>threshold：进行FAST检测时用到的阈值，<strong>阈值越大检测到的角点越少</strong></p>
<h3><a id="853__3139"></a>8.5.3 流程</h3>
<ol>
<li>实例化FAST或OBR对象</li>
<li><strong>将输入图像转灰度图</strong></li>
<li>根据需要，调用detect函数或compute函数或detectAndCompute函数，检测关键点和计算描述子</li>
<li>调用drawKeypoints函数绘制关键点</li>
</ol>
<h3><a id="854__3144"></a>8.5.4 效果</h3>
<pre><code class="prism language-cpp">        Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span> xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"threshold"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"angle"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span><span class="token number">360</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"width"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"height"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> thres <span class="token operator">=</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token string">"threshold"</span><span class="token punctuation">,</span> <span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>thres<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>thres<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token string">"width"</span><span class="token punctuation">,</span> <span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>width<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>width<span class="token operator">=</span>xuenai<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>
            <span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token string">"height"</span><span class="token punctuation">,</span> <span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>height<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>height<span class="token operator">=</span>xuenai<span class="token punctuation">.</span>rows<span class="token punctuation">;</span>
            <span class="token keyword">int</span> angle <span class="token operator">=</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token string">"angle"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Mat xuenai_transform<span class="token operator">=</span>xuenai<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">resize</span><span class="token punctuation">(</span>xuenai_transform<span class="token punctuation">,</span>xuenai_transform<span class="token punctuation">,</span><span class="token function">Size</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span>height<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Mat M<span class="token operator">=</span> <span class="token function">getRotationMatrix2D</span><span class="token punctuation">(</span><span class="token function">Point2f</span><span class="token punctuation">(</span>xuenai_transform<span class="token punctuation">.</span>cols<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>xuenai_transform<span class="token punctuation">.</span>rows<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>angle<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">warpAffine</span><span class="token punctuation">(</span>xuenai_transform<span class="token punctuation">,</span>xuenai_transform<span class="token punctuation">,</span>M<span class="token punctuation">,</span>xuenai_transform<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Mat <span class="token function">xuenai_gray</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">cvtColor</span><span class="token punctuation">(</span>xuenai_transform<span class="token punctuation">,</span>xuenai_gray<span class="token punctuation">,</span>COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>

            Ptr<span class="token operator">&lt;</span>FastFeatureDetector<span class="token operator">&gt;</span>fast<span class="token operator">=</span><span class="token class-name">FastFeatureDetector</span><span class="token double-colon punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span>thres<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Ptr<span class="token operator">&lt;</span>ORB<span class="token operator">&gt;</span>obr<span class="token operator">=</span><span class="token class-name">ORB</span><span class="token double-colon punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            vector<span class="token operator">&lt;</span>KeyPoint<span class="token operator">&gt;</span>xuenai_FastKp<span class="token punctuation">,</span>xuenai_ObrKp<span class="token punctuation">;</span>
            fast<span class="token operator">-&gt;</span><span class="token function">detect</span><span class="token punctuation">(</span>xuenai_gray<span class="token punctuation">,</span>xuenai_FastKp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            obr<span class="token operator">-&gt;</span><span class="token function">detect</span><span class="token punctuation">(</span>xuenai_gray<span class="token punctuation">,</span>xuenai_ObrKp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Mat fast_result<span class="token operator">=</span>xuenai_transform<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>obr_result<span class="token operator">=</span>xuenai_transform<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">drawKeypoints</span><span class="token punctuation">(</span>fast_result<span class="token punctuation">,</span>xuenai_FastKp<span class="token punctuation">,</span>fast_result<span class="token punctuation">,</span><span class="token class-name">Scalar</span><span class="token double-colon punctuation">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>DrawMatchesFlags<span class="token double-colon punctuation">::</span>DRAW_RICH_KEYPOINTS<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">drawKeypoints</span><span class="token punctuation">(</span>obr_result<span class="token punctuation">,</span>xuenai_ObrKp<span class="token punctuation">,</span>obr_result<span class="token punctuation">,</span><span class="token class-name">Scalar</span><span class="token double-colon punctuation">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>DrawMatchesFlags<span class="token double-colon punctuation">::</span>DRAW_RICH_KEYPOINTS<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"fast_result"</span><span class="token punctuation">,</span>fast_result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"obr_result"</span><span class="token punctuation">,</span>obr_result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'q'</span><span class="token punctuation">)</span><span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre>
<h4><a id="threshold_3187"></a>调整threshold</h4>
<p><img src="https://img-blog.csdnimg.cn/33a3c6c4503e4e4c9775f3d0e12472c7.png#pic_center" alt="在这里插入图片描述"><br>
<img src="https://img-blog.csdnimg.cn/e9465867a34e40dab8064f8faa2f14bf.png#pic_center" alt="在这里插入图片描述"></p>
<h4><a id="_3190"></a>进行缩放和旋转</h4>
<p><img src="https://img-blog.csdnimg.cn/fd5bd4e1ff644d47847c2f5f04709853.png#pic_center" alt="在这里插入图片描述"></p>
<h4><a id="_3192"></a>错误</h4>
<pre><code class="prism language-cpp">fast<span class="token operator">-&gt;</span><span class="token function">detectAndCompute</span><span class="token punctuation">(</span>xuenai_gray<span class="token punctuation">,</span><span class="token function">noArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>fast_kp<span class="token punctuation">,</span>fast_des<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>前文已经提及，FAST算法不支持描述子的计算</p>
<pre><code class="prism language-cpp">error<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">213</span><span class="token operator">:</span>The function<span class="token operator">/</span>feature is <span class="token operator">not</span> implemented<span class="token punctuation">)</span>  in function <span class="token char">'detectAndCompute'</span>
</code></pre>
<h2><a id="86_BruteForceFLANN_3203"></a>8.6 Brute-Force与FLANN特征匹配</h2>
<h3><a id="861__3204"></a>8.6.1 概述</h3>
<h4><a id="BruteForce_3205"></a>Brute-Force</h4>
<p>暴力匹配（Brute-force matcher）是最简单的二维特征点匹配方法。对于从两幅图像中提取的两个特征描述符集合，对第一个集合中的每个描述符Ri，从第二个集合中找出与其距离最小的描述符Sj作为匹配点。<br>
暴力匹配显然会导致大量错误的匹配结果，还会出现一配多的情况。通过交叉匹配或设置比较阈值筛选匹配结果的方法可以改进暴力匹配的质量。</p>
<ul>
<li>如果参考图像中的描述符Ri与检测图像中的描述符Sj的互为最佳匹配，则称(Ri , Sj)为一致配对。交叉匹配通过删除非一致配对来筛选匹配结果，可以避免出现一配多的错误。</li>
<li>比较阈值筛选是指对于参考图像的描述符Ri，从检测图像中找到距离最小的描述符Sj1和距离次小的描述符Sj2。设置比较阈值t∈[0.5 , 0.9]，只有当最优匹配距离与次优匹配距离满足阈值条件d (Ri , Sj1) ⁄ d (Ri , Sj2) &lt; t时，表明匹配描述符Sj1具有显著性，才接受匹配结果(Ri , Sj1)。</li>
</ul>
<h4><a id="FLANN_3211"></a>FLANN</h4>
<ul>
<li>相比于Brute-Force，FLANN的<strong>速度更快</strong></li>
<li>由于使用的是邻近近似值，所以<strong>精度较差</strong></li>
</ul>
<h3><a id="862_API_3215"></a>8.6.2 API</h3>
<h4><a id="_3216"></a>构造函数</h4>
<pre><code class="prism language-cpp">    CV_WRAP <span class="token keyword">static</span> Ptr<span class="token operator">&lt;</span>BFMatcher<span class="token operator">&gt;</span> <span class="token class-name">BFMatcher</span><span class="token double-colon punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span> <span class="token keyword">int</span> normType<span class="token operator">=</span>NORM_L2<span class="token punctuation">,</span> <span class="token keyword">bool</span> crossCheck<span class="token operator">=</span><span class="token boolean">false</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span>
    CV_WRAP <span class="token keyword">static</span> Ptr<span class="token operator">&lt;</span>FlannBasedMatcher<span class="token operator">&gt;</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">enum</span> <span class="token class-name">NormTypes</span> <span class="token punctuation">{</span>
                 NORM_INF       <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
                 NORM_L1        <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
                 NORM_L2        <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span>
                 NORM_L2SQR     <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span>
                 NORM_HAMMING   <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span>
                 NORM_HAMMING2  <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">,</span>
                 NORM_TYPE_MASK <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">,</span> 
                 NORM_RELATIVE  <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span>
                 NORM_MINMAX    <span class="token operator">=</span> <span class="token number">32</span> 
               <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>normType：计算距离用到的方法，默认是欧氏距离。</p>
<p>crossCheck：是否使用交叉验证，默认不使用。</p>
<p>NORM_L1：L1范数，曼哈顿距离</p>
<p>NORM_L2：L2范数，欧氏距离</p>
<ul>
<li><strong>NORM_L1、NORM_L2适用于SIFT和SURF检测算法</strong></li>
</ul>
<p>NORM_HAMMING：汉明距离</p>
<p>NORM_HAMMING2：汉明距离2，对每2个比特相加处理。</p>
<ul>
<li><strong>NORM_HAMMING、NORM_HAMMING2适用于OBR算法</strong></li>
</ul>
<h4><a id="_3247"></a>描述子匹配</h4>
<pre><code class="prism language-cpp">    CV_WRAP <span class="token keyword">void</span> <span class="token class-name">DescriptorMatcher</span><span class="token double-colon punctuation">::</span><span class="token function">match</span><span class="token punctuation">(</span> InputArray queryDescriptors<span class="token punctuation">,</span> InputArray trainDescriptors<span class="token punctuation">,</span>
                CV_OUT std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>DMatch<span class="token operator">&gt;</span><span class="token operator">&amp;</span> matches<span class="token punctuation">,</span> InputArray mask<span class="token operator">=</span><span class="token function">noArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
</code></pre>
<p>queryDescriptors：描述子的查询点集，即参考图像的特征描述符的集合。</p>
<p>trainDescriptors：描述子的训练点集，即检测图像的特征描述符的集合。</p>
<ul>
<li>特别注意和区分哪个是查询集，哪个是训练集</li>
</ul>
<p>matches：std::vector&lt;DMatch&gt;匹配结果，长度为成功匹配的数量。</p>
<p>mask：掩码图像。<strong>其大小与输入图像必须相同，且必须为灰度图</strong>。计算时，对于掩码中的非0像素算法起作用，掩码中的灰度值为0的像素位置，算法不起作用。</p>
<pre><code class="prism language-cpp">    CV_WRAP <span class="token keyword">void</span> <span class="token class-name">DescriptorMatcher</span><span class="token double-colon punctuation">::</span><span class="token function">knnMatch</span><span class="token punctuation">(</span> InputArray queryDescriptors<span class="token punctuation">,</span> InputArray trainDescriptors<span class="token punctuation">,</span>
                   CV_OUT std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>DMatch<span class="token operator">&gt;</span> <span class="token operator">&gt;</span><span class="token operator">&amp;</span> matches<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">,</span>
                   InputArray mask<span class="token operator">=</span><span class="token function">noArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">bool</span> compactResult<span class="token operator">=</span><span class="token boolean">false</span> <span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
</code></pre>
<p>queryDescriptors：描述子的查询点集，即参考图像的特征描述符的集合。</p>
<p>trainDescriptors：描述子的训练点集，即检测图像的特征描述符的集合。</p>
<ul>
<li>特别注意和区分哪个是查询集，哪个是训练集</li>
</ul>
<p>matches：std::vector&lt;std::vector&lt;DMatch&gt;&gt;类型，<strong>对每个特征点返回k个最优的匹配结果</strong></p>
<p>k：返回匹配点的数量</p>
<p>mask：掩码图像。<strong>其大小与输入图像必须相同，且必须为灰度图</strong>。计算时，对于掩码中的非0像素算法起作用，掩码中的灰度值为0的像素位置，算法不起作用。</p>
<h4><a id="BruteForceFLANN_3280"></a>Brute-Force与FLANN对输入描述子的要求</h4>
<ul>
<li><strong>Brute-Force要求输入的描述子必须是CV_8U或者CV_32S</strong></li>
<li><strong>FLANN要求输入的描述子必须是CV_32F</strong></li>
</ul>
<h4><a id="drawMatches_3285"></a>drawMatches绘制匹配结果</h4>
<pre><code class="prism language-cpp">CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">drawMatches</span><span class="token punctuation">(</span> InputArray img1<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>KeyPoint<span class="token operator">&gt;</span><span class="token operator">&amp;</span> keypoints1<span class="token punctuation">,</span>
                             InputArray img2<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>KeyPoint<span class="token operator">&gt;</span><span class="token operator">&amp;</span> keypoints2<span class="token punctuation">,</span>
                             <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>DMatch<span class="token operator">&gt;</span><span class="token operator">&amp;</span> matches1to2<span class="token punctuation">,</span> InputOutputArray outImg<span class="token punctuation">,</span>
                             <span class="token keyword">const</span> Scalar<span class="token operator">&amp;</span> matchColor<span class="token operator">=</span><span class="token class-name">Scalar</span><span class="token double-colon punctuation">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">const</span> Scalar<span class="token operator">&amp;</span> singlePointColor<span class="token operator">=</span><span class="token class-name">Scalar</span><span class="token double-colon punctuation">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                             <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> matchesMask<span class="token operator">=</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DrawMatchesFlags flags<span class="token operator">=</span>DrawMatchesFlags<span class="token double-colon punctuation">::</span>DEFAULT <span class="token punctuation">)</span><span class="token punctuation">;</span>
                             
CV_EXPORTS_W <span class="token keyword">void</span> <span class="token function">drawMatches</span><span class="token punctuation">(</span> InputArray img1<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>KeyPoint<span class="token operator">&gt;</span><span class="token operator">&amp;</span> keypoints1<span class="token punctuation">,</span>
                             InputArray img2<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>KeyPoint<span class="token operator">&gt;</span><span class="token operator">&amp;</span> keypoints2<span class="token punctuation">,</span>
                             <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>DMatch<span class="token operator">&gt;</span><span class="token operator">&amp;</span> matches1to2<span class="token punctuation">,</span> InputOutputArray outImg<span class="token punctuation">,</span>
                             <span class="token keyword">const</span> <span class="token keyword">int</span> matchesThickness<span class="token punctuation">,</span> <span class="token keyword">const</span> Scalar<span class="token operator">&amp;</span> matchColor<span class="token operator">=</span><span class="token class-name">Scalar</span><span class="token double-colon punctuation">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                             <span class="token keyword">const</span> Scalar<span class="token operator">&amp;</span> singlePointColor<span class="token operator">=</span><span class="token class-name">Scalar</span><span class="token double-colon punctuation">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> matchesMask<span class="token operator">=</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                             DrawMatchesFlags flags<span class="token operator">=</span>DrawMatchesFlags<span class="token double-colon punctuation">::</span>DEFAULT <span class="token punctuation">)</span><span class="token punctuation">;</span>
                             
<span class="token function">CV_EXPORTS_AS</span><span class="token punctuation">(</span>drawMatchesKnn<span class="token punctuation">)</span> <span class="token keyword">void</span> <span class="token function">drawMatches</span><span class="token punctuation">(</span> InputArray img1<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>KeyPoint<span class="token operator">&gt;</span><span class="token operator">&amp;</span> keypoints1<span class="token punctuation">,</span>
                             InputArray img2<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>KeyPoint<span class="token operator">&gt;</span><span class="token operator">&amp;</span> keypoints2<span class="token punctuation">,</span>
                             <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>DMatch<span class="token operator">&gt;</span> <span class="token operator">&gt;</span><span class="token operator">&amp;</span> matches1to2<span class="token punctuation">,</span> InputOutputArray outImg<span class="token punctuation">,</span>
                             <span class="token keyword">const</span> Scalar<span class="token operator">&amp;</span> matchColor<span class="token operator">=</span><span class="token class-name">Scalar</span><span class="token double-colon punctuation">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">const</span> Scalar<span class="token operator">&amp;</span> singlePointColor<span class="token operator">=</span><span class="token class-name">Scalar</span><span class="token double-colon punctuation">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                             <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&gt;</span> <span class="token operator">&gt;</span><span class="token operator">&amp;</span> matchesMask<span class="token operator">=</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&gt;</span> <span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DrawMatchesFlags flags<span class="token operator">=</span>DrawMatchesFlags<span class="token double-colon punctuation">::</span>DEFAULT <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>img1(image1)：源图像1</p>
<p>keypoints1：源图像1的关键点</p>
<p>img2(image2)：源图像2</p>
<p>keypoints2：源图像2的关键点</p>
<p>matches1to2：源图像1的描述子匹配源图像2的描述子的匹配结果</p>
<p>outImg(out image)：输出图像</p>
<p>matchColor：匹配的颜色（特征点和连线)，默认Scalar::all(-1)，颜色随机</p>
<p>singlePointColor：单个点的颜色，即未配对的特征点，默认Scalar::all(-1)，颜色随机</p>
<p>matchesMask：掩码，决定哪些点将被画出，若为空，则画出所有匹配点</p>
<p>flags：特征点的绘制模式，其实就是设置特征点的那些信息需要绘制，那些不需要绘制。</p>
<h3><a id="863__3326"></a>8.6.3 流程</h3>
<ol>
<li>实例化BFMatcher对象</li>
<li>根据需要，调用match函数或knnMatch函数，进行特征匹配</li>
<li>调用drawMatches函数呈现原图，并且绘制匹配点</li>
</ol>
<h3><a id="864__3330"></a>8.6.4 效果</h3>
<pre><code class="prism language-cpp">        Mat xuenai <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Mat xuenai_rect <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"xuenai_rect.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">cvtColor</span><span class="token punctuation">(</span>xuenai_rect<span class="token punctuation">,</span>xuenai_rect<span class="token punctuation">,</span>COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"xuenai"</span><span class="token punctuation">,</span> xuenai<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"threshold"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"angle"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span><span class="token number">360</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"width"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"height"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> thres <span class="token operator">=</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token string">"threshold"</span><span class="token punctuation">,</span> <span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>thres<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>thres<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token string">"width"</span><span class="token punctuation">,</span> <span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>width<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>width<span class="token operator">=</span>xuenai<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>
            <span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token string">"height"</span><span class="token punctuation">,</span> <span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>height<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>height<span class="token operator">=</span>xuenai<span class="token punctuation">.</span>rows<span class="token punctuation">;</span>
            <span class="token keyword">int</span> angle <span class="token operator">=</span> <span class="token function">getTrackbarPos</span><span class="token punctuation">(</span><span class="token string">"angle"</span><span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Mat xuenai_transform<span class="token operator">=</span>xuenai<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">resize</span><span class="token punctuation">(</span>xuenai_transform<span class="token punctuation">,</span>xuenai_transform<span class="token punctuation">,</span><span class="token function">Size</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span>height<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Mat M<span class="token operator">=</span> <span class="token function">getRotationMatrix2D</span><span class="token punctuation">(</span><span class="token function">Point2f</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">float</span> <span class="token punctuation">)</span>xuenai_transform<span class="token punctuation">.</span>cols<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">float</span> <span class="token punctuation">)</span>xuenai_transform<span class="token punctuation">.</span>rows<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>angle<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">warpAffine</span><span class="token punctuation">(</span>xuenai_transform<span class="token punctuation">,</span>xuenai_transform<span class="token punctuation">,</span>M<span class="token punctuation">,</span>xuenai_transform<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Mat <span class="token function">xuenai_gray</span><span class="token punctuation">(</span>xuenai<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">cvtColor</span><span class="token punctuation">(</span>xuenai_transform<span class="token punctuation">,</span>xuenai_gray<span class="token punctuation">,</span>COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//准备工作</span>
            Ptr<span class="token operator">&lt;</span>ORB<span class="token operator">&gt;</span>obr<span class="token operator">=</span><span class="token class-name">ORB</span><span class="token double-colon punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            vector<span class="token operator">&lt;</span>KeyPoint<span class="token operator">&gt;</span>xuenai_ObrKp<span class="token punctuation">;</span>
            vector<span class="token operator">&lt;</span>KeyPoint<span class="token operator">&gt;</span>xuenai_rect_ObrKp<span class="token punctuation">;</span>
            Mat BFMmatch_result<span class="token punctuation">;</span>Mat FLANNmatch_result<span class="token punctuation">;</span>
            Mat xuenai_obr_descriptorsForBF<span class="token punctuation">;</span>Mat xuenai_rect_obr_descriptorsForBF<span class="token punctuation">;</span>Mat xuenai_obr_descriptorsForFLANN<span class="token punctuation">;</span>Mat xuenai_rect_obr_descriptorsForFLANN<span class="token punctuation">;</span>
            vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>DMatch<span class="token operator">&gt;&gt;</span>xuenai_BFMmatch_results<span class="token punctuation">;</span>vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>DMatch<span class="token operator">&gt;&gt;</span>xuenai_FLANNmatch_results<span class="token punctuation">;</span>
            obr<span class="token operator">-&gt;</span><span class="token function">detectAndCompute</span><span class="token punctuation">(</span>xuenai_gray<span class="token punctuation">,</span><span class="token function">noArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai_ObrKp<span class="token punctuation">,</span>xuenai_obr_descriptorsForBF<span class="token punctuation">)</span><span class="token punctuation">;</span>
            obr<span class="token operator">-&gt;</span><span class="token function">detectAndCompute</span><span class="token punctuation">(</span>xuenai_rect<span class="token punctuation">,</span><span class="token function">noArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xuenai_rect_ObrKp<span class="token punctuation">,</span>xuenai_rect_obr_descriptorsForBF<span class="token punctuation">)</span><span class="token punctuation">;</span>
            xuenai_obr_descriptorsForBF<span class="token punctuation">.</span><span class="token function">convertTo</span><span class="token punctuation">(</span>xuenai_obr_descriptorsForFLANN<span class="token punctuation">,</span>CV_32F<span class="token punctuation">)</span><span class="token punctuation">;</span>
            xuenai_rect_obr_descriptorsForBF<span class="token punctuation">.</span><span class="token function">convertTo</span><span class="token punctuation">(</span>xuenai_rect_obr_descriptorsForFLANN<span class="token punctuation">,</span>CV_32F<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//进行匹配</span>
            Ptr<span class="token operator">&lt;</span>BFMatcher<span class="token operator">&gt;</span>bfm<span class="token operator">=</span><span class="token class-name">BFMatcher</span><span class="token double-colon punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span>NORM_HAMMING<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Ptr<span class="token operator">&lt;</span>FlannBasedMatcher<span class="token operator">&gt;</span>flann<span class="token operator">=</span><span class="token class-name">FlannBasedMatcher</span><span class="token double-colon punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bfm<span class="token operator">-&gt;</span><span class="token function">knnMatch</span><span class="token punctuation">(</span>xuenai_obr_descriptorsForBF<span class="token punctuation">,</span>xuenai_rect_obr_descriptorsForBF<span class="token punctuation">,</span>xuenai_BFMmatch_results<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            flann<span class="token operator">-&gt;</span><span class="token function">knnMatch</span><span class="token punctuation">(</span>xuenai_obr_descriptorsForFLANN<span class="token punctuation">,</span>xuenai_rect_obr_descriptorsForFLANN<span class="token punctuation">,</span>xuenai_FLANNmatch_results<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//比率检验</span>
            vector<span class="token operator">&lt;</span>DMatch<span class="token operator">&gt;</span>goodBFMresult<span class="token punctuation">,</span>goodFLANNresult<span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> match_result<span class="token operator">:</span>xuenai_BFMmatch_results<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>match_result<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> match_result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>distance<span class="token operator">&lt;</span><span class="token number">0.7</span><span class="token operator">*</span>match_result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>distance<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    goodBFMresult<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>match_result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> match_result<span class="token operator">:</span>xuenai_FLANNmatch_results<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>match_result<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> match_result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>distance<span class="token operator">&lt;</span><span class="token number">0.7</span><span class="token operator">*</span>match_result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>distance<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    goodFLANNresult<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>match_result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            
            <span class="token comment">//绘制匹配结果</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>goodBFMresult<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">drawMatches</span><span class="token punctuation">(</span>xuenai_rect<span class="token punctuation">,</span> xuenai_rect_ObrKp<span class="token punctuation">,</span>
                            xuenai_transform<span class="token punctuation">,</span> xuenai_ObrKp<span class="token punctuation">,</span>
                            goodBFMresult<span class="token punctuation">,</span> BFMmatch_result<span class="token punctuation">,</span>
                            <span class="token class-name">Scalar</span><span class="token double-colon punctuation">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Scalar</span><span class="token double-colon punctuation">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            DrawMatchesFlags<span class="token double-colon punctuation">::</span>NOT_DRAW_SINGLE_POINTS<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"BFMmatch_result"</span><span class="token punctuation">,</span>BFMmatch_result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>goodFLANNresult<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">drawMatches</span><span class="token punctuation">(</span>xuenai_rect<span class="token punctuation">,</span> xuenai_rect_ObrKp<span class="token punctuation">,</span>
                            xuenai_transform<span class="token punctuation">,</span> xuenai_ObrKp<span class="token punctuation">,</span>
                            goodFLANNresult<span class="token punctuation">,</span> FLANNmatch_result<span class="token punctuation">,</span>
                            <span class="token class-name">Scalar</span><span class="token double-colon punctuation">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Scalar</span><span class="token double-colon punctuation">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            DrawMatchesFlags<span class="token double-colon punctuation">::</span>NOT_DRAW_SINGLE_POINTS<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"FLANNmatch_result"</span><span class="token punctuation">,</span>FLANNmatch_result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'q'</span><span class="token punctuation">)</span><span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre>
<h4><a id="_3413"></a>不进行比率筛选</h4>
<p><img src="https://img-blog.csdnimg.cn/58d3f5d59453442bb0d9f7c4240c2ac4.png#pic_center" alt="在这里插入图片描述"><br>
<img src="https://img-blog.csdnimg.cn/f5564da11f774c80877d3eba5ecf0c15.png#pic_center" alt="在这里插入图片描述"></p>
<h4><a id="_3417"></a>进行比率筛选</h4>
<p><img src="https://img-blog.csdnimg.cn/5c15f17039d247ffa688f528003a3b73.png#pic_center" alt="在这里插入图片描述"><br>
<img src="https://img-blog.csdnimg.cn/2fcaee0c53964ce0bb122e55bd905c5b.png#pic_center" alt="在这里插入图片描述"><br>
<img src="https://img-blog.csdnimg.cn/8b9c699448564f539719ae8747125899.png#pic_center" alt="在这里插入图片描述"><br>
<img src="https://img-blog.csdnimg.cn/2cb7a1c4290545b2be79eaf026b9b11e.png#pic_center" alt="在这里插入图片描述"></p>
<h1><a id="9_3422"></a>9.结语与感谢</h1>
<p>对于所有看到这儿的朋友们，我很高兴地祝贺你们已经完成了OpenCV的基础知识学习，我可以很明确地说，你们对计算机视觉领域的了解已经超过了绝大多数的人，恭喜你们。本文总计七万三千二百五十六字，三千四百一十二行，是本人第一次撰写的长篇系列教程，多有不当之处，谢谢读者们对我的包容和支持。<br>
然而，纸上得来终觉浅，绝知此事要躬行。本文只是基础知识的讲解，关于OpenCV的实战项目，敬请关注本人的后续文章。<br>
以上。</p>
</div>
</body>

</html>
